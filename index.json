[{"content":"tailwindcss Arbitrary values åœ¨ä½¿ç”¨tailwindçš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°æ²¡æœ‰é¢„å®šå€¼çš„æ ·å¼ï¼Œå°±å¯ä»¥ä½¿ç”¨arbitrary valuesã€‚\næ¯”å¦‚ï¼š\nbg-[#ff8906] å°±å¯ä»¥è®¾ç½®èƒŒæ™¯è‰²ä¸ºæ©™è‰²ã€‚ w-[300px] å°±å¯ä»¥è®¾ç½®å®½åº¦ä¸º300pxã€‚ è¿˜æœ‰ä¸€äº›ï¼Œå°±æ˜¯æ²¡æœ‰å®šä¹‰ç±»å‹çš„ï¼Œæœ€å¸¸è§çš„å°±æ˜¯svgçš„å±æ€§ã€‚stroke-dasharrayåœ¨tailwindä¸­å°±æ²¡æœ‰å®šä¹‰ç±»å‹ï¼Œæ‰€ä»¥å°±å¯ä»¥ä½¿ç”¨arbitrary valuesã€‚\n[stroke-dasharray:450,0]: è®¾ç½®stroke-dasharrayä¸º450,0ã€‚ styling-based-on-parent-state è¿™ç§æ˜¯åœ¨å­å…ƒç´ ä¾èµ–äºçˆ¶å…ƒç´ hoverç­‰çŠ¶æ€æ—¶ä½¿ç”¨çš„ã€‚\n\u0026lt;a href=\u0026#34;#\u0026#34; class=\u0026#34;group block max-w-xs mx-auto rounded-lg p-6 bg-white ring-1 ring-slate-900/5 shadow-lg space-y-3 hover:bg-sky-500 hover:ring-sky-500\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;flex items-center space-x-3\u0026#34;\u0026gt; \u0026lt;svg class=\u0026#34;h-6 w-6 stroke-sky-500 group-hover:stroke-white\u0026#34; fill=\u0026#34;none\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34;\u0026gt;\u0026lt;!-- ... --\u0026gt;\u0026lt;/svg\u0026gt; \u0026lt;h3 class=\u0026#34;text-slate-900 group-hover:text-white text-sm font-semibold\u0026#34;\u0026gt;New project\u0026lt;/h3\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;p class=\u0026#34;text-slate-500 group-hover:text-white text-sm\u0026#34;\u0026gt;Create a new project from a variety of starting templates.\u0026lt;/p\u0026gt; \u0026lt;/a\u0026gt; è®¾ç½®groupï¼Œç„¶ååœ¨å­å…ƒç´ ä¸Šä½¿ç”¨group-hoverã€‚\nstroke-dasharrayå±æ€§ é¦–å…ˆè¿™ä¸ªæ˜¯ç»™svgä½¿ç”¨çš„å±æ€§ã€‚æ§åˆ¶strokeçš„dashé•¿åº¦å’Œé—´éš”é•¿åº¦ã€‚\nstroke-dasharray: 2; è¡¨ç¤ºdashçš„é•¿åº¦ä¸º2ï¼Œé—´éš”é•¿åº¦ä¸º2ã€‚ stroke-dasharray: 2 4; è¡¨ç¤ºdashçš„é•¿åº¦ä¸º2ï¼Œé—´éš”é•¿åº¦ä¸º4ã€‚ stroke-dasharray: 5 10 15; è¡¨ç¤ºdashçš„é•¿åº¦ä¸º5ï¼Œé—´éš”é•¿åº¦ä¸º10ï¼Œdashçš„é•¿åº¦ä¸º15ï¼Œé—´éš”é•¿åº¦ä¸º5ã€‚ ","permalink":"https://carlos19960601.github.io/posts/css%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","summary":"\u003ch3 id=\"tailwindcss\"\u003etailwindcss\u003c/h3\u003e\n\u003ch4 id=\"arbitrary-values\"\u003eArbitrary values\u003c/h4\u003e\n\u003cp\u003eåœ¨ä½¿ç”¨tailwindçš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°æ²¡æœ‰é¢„å®šå€¼çš„æ ·å¼ï¼Œå°±å¯ä»¥ä½¿ç”¨arbitrary valuesã€‚\u003c/p\u003e\n\u003cp\u003eæ¯”å¦‚ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ebg-[#ff8906]\u003c/code\u003e å°±å¯ä»¥è®¾ç½®èƒŒæ™¯è‰²ä¸ºæ©™è‰²ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ew-[300px]\u003c/code\u003e å°±å¯ä»¥è®¾ç½®å®½åº¦ä¸º300pxã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¿˜æœ‰ä¸€äº›ï¼Œå°±æ˜¯æ²¡æœ‰å®šä¹‰ç±»å‹çš„ï¼Œæœ€å¸¸è§çš„å°±æ˜¯svgçš„å±æ€§ã€‚\u003ccode\u003estroke-dasharray\u003c/code\u003eåœ¨tailwindä¸­å°±æ²¡æœ‰å®šä¹‰ç±»å‹ï¼Œæ‰€ä»¥å°±å¯ä»¥ä½¿ç”¨arbitrary valuesã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e[stroke-dasharray:450,0]\u003c/code\u003e: è®¾ç½®stroke-dasharrayä¸º450,0ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"styling-based-on-parent-statehttpstailwindcsscomdocshover-focus-and-other-statesstyling-based-on-parent-state\"\u003e\u003ca href=\"https://tailwindcss.com/docs/hover-focus-and-other-states#styling-based-on-parent-state\"\u003estyling-based-on-parent-state\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eè¿™ç§æ˜¯åœ¨å­å…ƒç´ ä¾èµ–äºçˆ¶å…ƒç´ hoverç­‰çŠ¶æ€æ—¶ä½¿ç”¨çš„ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;#\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;group block max-w-xs mx-auto rounded-lg p-6 bg-white ring-1 ring-slate-900/5 shadow-lg space-y-3 hover:bg-sky-500 hover:ring-sky-500\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;flex items-center space-x-3\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003esvg\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;h-6 w-6 stroke-sky-500 group-hover:stroke-white\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efill\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;none\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eviewBox\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0 0 24 24\u0026#34;\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- ... --\u0026gt;\u003c/span\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003esvg\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003eh3\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text-slate-900 group-hover:text-white text-sm font-semibold\u0026#34;\u003c/span\u003e\u0026gt;New project\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh3\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u0026lt;\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text-slate-500 group-hover:text-white text-sm\u0026#34;\u003c/span\u003e\u0026gt;Create a new project from a variety of starting templates.\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè®¾ç½®\u003ccode\u003egroup\u003c/code\u003eï¼Œç„¶ååœ¨å­å…ƒç´ ä¸Šä½¿ç”¨\u003ccode\u003egroup-hover\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch3 id=\"stroke-dasharrayå±æ€§httpscss-trickscomalmanacpropertiessstroke-dasharray\"\u003e\u003ca href=\"https://css-tricks.com/almanac/properties/s/stroke-dasharray/\"\u003estroke-dasharrayå±æ€§\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eé¦–å…ˆè¿™ä¸ªæ˜¯ç»™svgä½¿ç”¨çš„å±æ€§ã€‚æ§åˆ¶strokeçš„dashé•¿åº¦å’Œé—´éš”é•¿åº¦ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003estroke-dasharray: 2; è¡¨ç¤ºdashçš„é•¿åº¦ä¸º2ï¼Œé—´éš”é•¿åº¦ä¸º2ã€‚\u003c/li\u003e\n\u003cli\u003estroke-dasharray: 2 4; è¡¨ç¤ºdashçš„é•¿åº¦ä¸º2ï¼Œé—´éš”é•¿åº¦ä¸º4ã€‚\u003c/li\u003e\n\u003cli\u003estroke-dasharray: 5 10 15; è¡¨ç¤ºdashçš„é•¿åº¦ä¸º5ï¼Œé—´éš”é•¿åº¦ä¸º10ï¼Œdashçš„é•¿åº¦ä¸º15ï¼Œé—´éš”é•¿åº¦ä¸º5ã€‚\u003c/li\u003e\n\u003c/ul\u003e","title":"Csså­¦ä¹ ç¬”è®°"},{"content":"npx æ€ä¹ˆç”¨pnpmæ›¿ä»£ Running executables inside your downloaded dependencies npx jest -\u0026gt; pnpm exec jest\nRunning executable commands in packages you want to download transiently npx create-react-app my-app -\u0026gt; pnpm dlx create-react-app my-app\npnpm å…¨å±€çš„å…¬å…±ä¾èµ–åŒ…\npnpm install react -w pnpm install rollup -wD ç»™æŸä¸ªpackageå•ç‹¬å®‰è£…æŒ‡å®šä¾èµ–\npnpm add axios --filter @qftjs/monorepo1 pnpm build --filter @qftjs/monorepo1 pnpm build --filter \u0026#34;./packages/**\u0026#34; æ¨¡å—ä¹‹é—´çš„ç›¸äº’ä¾èµ–\npnpm install @qftjs/monorepo2 -r --filter @qftjs/monorepo1 å‚è€ƒèµ„æ–™\nCan I use npx with pnpm? äº”é™©ä¸€é‡‘ å…»è€ä¿é™©ï¼š\nä¸ªäºº: 8% å•ä½: 16% typescripe åˆ«å é–‹ç™¼ç’°å¢ƒä¸‹ï¼Œæˆ‘å€‘ä½¿ç”¨ nodemonï¼Œè€Œ nodemon åˆæ˜¯ä½¿ç”¨ ts-nodeï¼Œæ‰€ä»¥æˆ‘å€‘çš„ç›®æ¨™ä¾¿æ˜¯è®“ ts-node å¥—ä»¶å¯ä»¥è§£æè·¯å¾‘åˆ¥å\npnpm i -D tsconfig-paths { // å¼•å…¥ tsconfig-paths/register // æ³¨æ„ ts-node çš„å±¤ç´šèˆ‡ compilerOptions ç›¸åŒ \u0026#34;ts-node\u0026#34;: { \u0026#34;require\u0026#34;: [\u0026#34;tsconfig-paths/register\u0026#34;] }, \u0026#34;compilerOptions\u0026#34;: { // ... // é…ç½®éœ€è¦çš„ alias \u0026#34;baseUrl\u0026#34;: \u0026#34;.\u0026#34;, \u0026#34;paths\u0026#34;: { \u0026#34;@middleware/*\u0026#34;: [\u0026#34;middleware/*\u0026#34;], }, // ... } } npm install --save-dev tsc-alias typescript express è¨­å®šè·¯å¾‘åˆ¥å (alias) tsc - doesn\u0026rsquo;t compile alias paths ubuntué»˜è®¤ä¼šå¯åŠ¨53ç«¯å£ æˆ‘ä»¬å¯ä»¥ä¿®æ”¹/etc/systemd/resolved.confä¸­DNSStubListenerçš„æ³¨é‡Šè¡Œï¼Œå®ƒå°†ä¸å†æ‰“å¼€dnsæœåŠ¡\n","permalink":"https://carlos19960601.github.io/posts/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/","summary":"\u003ch3 id=\"npx-æ€ä¹ˆç”¨pnpmæ›¿ä»£\"\u003enpx æ€ä¹ˆç”¨pnpmæ›¿ä»£\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eRunning executables inside your downloaded dependencies\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003enpx jest\u003c/code\u003e -\u0026gt; \u003ccode\u003epnpm exec jest\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRunning executable commands in packages you want to download transiently\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003enpx create-react-app my-app\u003c/code\u003e -\u0026gt; \u003ccode\u003epnpm dlx create-react-app my-app\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"pnpm\"\u003epnpm\u003c/h3\u003e\n\u003cp\u003eå…¨å±€çš„å…¬å…±ä¾èµ–åŒ…\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epnpm install react -w\n\npnpm install rollup -wD\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eç»™æŸä¸ªpackageå•ç‹¬å®‰è£…æŒ‡å®šä¾èµ–\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epnpm add axios --filter @qftjs/monorepo1\n\u003c/code\u003e\u003c/pre\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epnpm build --filter @qftjs/monorepo1\n\npnpm build --filter \u0026#34;./packages/**\u0026#34;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eæ¨¡å—ä¹‹é—´çš„ç›¸äº’ä¾èµ–\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epnpm install @qftjs/monorepo2 -r --filter @qftjs/monorepo1\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cstrong\u003eå‚è€ƒèµ„æ–™\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/75413361/can-i-use-npx-with-pnpm\"\u003eCan I use npx with pnpm?\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"äº”é™©ä¸€é‡‘\"\u003eäº”é™©ä¸€é‡‘\u003c/h3\u003e\n\u003cp\u003eå…»è€ä¿é™©ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¸ªäºº: 8% å•ä½: 16%\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"typescripe-åˆ«å\"\u003etypescripe åˆ«å\u003c/h3\u003e\n\u003cp\u003eé–‹ç™¼ç’°å¢ƒä¸‹ï¼Œæˆ‘å€‘ä½¿ç”¨ nodemonï¼Œè€Œ nodemon åˆæ˜¯ä½¿ç”¨ ts-nodeï¼Œæ‰€ä»¥æˆ‘å€‘çš„ç›®æ¨™ä¾¿æ˜¯è®“ ts-node å¥—ä»¶å¯ä»¥è§£æè·¯å¾‘åˆ¥å\u003c/p\u003e","title":"æ‚ä¸ƒæ‚å…«"},{"content":"HTTPåè®® æ˜æ–‡ä¼ è¾“ -\u0026gt; å¯¼è‡´ å†…å®¹ä¼šè¢«ç¯¡æ”¹ï¼ˆä¸­é—´äººæ”»å‡»ï¼‰-\u0026gt; è§£å†³æ–¹æ¡ˆï¼šåŠ å¯† åŠ å¯†æ–¹å¼\nå¯¹ç§°åŠ å¯†ï¼šåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„åŒä¸€ä¸ªå¯†é’¥ éå¯¹ç§°åŠ å¯†: å…¬é’¥å’Œç§é’¥æœ‰ä¸ªç‰¹åˆ«çš„å•å‘æ€§ï¼Œè™½ç„¶éƒ½å¯ä»¥ç”¨æ¥åŠ å¯†è§£å¯†ï¼Œä½†å…¬é’¥åŠ å¯†ååªèƒ½ç”¨ç§é’¥è§£å¯†ï¼Œåè¿‡æ¥ï¼Œç§é’¥åŠ å¯†åä¹Ÿåªèƒ½ç”¨å…¬é’¥è§£å¯†ã€‚ ç»“åˆè¿™2ç§åŠ å¯†æ–¹å¼å°±èƒ½å®Œæˆå¯†é’¥äº’æ¢ -\u0026gt; ç ´è§£æ–¹å¼: ä¸­é—´äººæ¨¡æ‹ŸæœåŠ¡å™¨è¡Œä¸º -\u0026gt; HTTPS\nç®€å•æµç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆæœåŠ¡ç«¯å°†å…¬é’¥å…¬å¸ƒå‡ºå»ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¹Ÿå°±çŸ¥é“å…¬é’¥äº†ã€‚æ¥ä¸‹æ¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªç§˜é’¥ï¼Œç„¶åé€šè¿‡å…¬é’¥åŠ å¯†å¹¶å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å¯†æ–‡ä»¥åé€šè¿‡ç§é’¥è§£å¯†å‡ºæ­£ç¡®çš„ç§˜é’¥ï¼Œè¿™æ—¶å€™ä¸¤ç«¯å°±éƒ½çŸ¥é“ç§˜é’¥æ˜¯ä»€ä¹ˆäº†ã€‚\nHTTPSåè®® ä¸­é—´äººæ¨¡æ‹ŸæœåŠ¡å™¨è¡Œä¸ºä¸»è¦åŸå› æ˜¯ ä¸­é—´äººä¸è¢«ä¿¡ä»»ï¼Œé‚£ä¹ˆHTTPSæœ‰CA è®¤è¯ä½“ç³»ï¼Œ\nCA ç­¾å‘è¯ä¹¦çš„è¿‡ç¨‹ï¼Œå¦‚ä¸Šå›¾å·¦è¾¹éƒ¨åˆ†ï¼š\nâ¾¸å…ˆ CA ä¼šæŠŠæŒæœ‰è€…çš„å…¬é’¥ã€â½¤é€”ã€é¢å‘è€…ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯æ‰“æˆâ¼€ä¸ªåŒ…ï¼Œç„¶åå¯¹è¿™äº›ä¿¡æ¯è¿›â¾ Hash è®¡ç®—ï¼Œå¾—åˆ°â¼€ä¸ª Hash å€¼ï¼› ç„¶å CA ä¼šä½¿â½¤â¾ƒâ¼°çš„ç§é’¥å°†è¯¥ Hash å€¼åŠ å¯†ï¼Œâ½£æˆ Certificate Signatureï¼Œä¹Ÿå°±æ˜¯ CA å¯¹è¯ä¹¦åšäº†ç­¾åï¼› æœ€åå°† Certificate Signature æ·»åŠ åœ¨â½‚ä»¶è¯ä¹¦ä¸Šï¼Œå½¢æˆæ•°å­—è¯ä¹¦ï¼› å®¢æˆ·ç«¯æ ¡éªŒæœåŠ¡ç«¯çš„æ•°å­—è¯ä¹¦çš„è¿‡ç¨‹ï¼Œå¦‚ä¸Šå›¾å³è¾¹éƒ¨åˆ†ï¼š\nâ¾¸å…ˆå®¢æˆ·ç«¯ä¼šä½¿â½¤åŒæ ·çš„ Hash ç®—æ³•è·å–è¯¥è¯ä¹¦çš„ Hash å€¼ H1ï¼› é€šå¸¸æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿä¸­é›†æˆäº† CA çš„å…¬é’¥ä¿¡æ¯ï¼Œæµè§ˆå™¨æ”¶åˆ°è¯ä¹¦åå¯ä»¥ä½¿â½¤ CA çš„å…¬é’¥è§£å¯† Certificate Signature å†…å®¹ï¼Œå¾—åˆ°â¼€ä¸ª Hash å€¼ H2 ï¼› æœ€åâ½è¾ƒ H1 å’Œ H2ï¼Œå¦‚æœå€¼ç›¸åŒï¼Œåˆ™ä¸ºå¯ä¿¡èµ–çš„è¯ä¹¦ï¼Œå¦åˆ™åˆ™è®¤ä¸ºè¯ä¹¦ä¸å¯ä¿¡ã€‚ HTTPSæŠ“åŒ…ï¼š\næŠ“åŒ…å‡ºæ¥éƒ½æ˜¯åŠ å¯†çš„æ•°æ®ï¼ŒæŠ“åŒ…å·¥å…·æ¨¡æ‹Ÿä¸­é—´äººï¼Œä¼ªé€ è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä¼šæç¤ºè¯ä¹¦ä¸è¢«ä¿¡ä»»ï¼Œå¦‚æœå®¢æˆ·ç«¯åŒæ„ï¼Œè¯·æ±‚å°±ä¼šè¢«æŠ“åŒ…å·¥å…·æ‹¦æˆªï¼Œè½¬å‘ç»™æœåŠ¡ç«¯ã€‚\nHTTP2 HTTP/1.1 åè®®çš„æ€§èƒ½ç¼ºé™·ï¼š\né«˜å»¶è¿Ÿï¼šé¡µé¢è®¿é—®é€Ÿåº¦ä¸‹é™ -\u0026gt; ä¸»è¦ç”±äºé˜Ÿå¤´é˜»å¡ HTTP/1.1 ç‰ˆå¼•å…¥äº†ç®¡é“æœºåˆ¶ï¼ˆpipeliningï¼‰ï¼Œå³åœ¨åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè¿›ä¸€æ­¥æ”¹è¿›äº† HTTP åè®®çš„æ•ˆç‡\nä½†è¿™è¦æ±‚æœåŠ¡ç«¯å¿…é¡»æŒ‰ç…§è¯·æ±‚å‘é€çš„é¡ºåºè¿”å›å“åº”ï¼Œå½“é¡ºåºè¯·æ±‚å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªè¯·æ±‚å› ä¸ºæŸç§åŸå› è¢«é˜»å¡æ—¶ï¼Œåœ¨åé¢æ’é˜Ÿçš„æ‰€æœ‰è¯·æ±‚ä¹Ÿä¸€å¹¶è¢«é˜»å¡ï¼Œè¿™å°±æ˜¯é˜Ÿå¤´é˜»å¡ (Head-Of-Line Blocking)\næ˜æ–‡ä¼ è¾“ï¼šä¸å®‰å…¨ æ— çŠ¶æ€ï¼šå¤´éƒ¨å·¨å¤§åˆ‡é‡å¤ ä¸æ”¯æŒæœåŠ¡å™¨æ¨é€ HTTP/2 æ–°ç‰¹æ€§\näºŒè¿›åˆ¶ä¼ è¾“ å¤šä¸ªå¸§ä¹‹é—´å¯ä»¥ä¹±åºå‘é€ï¼Œæ ¹æ®å¸§é¦–éƒ¨çš„æµæ ‡è¯†å¯ä»¥é‡æ–°ç»„è£…\nHeader å‹ç¼©ï¼ˆHPACKï¼‰ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤ä¸€å¼ å¤´ä¿¡æ¯è¡¨ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å…¥è¿™ä¸ªè¡¨ï¼Œç”Ÿæˆä¸€ä¸ªç´¢å¼•å·ï¼Œä»¥åå°±ä¸å‘é€åŒæ ·å­—æ®µäº†ï¼Œåªå‘é€ç´¢å¼•å·ï¼Œè¿™æ ·å°±æé«˜é€Ÿåº¦äº†ã€‚\nå¤šè·¯å¤ç”¨ æœåŠ¡ç«¯ Push æé«˜å®‰å…¨æ€§ HTTP2è§£å†³äº†HTTP1.Xçš„é˜Ÿå¤´é˜»å¡ï¼Œä½†æ˜¯TCPçš„çš„é˜Ÿå¤´é˜»å¡ä»ç„¶å­˜åœ¨ã€‚å¦‚æœå‡ºç°TCPä¸¢åŒ…ï¼Œå¯èƒ½è¿˜æ›´ä¸¥é‡ã€‚\nHTTP3 å‚è€ƒè¯´ä¸€ä¸‹ HTTP/3 æ–°ç‰¹æ€§ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨ UDP åè®®ï¼Ÿ\nå‚è€ƒèµ„æ–™ ä¸ºä»€ä¹ˆè¯´HTTPSæ¯”HTTPå®‰å…¨å‘¢ HTTP/2å¯¹æ¯”HTTP/1.1ï¼Œç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦‚ä½•è§£å†³é˜Ÿå¤´é˜»å¡ä¸å‹ç¼©å¤´éƒ¨çš„ï¼Ÿ è¯´ä¸€ä¸‹ HTTP/3 æ–°ç‰¹æ€§ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨ UDP åè®®ï¼Ÿ é¢æ¸£é€†è¢­ï¼šä¸‰ä¸‡å­—ï¼Œä¸ƒåå›¾è¯¦è§£è®¡ç®—æœºç½‘ç»œå…­åäºŒé—®ï¼ˆå»ºè®®æ”¶è—) HTTPå’ŒTCPåè®®çš„é˜Ÿå¤´é˜»å¡ ","permalink":"https://carlos19960601.github.io/posts/http%E5%8D%8F%E8%AE%AE/","summary":"\u003ch3 id=\"httpåè®®\"\u003eHTTPåè®®\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eæ˜æ–‡ä¼ è¾“ -\u0026gt; å¯¼è‡´ å†…å®¹ä¼šè¢«ç¯¡æ”¹ï¼ˆä¸­é—´äººæ”»å‡»ï¼‰-\u0026gt; è§£å†³æ–¹æ¡ˆï¼šåŠ å¯†\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåŠ å¯†æ–¹å¼\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¯¹ç§°åŠ å¯†ï¼šåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„åŒä¸€ä¸ªå¯†é’¥\u003c/li\u003e\n\u003cli\u003eéå¯¹ç§°åŠ å¯†: å…¬é’¥å’Œç§é’¥æœ‰ä¸ªç‰¹åˆ«çš„å•å‘æ€§ï¼Œè™½ç„¶éƒ½å¯ä»¥ç”¨æ¥åŠ å¯†è§£å¯†ï¼Œä½†å…¬é’¥åŠ å¯†ååªèƒ½ç”¨ç§é’¥è§£å¯†ï¼Œåè¿‡æ¥ï¼Œç§é’¥åŠ å¯†åä¹Ÿåªèƒ½ç”¨å…¬é’¥è§£å¯†ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç»“åˆè¿™2ç§åŠ å¯†æ–¹å¼å°±èƒ½å®Œæˆå¯†é’¥äº’æ¢ -\u0026gt; ç ´è§£æ–¹å¼: ä¸­é—´äººæ¨¡æ‹ŸæœåŠ¡å™¨è¡Œä¸º -\u0026gt; HTTPS\u003c/p\u003e\n\u003cp\u003eç®€å•æµç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆæœåŠ¡ç«¯å°†å…¬é’¥å…¬å¸ƒå‡ºå»ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¹Ÿå°±çŸ¥é“å…¬é’¥äº†ã€‚æ¥ä¸‹æ¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªç§˜é’¥ï¼Œç„¶åé€šè¿‡å…¬é’¥åŠ å¯†å¹¶å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å¯†æ–‡ä»¥åé€šè¿‡ç§é’¥è§£å¯†å‡ºæ­£ç¡®çš„ç§˜é’¥ï¼Œè¿™æ—¶å€™ä¸¤ç«¯å°±éƒ½çŸ¥é“ç§˜é’¥æ˜¯ä»€ä¹ˆäº†ã€‚\u003c/p\u003e\n\u003ch3 id=\"httpsåè®®\"\u003eHTTPSåè®®\u003c/h3\u003e\n\u003cp\u003eä¸­é—´äººæ¨¡æ‹ŸæœåŠ¡å™¨è¡Œä¸ºä¸»è¦åŸå› æ˜¯ ä¸­é—´äººä¸è¢«ä¿¡ä»»ï¼Œé‚£ä¹ˆHTTPSæœ‰\u003cstrong\u003eCA è®¤è¯ä½“ç³»\u003c/strong\u003eï¼Œ\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/http%e5%8d%8f%e8%ae%ae/CA%e7%ad%be%e5%8f%91%e8%af%81%e4%b9%a6.png\" alt=\"CAç­¾å‘è¯ä¹¦\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003eCA ç­¾å‘è¯ä¹¦çš„è¿‡ç¨‹ï¼Œå¦‚ä¸Šå›¾å·¦è¾¹éƒ¨åˆ†ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eâ¾¸å…ˆ CA ä¼šæŠŠæŒæœ‰è€…çš„å…¬é’¥ã€â½¤é€”ã€é¢å‘è€…ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯æ‰“æˆâ¼€ä¸ªåŒ…ï¼Œç„¶åå¯¹è¿™äº›ä¿¡æ¯è¿›â¾ Hash è®¡ç®—ï¼Œå¾—åˆ°â¼€ä¸ª Hash å€¼ï¼›\u003c/li\u003e\n\u003cli\u003eç„¶å CA ä¼šä½¿â½¤â¾ƒâ¼°çš„ç§é’¥å°†è¯¥ Hash å€¼åŠ å¯†ï¼Œâ½£æˆ Certificate Signatureï¼Œä¹Ÿå°±æ˜¯ CA å¯¹è¯ä¹¦åšäº†ç­¾åï¼›\u003c/li\u003e\n\u003cli\u003eæœ€åå°† Certificate Signature æ·»åŠ åœ¨â½‚ä»¶è¯ä¹¦ä¸Šï¼Œå½¢æˆæ•°å­—è¯ä¹¦ï¼›\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå®¢æˆ·ç«¯æ ¡éªŒæœåŠ¡ç«¯çš„æ•°å­—è¯ä¹¦çš„è¿‡ç¨‹ï¼Œå¦‚ä¸Šå›¾å³è¾¹éƒ¨åˆ†ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eâ¾¸å…ˆå®¢æˆ·ç«¯ä¼šä½¿â½¤åŒæ ·çš„ Hash ç®—æ³•è·å–è¯¥è¯ä¹¦çš„ Hash å€¼ H1ï¼›\u003c/li\u003e\n\u003cli\u003eé€šå¸¸æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿä¸­é›†æˆäº† CA çš„å…¬é’¥ä¿¡æ¯ï¼Œæµè§ˆå™¨æ”¶åˆ°è¯ä¹¦åå¯ä»¥ä½¿â½¤ CA çš„å…¬é’¥è§£å¯† Certificate\u003c/li\u003e\n\u003cli\u003eSignature å†…å®¹ï¼Œå¾—åˆ°â¼€ä¸ª Hash å€¼ H2 ï¼›\u003c/li\u003e\n\u003cli\u003eæœ€åâ½è¾ƒ H1 å’Œ H2ï¼Œå¦‚æœå€¼ç›¸åŒï¼Œåˆ™ä¸ºå¯ä¿¡èµ–çš„è¯ä¹¦ï¼Œå¦åˆ™åˆ™è®¤ä¸ºè¯ä¹¦ä¸å¯ä¿¡ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHTTPSæŠ“åŒ…ï¼š\u003c/p\u003e\n\u003cp\u003eæŠ“åŒ…å‡ºæ¥éƒ½æ˜¯åŠ å¯†çš„æ•°æ®ï¼ŒæŠ“åŒ…å·¥å…·æ¨¡æ‹Ÿä¸­é—´äººï¼Œä¼ªé€ è¯ä¹¦ï¼Œå®¢æˆ·ç«¯ä¼šæç¤ºè¯ä¹¦ä¸è¢«ä¿¡ä»»ï¼Œå¦‚æœå®¢æˆ·ç«¯åŒæ„ï¼Œè¯·æ±‚å°±ä¼šè¢«æŠ“åŒ…å·¥å…·æ‹¦æˆªï¼Œè½¬å‘ç»™æœåŠ¡ç«¯ã€‚\u003c/p\u003e","title":"HTTPåè®®"},{"content":"æ ‡è®°é‡è¦çš„ä»£ç ç‚¹ åœ¨é˜…è¯»ä»£ç çš„æ—¶å€™ï¼Œæœ‰ä¸€äº›å…³é”®ä»£ç (æ¯”å¦‚æ ¸å¿ƒé€»è¾‘ã€ä»£ç å…¥å£ç­‰)éœ€è¦ç»å¸¸æ‰¾ï¼Œæ‰€ä»¥æˆ‘æƒ³è¦å¤Ÿæ ‡è®°ä¸€ä¸‹ï¼Œè¿™æ ·å°±èƒ½å¿«é€Ÿå®šä½ã€‚\nå¯ä»¥å€ŸåŠ©TODO Treeæ’ä»¶æ ‡è®°todoä¸€æ ·ã€‚è‡ªå®šä¹‰ä¸€ä¸ªIMPORTANT\n\u0026#34;todo-tree.highlights.customHighlight\u0026#34;: { ... \u0026#34;IMPORTANT\u0026#34;: { \u0026#34;background\u0026#34;: \u0026#34;#ff000080\u0026#34; } }, ä½¿ç”¨çš„æ—¶å€™åƒè¿™æ ·å°±èƒ½å¤Ÿåœ¨TODO treeé‡Œé¢çœ‹åˆ°äº†ã€‚\n// IMPORTANT: æœ¬åœ°æµé‡å…¥å£ listener.ReCreateHTTP(general.Port, tunnel.Tunnel) å…‰æ ‡ç§»åŠ¨æ›´åŠ é¡ºæ»‘ { \u0026#34;editor.smoothScrolling\u0026#34;: true, \u0026#34;editor.cursorBlinking\u0026#34;: \u0026#34;smooth\u0026#34;, } ","permalink":"https://carlos19960601.github.io/posts/vscode%E4%BD%BF%E7%94%A8%E5%B0%8F%E6%8A%80%E5%B7%A7/","summary":"\u003ch3 id=\"æ ‡è®°é‡è¦çš„ä»£ç ç‚¹\"\u003eæ ‡è®°é‡è¦çš„ä»£ç ç‚¹\u003c/h3\u003e\n\u003cp\u003eåœ¨é˜…è¯»ä»£ç çš„æ—¶å€™ï¼Œæœ‰ä¸€äº›å…³é”®ä»£ç (æ¯”å¦‚æ ¸å¿ƒé€»è¾‘ã€ä»£ç å…¥å£ç­‰)éœ€è¦ç»å¸¸æ‰¾ï¼Œæ‰€ä»¥æˆ‘æƒ³è¦å¤Ÿæ ‡è®°ä¸€ä¸‹ï¼Œè¿™æ ·å°±èƒ½å¿«é€Ÿå®šä½ã€‚\u003c/p\u003e\n\u003cp\u003eå¯ä»¥å€ŸåŠ©\u003ccode\u003eTODO Tree\u003c/code\u003eæ’ä»¶æ ‡è®°todoä¸€æ ·ã€‚è‡ªå®šä¹‰ä¸€ä¸ª\u003ccode\u003eIMPORTANT\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;todo-tree.highlights.customHighlight\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e\u0026#34;IMPORTANT\u0026#34;\u003c/span\u003e: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#f92672\"\u003e\u0026#34;background\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;#ff000080\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  }\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½¿ç”¨çš„æ—¶å€™åƒè¿™æ ·å°±èƒ½å¤Ÿåœ¨\u003ccode\u003eTODO tree\u003c/code\u003eé‡Œé¢çœ‹åˆ°äº†ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// IMPORTANT: æœ¬åœ°æµé‡å…¥å£\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003elistener\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eReCreateHTTP\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003egeneral\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ePort\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003etunnel\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eTunnel\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"å…‰æ ‡ç§»åŠ¨æ›´åŠ é¡ºæ»‘\"\u003eå…‰æ ‡ç§»åŠ¨æ›´åŠ é¡ºæ»‘\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;editor.smoothScrolling\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e\u0026#34;editor.cursorBlinking\u0026#34;\u003c/span\u003e: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;smooth\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"Vscodeä½¿ç”¨å°æŠ€å·§"},{"content":"Chapter 1: The Machine Learning Landscape æœºå™¨å­¦ä¹ åˆ†ç±»ï¼š\næ˜¯å¦ç›‘ç£\nç›‘ç£å­¦ä¹ (Supervised learning) éç›‘ç£å­¦ä¹ (Unsupervised learning) åŠç›‘ç£å­¦ä¹ (Semi-supervised learning) è‡ªç›‘ç£å­¦ä¹ (Self-supervised learning) å¼ºåŒ–å­¦ä¹ (Reinforcement learning) æ‰¹é‡vsåœ¨çº¿å­¦ä¹ \nBatch learning Online learning Instance-Based Versus Model-Based Learning\nInstance-based learning Model-based learning and a typical machine learning workflow æœºå™¨å­¦ä¹ çš„ä¸»è¦æŒ‘æˆ˜\nè®­ç»ƒæ•°æ®é‡ä¸è¶³(Insufficient Quantity of Training Data) éä»£è¡¨æ€§è®­ç»ƒæ•°æ®(Nonrepresentative Training Data) åŠ£è´¨æ•°æ®(Poor-Quality Data) ä¸ç›¸å…³ç‰¹å¾(Irrelevant Features) è¿‡æ‹Ÿåˆ(Overfitting the Training Data) æ¬ æ‹Ÿåˆ(Underfitting the Training Data) Chapter 2: End-to-End Machine Learning Project é€šè¿‡ä¸€ä¸ªé¢„æµ‹æˆ¿ä»·çš„å®ä¾‹ä»‹ç»æœºå™¨å­¦ä¹ å®è·µæµç¨‹ã€‚\nå‰ææ˜¯æ˜ç¡®éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œç°åœ¨æ‰‹é‡Œæœ‰ä¸€ä»½æ•°æ®ã€‚æ€ä¹ˆå¼€å§‹è¿›è¡Œæœºå™¨å­¦ä¹ ã€‚\né¦–å…ˆäº†è§£æ•°æ®ï¼Œæ•´ä½“ç†Ÿæ‚‰æ•°æ®ç»“æ„ã€‚ pandaæŸ¥çœ‹æ•°æ®ç»Ÿè®¡ matplotlibç»˜åˆ¶å›¾æ ‡ åˆ›å»ºæµ‹è¯•é›† åˆ†å±‚æŠ½æ · æµ‹è¯•é›†ä¸è¦åœ¨è®­ç»ƒé˜¶æ®µä½¿ç”¨ æŠ½æ ·è¦éšæœº ç»“æœè¦ä¿æŒä¸€è‡´ï¼Œä¸è¦å¤šæ¬¡åˆ›å»ºæµ‹è¯•é›†åï¼Œè®©æ¨¡å‹å­¦ä¹ äº†æ‰€æœ‰æ•°æ® çœ‹çœ‹æ•°æ®åˆ†å¸ƒ çœ‹çœ‹ç›¸å…³æ€§(Correlations) å°è¯•ç»„åˆç‰¹å¾ æ•°æ®é¢„å¤„ç† ç¼ºå¤±å€¼è¡¥é½ å¤„ç†åˆ†ç±»æ•°æ® ç‰¹å¾ç¼©æ”¾ é€‰æ‹©å’Œè®­ç»ƒæ¨¡å‹ å°è¯•ä¸åŒçš„æ¨¡å‹ äº¤å‰éªŒè¯ä¸åŒæ¨¡å‹çš„æ•ˆæœ å¾®è°ƒæ¨¡å‹ Grid Search Randomized Search åˆ†ææ¨¡å‹å’Œé”™è¯¯ åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹ ä¸Šçº¿æ¨¡å‹ Chapter 3: Classification é€šè¿‡ä¸€ä¸ªè¯†åˆ«æ‰‹å†™æ•°å­—çš„å®ä¾‹ä»‹ç»åˆ†ç±»ã€‚\nè¯†åˆ«æ‰‹å†™æ•°å­—å’Œé¢„æµ‹æˆ¿ä»·ä¸åŒçš„åœ°æ–¹åœ¨äºPerformance Measuresã€‚é¢„æµ‹æˆ¿ä»·ä½¿ç”¨æ˜¯é€šå“ŸRMSE(root mean squred error)ã€‚è¯†åˆ«æ‰‹å†™æ•°å­—è¿™é‡Œä½¿ç”¨è¿™ç§æ–¹å¼å°±ä¼šæœ‰è¯¯å¯¼ã€‚\næ··æ·†çŸ©é˜µ(Confusion Matrices) å‡†ç¡®ç‡å’Œå¬å›ç‡(Precision and Recall) ROCç¼ºé™·(The ROC Curve) åˆ†ç±»åˆå¯ä»¥åˆ†ä¸ºå¤šç§\nMulticlass Classification Multilabel Classification Multioutput Classification Chapter 4: Training Models ","permalink":"https://carlos19960601.github.io/posts/hands-on-machine-learning-with-scikit-learn-keras-and-tensorflow-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","summary":"\u003ch1 id=\"chapter-1-the-machine-learning-landscape\"\u003eChapter 1: The Machine Learning Landscape\u003c/h1\u003e\n\u003cp\u003eæœºå™¨å­¦ä¹ åˆ†ç±»ï¼š\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæ˜¯å¦ç›‘ç£\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç›‘ç£å­¦ä¹ (Supervised learning)\u003c/li\u003e\n\u003cli\u003eéç›‘ç£å­¦ä¹ (Unsupervised learning)\u003c/li\u003e\n\u003cli\u003eåŠç›‘ç£å­¦ä¹ (Semi-supervised learning)\u003c/li\u003e\n\u003cli\u003eè‡ªç›‘ç£å­¦ä¹ (Self-supervised learning)\u003c/li\u003e\n\u003cli\u003eå¼ºåŒ–å­¦ä¹ (Reinforcement learning)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eæ‰¹é‡vsåœ¨çº¿å­¦ä¹ \u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBatch learning\u003c/li\u003e\n\u003cli\u003eOnline learning\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eInstance-Based Versus Model-Based Learning\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eInstance-based learning\u003c/li\u003e\n\u003cli\u003eModel-based learning and a typical machine learning workflow\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæœºå™¨å­¦ä¹ çš„ä¸»è¦æŒ‘æˆ˜\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè®­ç»ƒæ•°æ®é‡ä¸è¶³(Insufficient Quantity of Training Data)\u003c/li\u003e\n\u003cli\u003eéä»£è¡¨æ€§è®­ç»ƒæ•°æ®(Nonrepresentative Training Data)\u003c/li\u003e\n\u003cli\u003eåŠ£è´¨æ•°æ®(Poor-Quality Data)\u003c/li\u003e\n\u003cli\u003eä¸ç›¸å…³ç‰¹å¾(Irrelevant Features)\u003c/li\u003e\n\u003cli\u003eè¿‡æ‹Ÿåˆ(Overfitting the Training Data)\u003c/li\u003e\n\u003cli\u003eæ¬ æ‹Ÿåˆ(Underfitting the Training Data)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"chapter-2-end-to-end-machine-learning-project\"\u003eChapter 2: End-to-End Machine Learning Project\u003c/h1\u003e\n\u003cp\u003eé€šè¿‡ä¸€ä¸ªé¢„æµ‹æˆ¿ä»·çš„å®ä¾‹ä»‹ç»æœºå™¨å­¦ä¹ å®è·µæµç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eå‰ææ˜¯æ˜ç¡®éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œç°åœ¨æ‰‹é‡Œæœ‰ä¸€ä»½æ•°æ®ã€‚æ€ä¹ˆå¼€å§‹è¿›è¡Œæœºå™¨å­¦ä¹ ã€‚\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eé¦–å…ˆäº†è§£æ•°æ®ï¼Œæ•´ä½“ç†Ÿæ‚‰æ•°æ®ç»“æ„ã€‚\n\u003col\u003e\n\u003cli\u003epandaæŸ¥çœ‹æ•°æ®ç»Ÿè®¡\u003c/li\u003e\n\u003cli\u003ematplotlibç»˜åˆ¶å›¾æ ‡\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eåˆ›å»ºæµ‹è¯•é›†\n\u003col\u003e\n\u003cli\u003eåˆ†å±‚æŠ½æ ·\u003c/li\u003e\n\u003cli\u003eæµ‹è¯•é›†ä¸è¦åœ¨è®­ç»ƒé˜¶æ®µä½¿ç”¨\u003c/li\u003e\n\u003cli\u003eæŠ½æ ·è¦éšæœº\u003c/li\u003e\n\u003cli\u003eç»“æœè¦ä¿æŒä¸€è‡´ï¼Œä¸è¦å¤šæ¬¡åˆ›å»ºæµ‹è¯•é›†åï¼Œè®©æ¨¡å‹å­¦ä¹ äº†æ‰€æœ‰æ•°æ®\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eçœ‹çœ‹æ•°æ®åˆ†å¸ƒ\n\u003col\u003e\n\u003cli\u003eçœ‹çœ‹ç›¸å…³æ€§(Correlations)\u003c/li\u003e\n\u003cli\u003eå°è¯•ç»„åˆç‰¹å¾\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eæ•°æ®é¢„å¤„ç†\n\u003col\u003e\n\u003cli\u003eç¼ºå¤±å€¼è¡¥é½\u003c/li\u003e\n\u003cli\u003eå¤„ç†åˆ†ç±»æ•°æ®\u003c/li\u003e\n\u003cli\u003eç‰¹å¾ç¼©æ”¾\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eé€‰æ‹©å’Œè®­ç»ƒæ¨¡å‹\n\u003col\u003e\n\u003cli\u003eå°è¯•ä¸åŒçš„æ¨¡å‹\u003c/li\u003e\n\u003cli\u003eäº¤å‰éªŒè¯ä¸åŒæ¨¡å‹çš„æ•ˆæœ\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eå¾®è°ƒæ¨¡å‹\n\u003col\u003e\n\u003cli\u003eGrid Search\u003c/li\u003e\n\u003cli\u003eRandomized Search\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eåˆ†ææ¨¡å‹å’Œé”™è¯¯\u003c/li\u003e\n\u003cli\u003eåœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹\u003c/li\u003e\n\u003cli\u003eä¸Šçº¿æ¨¡å‹\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"chapter-3-classification\"\u003eChapter 3: Classification\u003c/h1\u003e\n\u003cp\u003eé€šè¿‡ä¸€ä¸ªè¯†åˆ«æ‰‹å†™æ•°å­—çš„å®ä¾‹ä»‹ç»åˆ†ç±»ã€‚\u003c/p\u003e","title":"Hands on Machine Learning With Scikit Learn, Keras, and TensorFlow å­¦ä¹ ç¬”è®°"},{"content":"èƒŒæ™¯ æœ€è¿‘åœ¨å†™é¡¹ç›®çš„æ—¶å€™ï¼Œå‘ç°å¦‚æœåç«¯æ²¡æœ‰å¤„ç†CORSçš„é—®é¢˜ï¼Œå‰ç«¯ä½¿ç”¨Axiosè¯·æ±‚æ•°æ®çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠ¥Axios Network Errorã€‚å½±å“äº†å¼€å‘ã€‚\nè§£å†³ ä¸€èˆ¬æƒ…å†µä¸‹åç«¯æœåŠ¡éƒ½ä¼šæœ‰CORS middlewareã€‚èƒ½å¤Ÿç›´æ¥è§£å†³CORSçš„é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœæ¯ä¸ªæœåŠ¡éƒ½è¿™æ ·ï¼Œæˆ‘è§‰å¾—éº»çƒ¦ã€‚æ‰€ä»¥å°è¯•ä½¿ç”¨Nginxæ¥åŒæ ·å¤„ç†ã€‚\nè·¨åŸŸç›¸å…³çš„å“åº”å¤´\nAccess-Control-Allow-Origin: Used to set the source address that allows cross-domain requests (preflight requests and formal requests will be verified when cross-domain) Access-Control-Allow-Headers: Special header information fields allowed to be carried across domains (only verified in preflight requests) Access-Control-Allow-Methods: Cross-domain allowed request methods or HTTP verbs (only in preflight request verification) Access-Control-Allow-Credentials: Whether to allow the use of cookies across domains. If you want to use cookies across domains, you can add this request response header and set the value to true (setting it or not setting it will not affect the sending of the request, but will only affect whether cookies should be carried across domains. , but if set, both preflight requests and formal requests need to be set). However, it is not recommended to use it cross-domain (it has been used in the project, but it is unstable and cannot be carried by some browsers) unless necessary, because there are many alternatives. å¦‚æœå‡ºç°è·¨åŸŸï¼Œç›´æ¥åœ¨å‰ç«¯è¯·æ±‚ä¼šæŠ¥é”™\nAccess to XMLHttpRequest at \u0026#39;http://localhost:22222/api/Login/TestGet\u0026#39; from origin \u0026#39;http://localhost:8080\u0026#39; has been blocked by CORS policy: Response to preflight request doesn\u0026#39;t pass access control check: No \u0026#39;Access-Control-Allow-Origin\u0026#39; header is present on the requested resource. è·¨åŸŸæœºåˆ¶ä¼šè®©æµè§ˆå™¨å‘é€ä¸€ä¸ªOPTIONSçš„preflightè¯·æ±‚ï¼Œåªæœ‰è¿™ä¸ªè¯·æ±‚æˆåŠŸåï¼Œåç»­æ‰ä¼šå‘é€æ­£å¸¸çš„è¯·æ±‚ã€‚\nä»æŠ¥é”™ä¿¡æ¯ç§å¯ä»¥çœ‹å‡º preflight è¯·æ±‚ç§ç¼ºå°‘\u0026rsquo;Access-Control-Allow-Origin\u0026rsquo;è¿™ä¸ªheaderã€‚æˆ‘ä»¬åœ¨Nginxä¸­æ·»åŠ ä¸Šè¿™ä¸ªheader\nlocation / { add_header Access-Control-Allow-Origin $http_origin; } ä½†æ˜¯åŠ ä¸Šåä»ç„¶æŠ¥ç›¸åŒçš„é”™è¯¯ã€‚\nå‚è€ƒadd_header Directivesçš„æ–‡æ¡£ã€‚åªæœ‰è¿”å›å¯¹åº”çš„http status codeçš„æ—¶å€™ï¼Œæ‰ä¼šæ‰§è¡Œadd_headeræŒ‡ä»¤ã€‚å¦‚æœæƒ³ç›´æ¥æ·»åŠ éœ€è¦æ·»åŠ alwaysã€‚\nlocation / { add_header Access-Control-Allow-Origin $http_origin always; } è¿™æ¬¡é”™è¯¯ä¸å†æ˜¯ä¹‹å‰çš„é”™è¯¯äº†ï¼Œä½†æ˜¯å‡ºç°äº†æ–°çš„é”™è¯¯\nAccess to XMLHttpRequest at \u0026#39;http://api.admin.collie.io/v1/vocabulary/search?keyword=\u0026#39; from origin \u0026#39;http://localhost:3000\u0026#39; has been blocked by CORS policy: Response to preflight request doesn\u0026#39;t pass access control check: It does not have HTTP ok status. ä»é”™è¯¯ä¿¡æ¯ç§å¯ä»¥çŸ¥é“preflightè¯·æ±‚æ²¡æœ‰æ”¶åˆ°HTTP ok status. æ‰€ä»¥ä¿®æ”¹ä¸€ä¸‹é…ç½®\nlocation / { add_header Access-Control-Allow-Origin $http_origin always; if ($request_method = \u0026#39;OPTIONS\u0026#39;) { return 204; } } åŠ ä¸Šä¹‹åï¼Œé”™è¯¯åˆå‘ç”Ÿå˜åŒ–äº†ã€‚authorizationè¿™ä¸ªheaderæ²¡æœ‰æ·»åŠ åˆ°Access-Control-Allow-Headersé‡Œé¢ã€‚è¿™ä¸ªæ˜¯è·¨åŸŸæœºåˆ¶ä¿è¯å®‰å…¨ï¼Œåœ¨preflightè¯·æ±‚ä¸­æ”¶åˆ°çš„Access-Control-Allow-Headersä¸­è®¾ç½®çš„headeræ‰èƒ½åç»­æ­£å¸¸çš„è¯·æ±‚ä¸­å‘é€ç»™æœåŠ¡å™¨ã€‚\nccess to XMLHttpRequest at \u0026#39;http://api.admin.collie.io/v1/vocabulary/search?keyword=\u0026#39; from origin \u0026#39;http://localhost:3000\u0026#39; has been blocked by CORS policy: Request header field authorization is not allowed by Access-Control-Allow-Headers in preflight response. ç»§ç»­ä¿®æ”¹ä¸€ä¸‹é…ç½®\nlocation / { add_header Access-Control-Allow-Origin $http_origin always; if ($request_method = \u0026#39;OPTIONS\u0026#39;) { add_header Access-Control-Allow-Headers \u0026#39;*\u0026#39;; #ä¸ºä»€ä¹ˆå†™åœ¨ifé‡Œé¢è€Œä¸æ˜¯æ¥ç€Access-Control-Allow-Originå¾€ä¸‹å†™ï¼Ÿå› ä¸ºè¿™é‡Œåªæœ‰é¢„æ£€è¯·æ±‚æ‰ä¼šæ£€æŸ¥ return 204; } } å¦‚æœè¿™ä¹ˆé…ç½®ä½ ä¼šå‘ç°ï¼Œæœ‰ä¼šå‡ºç°æœ€å¼€å§‹çš„é‚£ä¸ªé”™è¯¯\nAccess to XMLHttpRequest at \u0026#39;http://api.admin.collie.io/v1/vocabulary/search?keyword=\u0026#39; from origin \u0026#39;http://localhost:3000\u0026#39; has been blocked by CORS policy: Response to preflight request doesn\u0026#39;t pass access control check: No \u0026#39;Access-Control-Allow-Origin\u0026#39; header is present on the requested resource. åœ¨Nginxçš„æ–‡æ¡£ä¸­æ˜¯è¿™ä¹ˆæè¿°çš„\nThere could be several add_header directives. These directives are inherited from the previous configuration level if and only if there are no add_header directives defined on the current level.\næ‰€ä»¥å¦‚æœåœ¨åŒä¸€çº§ä¸‹æœ‰äº†add_headeræŒ‡ä»¤ï¼Œå°±ä¸ä¼šç»§æ‰¿ä¸Šä¸€çº§çš„add_headeræŒ‡ä»¤äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŒ‰ç…§ä¸Šé¢è¿™æ ·é…ç½®Access-Control-Allow-Originå°±ä¼šæ²¡æœ‰ï¼Œå‡ºç°æœ€å¼€å§‹çš„è¿™ä¸ªé”™è¯¯ã€‚\nåç»­è¿˜æ˜¯ä¼šå‡ºç°å…¶ä»–é”™è¯¯ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ·»åŠ Access-Control-Allow-Methodsã€Access-Control-Allow-Headersè¿™äº›é—®é¢˜å°±ä¸å†ç»§ç»­ä¸‹å»äº†ã€‚\næœ€åå°±æ˜¯æˆ‘æœ€åçš„Nginxçš„é…ç½®\nlocation / { add_header Access-Control-Allow-Origin $http_origin always; add_header Access-Control-Allow-Credentials \u0026#39;true\u0026#39;; add_header Access-Control-Allow-Methods \u0026#39;*\u0026#39;; add_header Access-Control-Allow-Headers \u0026#39;*\u0026#39;; if ($request_method = \u0026#39;OPTIONS\u0026#39;) { return 204; } } å‚è€ƒæ–‡æ¡£ Nginx easily solves cross-domain issues ","permalink":"https://carlos19960601.github.io/posts/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%B7%A8%E5%9F%9F/","summary":"\u003ch3 id=\"èƒŒæ™¯\"\u003eèƒŒæ™¯\u003c/h3\u003e\n\u003cp\u003eæœ€è¿‘åœ¨å†™é¡¹ç›®çš„æ—¶å€™ï¼Œå‘ç°å¦‚æœåç«¯æ²¡æœ‰å¤„ç†CORSçš„é—®é¢˜ï¼Œå‰ç«¯ä½¿ç”¨Axiosè¯·æ±‚æ•°æ®çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŠ¥Axios Network Errorã€‚å½±å“äº†å¼€å‘ã€‚\u003c/p\u003e\n\u003ch3 id=\"è§£å†³\"\u003eè§£å†³\u003c/h3\u003e\n\u003cp\u003eä¸€èˆ¬æƒ…å†µä¸‹åç«¯æœåŠ¡éƒ½ä¼šæœ‰CORS middlewareã€‚èƒ½å¤Ÿç›´æ¥è§£å†³CORSçš„é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœæ¯ä¸ªæœåŠ¡éƒ½è¿™æ ·ï¼Œæˆ‘è§‰å¾—éº»çƒ¦ã€‚æ‰€ä»¥å°è¯•ä½¿ç”¨Nginxæ¥åŒæ ·å¤„ç†ã€‚\u003c/p\u003e\n\u003cp\u003eè·¨åŸŸç›¸å…³çš„å“åº”å¤´\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eAccess-Control-Allow-Origin\u003c/strong\u003e: Used to set the source address that allows cross-domain requests (preflight requests and formal requests will be verified when cross-domain)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAccess-Control-Allow-Headers\u003c/strong\u003e: Special header information fields allowed to be carried across domains (only verified in preflight requests)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAccess-Control-Allow-Methods\u003c/strong\u003e: Cross-domain allowed request methods or HTTP verbs (only in preflight request verification)\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAccess-Control-Allow-Credentials\u003c/strong\u003e: Whether to allow the use of cookies across domains. If you want to use cookies across domains, you can add this request response header and set the value to true (setting it or not setting it will not affect the sending of the request, but will only affect whether cookies should be carried across domains. , but if set, both preflight requests and formal requests need to be set). However, it is not recommended to use it cross-domain (it has been used in the project, but it is unstable and cannot be carried by some browsers) unless necessary, because there are many alternatives.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¦‚æœå‡ºç°è·¨åŸŸï¼Œç›´æ¥åœ¨å‰ç«¯è¯·æ±‚ä¼šæŠ¥é”™\u003c/p\u003e","title":"æµè§ˆå™¨è·¨åŸŸ"},{"content":"æ•°æ®åº“ Count(*)ã€Count(1)ã€Count(0)ã€Count(id)ã€Count(name)ä¹‹é—´çš„åŒºåˆ«? Countéƒ½ä¼šè¿›è¡Œä¸€æ¬¡å…¨è¡¨ä¾¿åˆ©ï¼ŒCount(*)ã€Count(1)ã€Count(0)ä¸ä¼šä»åº•å±‚è·å–æ•°æ®ï¼Œç›´æ¥è¿›è¡Œcount++ã€‚ä½†æ˜¯idå’Œnameä¼šä»åº•å±‚è·å–æ•°æ®è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸ºnullæ‰è¿›è¡Œcount++ã€‚æ­¤å¤–MySQLä¼šå€ŸåŠ©å ç”¨é¡µæœ€å°çš„ç´¢å¼•è¿›è¡Œéå†ã€‚\nç³»ç»Ÿè®¾è®¡ æ€ä¹ˆé¿å…å•ç‚¹æ•…éšœ(SPOFã€Single Point of Failure)ï¼Ÿ Redundancy(å†—ä½™): Primary vs Standbyï¼Œæ¯”å¦‚æµé‡å…¥å£ï¼Œload banlanerè¿›è¡Œä¸»å¤‡ Load Balancing(è´Ÿè½½å‡è¡¡) Data Replication(æ•°æ®å¤åˆ¶): æ•°æ®åº“ã€ç¼“å­˜çš„ä¸»ä» Geographic Distributio(å¼‚åœ°å¤šæ´»)ï¼šå¼‚åœ°å¤šé›†ç¾¤çš„æ•°æ®å¤åˆ¶ï¼ˆåŒæ­¥æˆ–å¼‚æ­¥ï¼‰ Graceful Handling of Failures Monitoring and Alerting æŠ€æœ¯é€‰å‹ SQL vs NoSQL æ•°æ®æ¨¡å‹: schema vs schema-less(Key-Value Model, Document Model, Column-Family Model, Graph Model ) æ‰©å±•æ€§: å‚ç›´æ‰©å±• vs æ°´å¹³æ‰©å±• æŸ¥è¯¢è¯­è¨€ï¼šSQL vs æ— å›ºå®šæ ‡å‡† äº‹åŠ¡ï¼šACID vs BASE æ€§èƒ½ï¼šå¯¹Schemaæ˜ç¡®ï¼ŒæŸ¥è¯¢æ¨¡å¼å›ºå®šçš„æ–¹å¼ï¼ŒSQLæŸ¥è¯¢æ•ˆç‡é«˜ å…·ä½“ç³»ç»Ÿè®¾è®¡Blog Design Spotify - System Design Interview Design a Scalable Notification Service - System Design Interview å‚è€ƒèµ„æ–™ éº»çƒ¦ä¸è¦å†é—®æˆ‘count(*)ã€count(1)ã€count(id)ã€count(name)ä¹‹é—´çš„åŒºåˆ«äº† System Design: How to Avoid Single Point of Failures? SQL vs NoSQL - 7 Key Differences You Must Know ç½‘ç»œåè®® DNS å®Œæ•´æŸ¥è¯¢è¿‡ç¨‹? DNS æŸ¥è¯¢è¯·æ±‚è¿‡ç¨‹å’ŒåŸŸåç¼“å­˜ç»“åˆèµ·æ¥ï¼Œå®Œæ•´æŸ¥è¯¢è¿‡ç¨‹ğŸ‘‡ï¼š\né¦–å…ˆæœç´¢ æµè§ˆå™¨çš„ DNS ç¼“å­˜ ï¼Œç¼“å­˜ä¸­ç»´æŠ¤ä¸€å¼ åŸŸåä¸ IP åœ°å€çš„å¯¹åº”è¡¨ å¦‚æœæ²¡æœ‰å‘½ä¸­ğŸ˜¢ï¼Œåˆ™ç»§ç»­æœç´¢ æ“ä½œç³»ç»Ÿçš„ DNS ç¼“å­˜ å¦‚æœä¾ç„¶æ²¡æœ‰å‘½ä¸­ğŸ¤¦â€â™€ï¸ï¼Œåˆ™æ“ä½œç³»ç»Ÿå°†åŸŸåå‘é€è‡³ æœ¬åœ°åŸŸåæœåŠ¡å™¨ ï¼Œæœ¬åœ°åŸŸåæœåŠ¡å™¨æŸ¥è¯¢è‡ªå·±çš„ DNS ç¼“å­˜ï¼ŒæŸ¥æ‰¾æˆåŠŸåˆ™è¿”å›ç»“æœï¼ˆæ³¨æ„ï¼šä¸»æœºå’Œæœ¬åœ°åŸŸåæœåŠ¡å™¨ä¹‹é—´çš„æŸ¥è¯¢æ–¹å¼æ˜¯ é€’å½’æŸ¥è¯¢ ï¼‰ è‹¥æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„ DNS ç¼“å­˜æ²¡æœ‰å‘½ä¸­ğŸ¤¦â€ï¼Œåˆ™æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘ä¸Šçº§åŸŸåæœåŠ¡å™¨è¿›è¡ŒæŸ¥è¯¢ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œ è¿­ä»£æŸ¥è¯¢ ï¼ˆæ³¨æ„ï¼šæœ¬åœ°åŸŸåæœåŠ¡å™¨å’Œå…¶ä»–åŸŸåæœåŠ¡å™¨ä¹‹é—´çš„æŸ¥è¯¢æ–¹å¼æ˜¯è¿­ä»£æŸ¥è¯¢ï¼Œé˜²æ­¢æ ¹åŸŸåæœåŠ¡å™¨å‹åŠ›è¿‡å¤§ï¼‰ï¼š é¦–å…ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œæ ¹åŸŸåæœåŠ¡å™¨æ˜¯æœ€é«˜å±‚æ¬¡çš„ï¼Œå®ƒå¹¶ä¸ä¼šç›´æ¥æŒ‡æ˜è¿™ä¸ªåŸŸåå¯¹åº”çš„ IP åœ°å€ï¼Œè€Œæ˜¯è¿”å›é¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨æŒ‡æ˜ä¸€æ¡é“è·¯ï¼Œè®©ä»–å»è¿™é‡Œå¯»æ‰¾ç­”æ¡ˆ æœ¬åœ°åŸŸåæœåŠ¡å™¨æ‹¿åˆ°è¿™ä¸ªé¡¶çº§åŸŸåæœåŠ¡å™¨çš„åœ°å€åï¼Œå°±å‘å…¶å‘èµ·è¯·æ±‚ï¼Œè·å–æƒé™åŸŸåæœåŠ¡å™¨çš„åœ°å€ æœ¬åœ°åŸŸåæœåŠ¡å™¨æ ¹æ®æƒé™åŸŸåæœåŠ¡å™¨çš„åœ°å€å‘å…¶å‘èµ·è¯·æ±‚ï¼Œæœ€ç»ˆå¾—åˆ°è¯¥åŸŸåå¯¹åº”çš„ IP åœ°å€ æœ¬åœ°åŸŸåæœåŠ¡å™¨ å°†å¾—åˆ°çš„ IP åœ°å€è¿”å›ç»™æ“ä½œç³»ç»Ÿï¼ŒåŒæ—¶è‡ªå·±å°† IP åœ°å€ ç¼“å­˜ èµ·æ¥ğŸ“ æ“ä½œç³»ç»Ÿ å°† IP åœ°å€è¿”å›ç»™æµè§ˆå™¨ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå°† IP åœ°å€ ç¼“å­˜ èµ·æ¥ğŸ“ è‡³æ­¤ï¼Œ æµè§ˆå™¨ å°±å¾—åˆ°äº†åŸŸåå¯¹åº”çš„ IP åœ°å€ï¼Œå¹¶å°† IP åœ°å€ ç¼“å­˜ èµ·æ¥ğŸ“ TCPå»ºç«‹è¿æ¥(3æ¬¡æ¡æ‰‹)æµç¨‹ ä¸ºä»€ä¹ˆéœ€è¦3æ¬¡ï¼Ÿ ä¸ºäº†é˜²æ­¢æœåŠ¡å™¨ç«¯å¼€å¯ä¸€äº›æ— ç”¨çš„è¿æ¥å¢åŠ æœåŠ¡å™¨å¼€é”€ é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯ã€‚ TCPæ–­å¼€è¿æ¥(4æ¬¡æŒ¥æ‰‹)æµç¨‹ ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯åœ¨TIME-WAITé˜¶æ®µè¦ç­‰2MSLï¼Ÿ ä¸ºçš„æ˜¯ç¡®è®¤æœåŠ¡å™¨ç«¯æ˜¯å¦æ”¶åˆ°å®¢æˆ·ç«¯å‘å‡ºçš„ ACK ç¡®è®¤æŠ¥æ–‡\nå‚è€ƒèµ„æ–™ DNS åè®®æ˜¯ä»€ä¹ˆï¼Ÿå®Œæ•´æŸ¥è¯¢è¿‡ç¨‹ï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨ UDP åè®®å‘èµ· DNS æŸ¥è¯¢ï¼Ÿ â€œä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹â€è¿™ä¹ˆè®²ï¼Œä¿è¯ä½ å¿˜ä¸äº† ","permalink":"https://carlos19960601.github.io/posts/%E9%9D%A2%E8%AF%95/","summary":"\u003ch3 id=\"æ•°æ®åº“\"\u003eæ•°æ®åº“\u003c/h3\u003e\n\u003ch4 id=\"countcount1count0countidcountnameä¹‹é—´çš„åŒºåˆ«\"\u003eCount(*)ã€Count(1)ã€Count(0)ã€Count(id)ã€Count(name)ä¹‹é—´çš„åŒºåˆ«?\u003c/h4\u003e\n\u003cp\u003eCountéƒ½ä¼šè¿›è¡Œä¸€æ¬¡å…¨è¡¨ä¾¿åˆ©ï¼ŒCount(*)ã€Count(1)ã€Count(0)ä¸ä¼šä»åº•å±‚è·å–æ•°æ®ï¼Œç›´æ¥è¿›è¡Œcount++ã€‚ä½†æ˜¯idå’Œnameä¼šä»åº•å±‚è·å–æ•°æ®è¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸ºnullæ‰è¿›è¡Œcount++ã€‚æ­¤å¤–MySQLä¼šå€ŸåŠ©å ç”¨é¡µæœ€å°çš„ç´¢å¼•è¿›è¡Œéå†ã€‚\u003c/p\u003e\n\u003ch3 id=\"ç³»ç»Ÿè®¾è®¡\"\u003eç³»ç»Ÿè®¾è®¡\u003c/h3\u003e\n\u003ch4 id=\"æ€ä¹ˆé¿å…å•ç‚¹æ•…éšœspofsingle-point-of-failure\"\u003eæ€ä¹ˆé¿å…å•ç‚¹æ•…éšœ(SPOFã€Single Point of Failure)ï¼Ÿ\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eRedundancy(å†—ä½™): Primary vs Standbyï¼Œæ¯”å¦‚æµé‡å…¥å£ï¼Œload banlanerè¿›è¡Œä¸»å¤‡\u003c/li\u003e\n\u003cli\u003eLoad Balancing(è´Ÿè½½å‡è¡¡)\u003c/li\u003e\n\u003cli\u003eData Replication(æ•°æ®å¤åˆ¶): æ•°æ®åº“ã€ç¼“å­˜çš„ä¸»ä»\u003c/li\u003e\n\u003cli\u003eGeographic Distributio(å¼‚åœ°å¤šæ´»)ï¼šå¼‚åœ°å¤šé›†ç¾¤çš„æ•°æ®å¤åˆ¶ï¼ˆåŒæ­¥æˆ–å¼‚æ­¥ï¼‰\u003c/li\u003e\n\u003cli\u003eGraceful Handling of Failures\u003c/li\u003e\n\u003cli\u003eMonitoring and Alerting\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"æŠ€æœ¯é€‰å‹\"\u003eæŠ€æœ¯é€‰å‹\u003c/h3\u003e\n\u003ch4 id=\"sql-vs-nosql\"\u003eSQL vs NoSQL\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eæ•°æ®æ¨¡å‹: schema vs schema-less(Key-Value Model, Document Model, Column-Family Model, Graph Model )\u003c/li\u003e\n\u003cli\u003eæ‰©å±•æ€§: å‚ç›´æ‰©å±• vs æ°´å¹³æ‰©å±•\u003c/li\u003e\n\u003cli\u003eæŸ¥è¯¢è¯­è¨€ï¼šSQL vs æ— å›ºå®šæ ‡å‡†\u003c/li\u003e\n\u003cli\u003eäº‹åŠ¡ï¼šACID vs BASE\u003c/li\u003e\n\u003cli\u003eæ€§èƒ½ï¼šå¯¹Schemaæ˜ç¡®ï¼ŒæŸ¥è¯¢æ¨¡å¼å›ºå®šçš„æ–¹å¼ï¼ŒSQLæŸ¥è¯¢æ•ˆç‡é«˜\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e9%9d%a2%e8%af%95/SQLvsNoSQL.png\" alt=\"SQL vs NoSQL\"  /\u003e\n\u003c/p\u003e\n\u003ch4 id=\"å…·ä½“ç³»ç»Ÿè®¾è®¡blog\"\u003eå…·ä½“ç³»ç»Ÿè®¾è®¡Blog\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://blog.algomaster.io/p/design-spotify-system-design-interview\"\u003eDesign Spotify - System Design Interview\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.algomaster.io/p/design-a-scalable-notification-service\"\u003eDesign a Scalable Notification Service - System Design Interview\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"å‚è€ƒèµ„æ–™\"\u003eå‚è€ƒèµ„æ–™\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://juejin.cn/post/7397410962847039525\"\u003eéº»çƒ¦ä¸è¦å†é—®æˆ‘count(*)ã€count(1)ã€count(id)ã€count(name)ä¹‹é—´çš„åŒºåˆ«äº†\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.algomaster.io/p/system-design-how-to-avoid-single-point-of-failures\"\u003eSystem Design: How to Avoid Single Point of Failures?\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.algomaster.io/p/sql-vs-nosql-7-key-differences\"\u003eSQL vs NoSQL - 7 Key Differences You Must Know\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ç½‘ç»œåè®®\"\u003eç½‘ç»œåè®®\u003c/h3\u003e\n\u003ch4 id=\"dns-å®Œæ•´æŸ¥è¯¢è¿‡ç¨‹\"\u003eDNS å®Œæ•´æŸ¥è¯¢è¿‡ç¨‹?\u003c/h4\u003e\n\u003cp\u003eDNS æŸ¥è¯¢è¯·æ±‚è¿‡ç¨‹å’ŒåŸŸåç¼“å­˜ç»“åˆèµ·æ¥ï¼Œå®Œæ•´æŸ¥è¯¢è¿‡ç¨‹ğŸ‘‡ï¼š\u003c/p\u003e","title":"é¢è¯•"},{"content":"commit æ¶ˆæ¯æäº¤è§„èŒƒ feat: æ–°åŠŸèƒ½ï¼ˆfeatureï¼‰\nç”¨äºæäº¤æ–°åŠŸèƒ½ã€‚ ä¾‹å¦‚ï¼šfeat: å¢åŠ ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ fix: ä¿®å¤ bug\nç”¨äºæäº¤ bug ä¿®å¤ã€‚ ä¾‹å¦‚ï¼šfix: ä¿®å¤ç™»å½•é¡µé¢å´©æºƒçš„é—®é¢˜ docs: æ–‡æ¡£å˜æ›´\nç”¨äºæäº¤ä»…æ–‡æ¡£ç›¸å…³çš„ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼šdocs: æ›´æ–°READMEæ–‡ä»¶ style: ä»£ç é£æ ¼å˜åŠ¨ï¼ˆä¸å½±å“ä»£ç é€»è¾‘ï¼‰\nç”¨äºæäº¤ä»…æ ¼å¼åŒ–ã€æ ‡ç‚¹ç¬¦å·ã€ç©ºç™½ç­‰ä¸å½±å“ä»£ç è¿è¡Œçš„å˜æ›´ã€‚ ä¾‹å¦‚ï¼šstyle: åˆ é™¤å¤šä½™çš„ç©ºè¡Œ refactor: ä»£ç é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°å¢åŠŸèƒ½ä¹Ÿä¸æ˜¯ä¿®å¤bugçš„ä»£ç æ›´æ”¹ï¼‰\nç”¨äºæäº¤ä»£ç é‡æ„ã€‚ ä¾‹å¦‚ï¼šrefactor: é‡æ„ç”¨æˆ·éªŒè¯é€»è¾‘ perf: æ€§èƒ½ä¼˜åŒ–\nç”¨äºæäº¤æå‡æ€§èƒ½çš„ä»£ç ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼šperf: ä¼˜åŒ–å›¾ç‰‡åŠ è½½é€Ÿåº¦ test: æ·»åŠ æˆ–ä¿®æ”¹æµ‹è¯•\nç”¨äºæäº¤æµ‹è¯•ç›¸å…³çš„å†…å®¹ã€‚ ä¾‹å¦‚ï¼štest: å¢åŠ ç”¨æˆ·æ¨¡å—çš„å•å…ƒæµ‹è¯• chore: æ‚é¡¹ï¼ˆæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ï¼‰\nç”¨äºæäº¤æ„å»ºè¿‡ç¨‹ã€è¾…åŠ©å·¥å…·ç­‰ç›¸å…³çš„å†…å®¹ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼šchore: æ›´æ–°ä¾èµ–åº“ build: æ„å»ºç³»ç»Ÿæˆ–å¤–éƒ¨ä¾èµ–é¡¹çš„å˜æ›´\nç”¨äºæäº¤å½±å“æ„å»ºç³»ç»Ÿçš„æ›´æ”¹ã€‚ ä¾‹å¦‚ï¼šbuild: å‡çº§webpackåˆ°ç‰ˆæœ¬5 ci: æŒç»­é›†æˆé…ç½®çš„å˜æ›´\nç”¨äºæäº¤CIé…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„ä¿®æ”¹ã€‚ ä¾‹å¦‚ï¼šci: ä¿®æ”¹GitHub Actionsé…ç½®æ–‡ä»¶ revert: å›æ»š\nç”¨äºæäº¤å›æ»šä¹‹å‰çš„æäº¤ã€‚ ä¾‹å¦‚ï¼šrevert: å›æ»šfeat: å¢åŠ ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ ","permalink":"https://carlos19960601.github.io/posts/git%E5%AD%A6%E4%B9%A0/","summary":"\u003ch3 id=\"commit-æ¶ˆæ¯æäº¤è§„èŒƒ\"\u003ecommit æ¶ˆæ¯æäº¤è§„èŒƒ\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003efeat: æ–°åŠŸèƒ½ï¼ˆfeatureï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤æ–°åŠŸèƒ½ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šfeat: å¢åŠ ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003efix: ä¿®å¤ bug\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤ bug ä¿®å¤ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šfix: ä¿®å¤ç™»å½•é¡µé¢å´©æºƒçš„é—®é¢˜\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003edocs: æ–‡æ¡£å˜æ›´\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤ä»…æ–‡æ¡£ç›¸å…³çš„ä¿®æ”¹ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šdocs: æ›´æ–°READMEæ–‡ä»¶\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003estyle: ä»£ç é£æ ¼å˜åŠ¨ï¼ˆä¸å½±å“ä»£ç é€»è¾‘ï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤ä»…æ ¼å¼åŒ–ã€æ ‡ç‚¹ç¬¦å·ã€ç©ºç™½ç­‰ä¸å½±å“ä»£ç è¿è¡Œçš„å˜æ›´ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šstyle: åˆ é™¤å¤šä½™çš„ç©ºè¡Œ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003erefactor: ä»£ç é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°å¢åŠŸèƒ½ä¹Ÿä¸æ˜¯ä¿®å¤bugçš„ä»£ç æ›´æ”¹ï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤ä»£ç é‡æ„ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šrefactor: é‡æ„ç”¨æˆ·éªŒè¯é€»è¾‘\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eperf: æ€§èƒ½ä¼˜åŒ–\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤æå‡æ€§èƒ½çš„ä»£ç ä¿®æ”¹ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šperf: ä¼˜åŒ–å›¾ç‰‡åŠ è½½é€Ÿåº¦\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003etest: æ·»åŠ æˆ–ä¿®æ”¹æµ‹è¯•\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤æµ‹è¯•ç›¸å…³çš„å†…å®¹ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼štest: å¢åŠ ç”¨æˆ·æ¨¡å—çš„å•å…ƒæµ‹è¯•\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003echore: æ‚é¡¹ï¼ˆæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤æ„å»ºè¿‡ç¨‹ã€è¾…åŠ©å·¥å…·ç­‰ç›¸å…³çš„å†…å®¹ä¿®æ”¹ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šchore: æ›´æ–°ä¾èµ–åº“\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ebuild: æ„å»ºç³»ç»Ÿæˆ–å¤–éƒ¨ä¾èµ–é¡¹çš„å˜æ›´\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤å½±å“æ„å»ºç³»ç»Ÿçš„æ›´æ”¹ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šbuild: å‡çº§webpackåˆ°ç‰ˆæœ¬5\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eci: æŒç»­é›†æˆé…ç½®çš„å˜æ›´\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤CIé…ç½®æ–‡ä»¶å’Œè„šæœ¬çš„ä¿®æ”¹ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šci: ä¿®æ”¹GitHub Actionsé…ç½®æ–‡ä»¶\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003erevert: å›æ»š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨äºæäº¤å›æ»šä¹‹å‰çš„æäº¤ã€‚\u003c/li\u003e\n\u003cli\u003eä¾‹å¦‚ï¼šrevert: å›æ»šfeat: å¢åŠ ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e","title":"Gitå­¦ä¹ "},{"content":"å®˜æ–¹æ•™ç¨‹ Learn Next.js æœåŠ¡ç«¯ç»„ä»¶ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªåä¸º app/api/posts/route.ts çš„æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰è·¯ç”±å¤„ç†ç¨‹åºï¼š\nimport { db } from \u0026#39;../../lib/db\u0026#39;; export async function GET(request: Request) { const posts = await db.post.findMany(); return new Response(JSON.stringify(posts), { status: 200 }); } åœ¨é¡µé¢ç»„ä»¶ä¸­ä½¿ç”¨ fetch å’Œ getServerSideProps è·å–æ•°æ®å¹¶å±•ç¤ºï¼š\n// pages/posts/index.tsx import { useEffect, useState } from \u0026#39;react\u0026#39;; export async function getServerSideProps() { const response = await fetch(\u0026#39;/api/posts\u0026#39;); const data = await response.json(); return { props: { posts: data, }, }; } export default function PostsPage({ posts }: { posts: any[] }) { return ( \u0026lt;div\u0026gt; {posts.map((post) =\u0026gt; ( \u0026lt;div key={post.id}\u0026gt; \u0026lt;h2\u0026gt;{post.title}\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;{post.content}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; ))} \u0026lt;/div\u0026gt; ); } Should I use SWR or Server Actions? No exact answer - but here is what I do:\nFor pure mutations, I prefer Server Actions. For pulling data from the server-side as a result of user interactions, I use SWR. Ultimately, you should use what you feel more comfortable with as both approaches are valid.\nå‚è€ƒï¼š\nhttps://makerkit.dev/how-to/next-supabase/api-routes-vs-server-actions https://stackoverflow.com/questions/77748391/nextjs-14-server-actions-vs-route-handlers ä¸ªäººç†è§£ï¼šnextjs è®©å‰ç«¯æœ‰èƒ½åŠ›è¿æ¥æ•°æ®åº“ï¼Œæˆä¸ºå…¨å¹²å·¥ç¨‹å¸ˆã€‚\nå½“åœ¨æŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œå¦‚æœé¡¹ç›®æ¯”è¾ƒå°ï¼Œå¹¶ä¸”åªæ˜¯å¯¹æ•°æ®åº“çš„CRUDç­‰æ“ä½œï¼Œä½¿ç”¨nextjs + prismaå°±å¯ä»¥å®ç°\nå¦‚æœé¡¹ç›®è¾ƒä¸ºå¤æ‚ï¼Œè¿˜æ˜¯åªä½¿ç”¨nextjsçš„å‰ç«¯èƒ½åŠ›ï¼Œåç«¯çš„äº‹æƒ…è¿˜æ˜¯å•ç‹¬éƒ¨ç½²\nå¯¹äºå•çº¯ä½¿ç”¨nextjsçš„å‰ç«¯èƒ½åŠ›ï¼Œå¦‚æœéœ€è¦åˆå§‹åŒ–websocketsï¼Œå¯ä»¥å°è£…æˆhook æˆ–è€… åœ¨ lib æˆ– utils ç›®å½•ä¸‹åˆ›å»ºwebsocketså®¢æˆ·ç«¯\n","permalink":"https://carlos19960601.github.io/posts/nextjs%E5%AD%A6%E4%B9%A0/","summary":"\u003ch3 id=\"å®˜æ–¹æ•™ç¨‹\"\u003eå®˜æ–¹æ•™ç¨‹\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://nextjs.org/learn/dashboard-app\"\u003eLearn Next.js\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"æœåŠ¡ç«¯ç»„ä»¶ç¤ºä¾‹\"\u003eæœåŠ¡ç«¯ç»„ä»¶ç¤ºä¾‹\u003c/h3\u003e\n\u003cp\u003eåˆ›å»ºä¸€ä¸ªåä¸º app/api/posts/route.ts çš„æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰è·¯ç”±å¤„ç†ç¨‹åºï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ts\" data-lang=\"ts\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003edb\u003c/span\u003e } \u003cspan style=\"color:#66d9ef\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;../../lib/db\u0026#39;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eGET\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003erequest\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003eRequest\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eposts\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edb\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003efindMany\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eResponse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estringify\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eposts\u003c/span\u003e), { \u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003e200\u003c/span\u003e });\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåœ¨é¡µé¢ç»„ä»¶ä¸­ä½¿ç”¨ \u003ccode\u003efetch\u003c/code\u003e å’Œ \u003ccode\u003egetServerSideProps\u003c/code\u003e è·å–æ•°æ®å¹¶å±•ç¤ºï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ts\" data-lang=\"ts\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// pages/posts/index.tsx\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003eimport\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003euseEffect\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003euseState\u003c/span\u003e } \u003cspan style=\"color:#66d9ef\"\u003efrom\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;react\u0026#39;\u003c/span\u003e;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetServerSideProps() {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003efetch\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;/api/posts\u0026#39;\u003c/span\u003e);\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ejson\u003c/span\u003e();\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#a6e22e\"\u003eprops\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      \u003cspan style=\"color:#a6e22e\"\u003eposts\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003edata\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    },\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  };\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eexport\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003edefault\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ePostsPage\u003c/span\u003e({ \u003cspan style=\"color:#a6e22e\"\u003eposts\u003c/span\u003e }\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e { \u003cspan style=\"color:#a6e22e\"\u003eposts\u003c/span\u003e: \u003cspan style=\"color:#66d9ef\"\u003eany\u003c/span\u003e[] }) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      {\u003cspan style=\"color:#a6e22e\"\u003eposts\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emap\u003c/span\u003e((\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e=\u0026gt;\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e{\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e}\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u0026lt;\u003cspan style=\"color:#f92672\"\u003eh2\u003c/span\u003e\u0026gt;{\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003etitle\u003c/span\u003e}\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh2\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e          \u0026lt;\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;{\u003cspan style=\"color:#a6e22e\"\u003epost\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003econtent\u003c/span\u003e}\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      ))}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  );\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"should-i-use-swr-or-server-actions\"\u003eShould I use SWR or Server Actions?\u003c/h3\u003e\n\u003cp\u003eNo exact answer - but here is what I do:\u003c/p\u003e","title":"Nextjså­¦ä¹ "},{"content":"Twitter/X åšä¸»@_georgemollerçš„åˆ†äº« ä¸»è¦è®°å½•Twitteråšä¸»@_georgemolleråˆ†äº«çš„ReactæŠ€å·§ã€‚å¯¹äºæˆ‘è¿™ç§Reactå°ç™½å¾ˆä½¿ç”¨ã€‚äºæ˜¯æ¬è¿è¿‡æ¥ï¼Œå¹¶é™„ä¸Šä¸ªäººçš„ä¸€äº›ç†è§£ã€‚å¦‚æœ‰é—®é¢˜è¯·é‚®ç®±æœ¬äººï¼Œæ¬¢è¿å„ä½æŒ‡æ­£ã€‚\nSolve re-render issues with composition ä¸ªäººç†è§£ï¼šåŠŸèƒ½å•ä¸€ï¼Œåˆ©ç”¨ç»„åˆæ¨¡å¼å‡å°‘è€¦åˆï¼Œå¸¦æ¥ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“\nUtility Types For Enhanced Reusablity ä¸ªäººç†è§£ï¼šTypescript Pickçš„ä½¿ç”¨\nBad use case for useCallback useCallback ä½¿ç”¨åœ¨å¤æ‚é€»è¾‘çš„ç»„ä»¶ï¼Œç®€å•ç»„ä»¶ä¸ä¼šæ¶ˆè€—é€ æˆæ€§èƒ½é—®é¢˜æ—¶ä¸å¿…ä½¿ç”¨\nIntersection types to extends native props in a component Don\u0026rsquo;t listen for ref changes with useEffect æœ¬äººæ›¾ç»è¿™ä¹ˆå¹²è¿‡\nuseEffect vs useLayoutEffect ä¸ªäººç†è§£ï¼šuseLayoutEffectåœ¨DOMæ›´æ–°åï¼Œæµè§ˆå™¨ç»˜åˆ¶å‰æ‰§è¡Œã€‚useEffectåœ¨DOMæ›´æ–°åï¼Œæµè§ˆå™¨ç»˜åˆ¶åæ‰§è¡Œã€‚\nSeparation of Concerns in React Reactä¸­çš„å…³æ³¨ç‚¹åˆ†ç¦» è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„è½¯ä»¶è®¾è®¡åŸåˆ™ï¼Œåœ¨Reactå¼€å‘ä¸­ä¹ŸåŒæ ·é€‚ç”¨ã€‚å®ƒæŒ‡çš„æ˜¯å°†ä»£ç æŒ‰ç…§ä¸åŒçš„åŠŸèƒ½æˆ–è´£ä»»è¿›è¡Œåˆ’åˆ†å’Œç»„ç»‡ï¼Œä½¿æ¯ä¸ªéƒ¨åˆ†ä¸“æ³¨äºç‰¹å®šçš„ä»»åŠ¡ã€‚åœ¨Reactä¸­ï¼Œè¿™é€šå¸¸ä½“ç°ä¸º:\nå°†UIå’Œé€»è¾‘åˆ†ç¦» å°†çŠ¶æ€ç®¡ç†ä¸æ¸²æŸ“é€»è¾‘åˆ†ç¦» å°†å¯å¤ç”¨çš„é€»è¾‘æŠ½ç¦»æˆè‡ªå®šä¹‰Hook å°†å¤§å‹ç»„ä»¶æ‹†åˆ†æˆæ›´å°çš„ã€åŠŸèƒ½å•ä¸€çš„ç»„ä»¶ éµå¾ªè¿™ä¸€åŸåˆ™å¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å’Œå¯é‡ç”¨æ€§ã€‚\nEasy to read abstraction over array state ä¸ªäººç†è§£ï¼šå¯¹æ•°ç»„çŠ¶æ€è¿›è¡ŒæŠ½è±¡ï¼Œç®€åŒ–é€»è¾‘\nHow to import Server Components from Client Components ä¸ªäººç†è§£ï¼šæœåŠ¡ç«¯æ¸²æŸ“æ¡†æ¶ä¸­ä½¿ç”¨çš„å°æŠ€å·§\nAvoid Transforming Data in useEffect ä¸ªäººç†è§£ï¼šåœ¨useEffectä¸­é¿å…å¯¹æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“\nåŸå› ï¼š\næ€§èƒ½é—®é¢˜ï¼šåœ¨ useEffect ä¸­è½¬æ¢æ•°æ®å¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚ ä»£ç å¤æ‚æ€§ï¼šå¯èƒ½ä½¿ç»„ä»¶é€»è¾‘å˜å¾—éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚ æ›´å¥½çš„åšæ³•ï¼š\nåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ç›´æ¥è½¬æ¢æ•°æ®ã€‚ ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœã€‚ How and when to use flushSync Defer creation of non-primitive values if you are using them within a dependency array ä¸ªäººç†è§£: useEffectä½¿ç”¨Tips\nAvoid premature optimization How to expose custom refs with useImperativeHandle hook Separate business logic from UI How to virtualize large lists Avoid difficult to read conditionals in React Using inferred types in React Avoid Provider Wrapping Hell useEffect cheatsheet å¼€å‘ä¸­çš„å­¦ä¹  useState vs useReducer ä¸ªäººç†è§£useReduceræ˜¯useStateçš„è¿›é˜¶ç‰ˆæœ¬ï¼ŒuseStateé€‚ç”¨äºä¸€äº›ç®€å•çŠ¶æ€çš„ç®¡ç†ã€‚å¦‚æœæ˜¯å¤šä¸ªç®€å•çŠ¶æ€ä¹‹å‰å­˜åœ¨å¤æ‚çš„é€»è¾‘å…³è”ï¼Œæ¨èä½¿ç”¨useReducerå»å¤„ç†ã€‚\n@uidotdev/usehooks ä¸­ useThrottle å’Œ useDebunceçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ ä½œç”¨ç›®çš„\nuseThrottleï¼ˆèŠ‚æµï¼‰ï¼š ç›®çš„æ˜¯é™åˆ¶å‡½æ•°åœ¨ä¸€å®šæ—¶é—´å†…çš„æ‰§è¡Œæ¬¡æ•°ã€‚å®ƒç¡®ä¿å‡½æ•°åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…æœ€å¤šè¢«æ‰§è¡Œä¸€æ¬¡ã€‚\nä¾‹å¦‚ï¼Œåœ¨æ»šåŠ¨äº‹ä»¶å¤„ç†ä¸­ï¼Œå½“ç”¨æˆ·å¿«é€Ÿæ»šåŠ¨é¡µé¢æ—¶ï¼Œä½¿ç”¨èŠ‚æµå¯ä»¥é¿å…é¢‘ç¹åœ°æ‰§è¡ŒæŸä¸ªæ˜‚è´µçš„æ“ä½œï¼Œå¦‚å‘é€ç½‘ç»œè¯·æ±‚æˆ–è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚\nuseDebounceï¼ˆé˜²æŠ–ï¼‰ï¼š ä¸»è¦ç”¨äºåœ¨ç”¨æˆ·è¾“å…¥æˆ–è§¦å‘æŸä¸ªäº‹ä»¶åï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰æ–°çš„è§¦å‘ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„å‡½æ•°ã€‚\nå¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯åœ¨æœç´¢æ¡†è¾“å…¥æ—¶ï¼Œå½“ç”¨æˆ·åœæ­¢è¾“å…¥ä¸€æ®µæ—¶é—´åæ‰è¿›è¡Œæœç´¢è¯·æ±‚ï¼Œé¿å…åœ¨ç”¨æˆ·è¾“å…¥è¿‡ç¨‹ä¸­é¢‘ç¹å‘é€è¯·æ±‚ã€‚\næ‰§è¡Œæ—¶æœº\nuseThrottleï¼š å½“è§¦å‘äº‹ä»¶å¼€å§‹æ—¶ï¼Œå‡½æ•°ä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶ååœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œæ— è®ºè§¦å‘äº‹ä»¶å‘ç”Ÿå¤šå°‘æ¬¡ï¼Œå‡½æ•°éƒ½ä¸ä¼šå†æ¬¡æ‰§è¡Œã€‚ç›´åˆ°æ—¶é—´é—´éš”ç»“æŸåï¼Œä¸‹ä¸€æ¬¡è§¦å‘äº‹ä»¶æ‰èƒ½å†æ¬¡æ‰§è¡Œå‡½æ•°ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾è®¾ç½®èŠ‚æµæ—¶é—´ä¸º 1 ç§’ï¼Œå½“ç”¨æˆ·è¿ç»­è§¦å‘äº‹ä»¶æ—¶ï¼Œå‡½æ•°åœ¨ç¬¬ä¸€ç§’å†…æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åçš„è§¦å‘ä¼šè¢«å¿½ç•¥ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª 1 ç§’é—´éš”å¼€å§‹ã€‚\nuseDebounceï¼š å½“è§¦å‘äº‹ä»¶å‘ç”Ÿåï¼Œå‡½æ•°ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ã€‚å¦‚æœåœ¨å®šæ—¶å™¨åˆ°æœŸä¹‹å‰åˆæœ‰æ–°çš„è§¦å‘äº‹ä»¶ï¼Œé‚£ä¹ˆå®šæ—¶å™¨ä¼šè¢«é‡ç½®ã€‚åªæœ‰åœ¨å®šæ—¶å™¨åˆ°æœŸä¸”æ²¡æœ‰æ–°çš„è§¦å‘äº‹ä»¶æ—¶ï¼Œå‡½æ•°æ‰ä¼šæ‰§è¡Œã€‚\næ¯”å¦‚ï¼Œè®¾ç½®é˜²æŠ–æ—¶é—´ä¸º 500 æ¯«ç§’ï¼Œå½“ç”¨æˆ·è¾“å…¥å†…å®¹åï¼Œ500 æ¯«ç§’å†…å¦‚æœæ²¡æœ‰æ–°çš„è¾“å…¥ï¼Œå‡½æ•°å°±ä¼šæ‰§è¡Œï¼›å¦‚æœåœ¨è¿™ 500 æ¯«ç§’å†…åˆæœ‰æ–°çš„è¾“å…¥ï¼Œå®šæ—¶å™¨ä¼šé‡æ–°å¼€å§‹è®¡æ—¶ã€‚\né€‚ç”¨åœºæ™¯\nuseThrottleï¼š é€‚ç”¨äºéœ€è¦æŒç»­å“åº”ä½†åˆä¸èƒ½è¿‡äºé¢‘ç¹æ‰§è¡Œçš„åœºæ™¯ï¼Œæ¯”å¦‚æ»šåŠ¨äº‹ä»¶ã€çª—å£å¤§å°è°ƒæ•´äº‹ä»¶ç­‰ï¼Œä»¥å‡å°‘èµ„æºæ¶ˆè€—å’Œæé«˜æ€§èƒ½ã€‚\nä¾‹å¦‚ï¼Œåœ¨åœ°å›¾åº”ç”¨ä¸­ï¼Œå½“ç”¨æˆ·æ‹–åŠ¨åœ°å›¾æ—¶ï¼Œå¯ä»¥ä½¿ç”¨èŠ‚æµæ¥é™åˆ¶åœ°å›¾æ›´æ–°çš„é¢‘ç‡ï¼Œé¿å…è¿‡åº¦çš„è®¡ç®—å’Œç½‘ç»œè¯·æ±‚ã€‚\nuseDebounceï¼š éå¸¸é€‚åˆå¤„ç†ç”¨æˆ·è¾“å…¥ã€æœç´¢æ¡†è‡ªåŠ¨å®Œæˆç­‰åœºæ™¯ï¼Œç¡®ä¿åœ¨ç”¨æˆ·åœæ­¢æ“ä½œä¸€æ®µæ—¶é—´åæ‰æ‰§è¡Œç›¸å…³æ“ä½œï¼Œé¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œç½‘ç»œè¯·æ±‚ã€‚\nä¾‹å¦‚ï¼Œåœ¨åœ¨çº¿æ–‡æ¡£çš„è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é˜²æŠ–æ¥é¿å…é¢‘ç¹ä¿å­˜ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·åœæ­¢ç¼–è¾‘ä¸€æ®µæ—¶é—´åè¿›è¡Œä¿å­˜æ“ä½œã€‚\nä½¿ç”¨ ElementRef ç±»å‹å®šä¹‰refçš„ç±»å‹ è®°ä½HTMLDivElementæ˜¯æ¯”è¾ƒå›°éš¾çš„\nconst ref = useRef\u0026lt;HTMLDivElement\u0026gt;(null); å¯ä»¥å°è¯•\nconst ref = useRef\u0026lt;ElementRef\u0026lt;\u0026#34;div\u0026#34;\u0026gt;\u0026gt;(null); ä»åˆ«äººä¸­çš„ç¬”è®°å­¦ä¹  Reactå¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ ç»„åˆæ¨¡å¼ é¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼ŒTabså’ŒTabItemæ˜¯çˆ¶å­å…³ç³»ã€‚\nTabs è´Ÿè´£å±•ç¤ºå’Œæ§åˆ¶å¯¹åº”çš„ TabItem ã€‚ç»‘å®šåˆ‡æ¢ tab å›è°ƒæ–¹æ³• onChangeã€‚å½“ tab åˆ‡æ¢çš„æ—¶å€™ï¼Œæ‰§è¡Œå›è°ƒã€‚ TabItem è´Ÿè´£å±•ç¤ºå¯¹åº”çš„ tab é¡¹ï¼Œå‘ Tabs ä¼ é€’ props ç›¸å…³ä¿¡æ¯ã€‚ \u0026lt;Tabs onChange={ (type)=\u0026gt; console.log(type) } \u0026gt; \u0026lt;TabItem name=\u0026#34;react\u0026#34; label=\u0026#34;react\u0026#34; \u0026gt;React\u0026lt;/TabItem\u0026gt; \u0026lt;TabItem name=\u0026#34;vue\u0026#34; label=\u0026#34;vue\u0026#34; \u0026gt;Vue\u0026lt;/TabItem\u0026gt; \u0026lt;TabItem name=\u0026#34;angular\u0026#34; label=\u0026#34;angular\u0026#34; \u0026gt;Angular\u0026lt;/TabItem\u0026gt; \u0026lt;/Tabs\u0026gt; éšå¼æ··å…¥ props\nfunction Item (props){ console.log(props) return \u0026lt;div\u0026gt; åç§°ï¼š {props.name} \u0026lt;/div\u0026gt; } function Groups (props){ const newChilren = React.cloneElement(props.children, { author:\u0026#39;alien\u0026#39; }) return newChilren } é€šè¿‡React.cloneElementï¼Œå‘å­ç»„ä»¶ä¸­æ··å…¥çˆ¶ç»„ä»¶çš„propsã€‚\næ§åˆ¶æ¸²æŸ“\nfunction Item (props){ return \u0026lt;div\u0026gt; åç§°ï¼š {props.name} \u0026lt;/div\u0026gt; } /* Groups ç»„ä»¶ */ function Groups (props){ const newChildren = [] React.Children.forEach(props.children,(item)=\u0026gt;{ const { type ,props } = item || {} if(isValidElement(item) \u0026amp;\u0026amp; type === Item \u0026amp;\u0026amp; props.isShow ){ newChildren.push(item) } }) return newChildren } é€šè¿‡éå†childrenï¼Œæ ¹æ®çˆ¶ç»„ä»¶çš„é€»è¾‘æ¥æ§åˆ¶å­ç»„ä»¶çš„æ¸²æŸ“ã€‚\nå†…å¤–å±‚é€šä¿¡\nfunction Item (props){ return \u0026lt;div\u0026gt; åç§°ï¼š{props.name} \u0026lt;button onClick={()=\u0026gt; props.callback(\u0026#39;let us learn React!\u0026#39;)} \u0026gt;ç‚¹å‡»\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; } function Groups (props){ const handleCallback = (val) =\u0026gt; console.log(\u0026#39; children å†…å®¹ï¼š\u0026#39;,val ) return \u0026lt;div\u0026gt; {React.cloneElement( props.children , { callback:handleCallback } )} \u0026lt;/div\u0026gt; } å‘å†…å±‚ç»„ä»¶ä¼ é€’å›è°ƒå‡½æ•° callback ï¼Œå†…å±‚é€šè¿‡è°ƒç”¨ callback æ¥å®ç°ä¸¤å±‚ç»„åˆæ¨¡å¼çš„é€šä¿¡å…³ç³»ã€‚\nrender propsæ¨¡å¼ render props æ¨¡å¼å’Œç»„åˆæ¨¡å¼ç±»ä¼¼ã€‚åŒºåˆ«ä¸åŒçš„æ˜¯ï¼Œç”¨å‡½æ•°çš„å½¢å¼ä»£æ›¿ childrenã€‚å‡½æ•°çš„å‚æ•°ï¼Œç”±å®¹å™¨ç»„ä»¶æä¾›ï¼Œè¿™æ ·çš„å¥½å¤„ï¼Œå°†å®¹å™¨ç»„ä»¶çš„çŠ¶æ€ï¼Œæå‡åˆ°å½“å‰å¤–å±‚ç»„ä»¶ä¸­ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªå·§å¦™ä¹‹å¤„ï¼Œä¹Ÿæ˜¯å’Œç»„åˆæ¨¡å¼ç›¸æ¯”æœ€å¤§çš„åŒºåˆ«ã€‚\nexport default function App (){ const aProps = { name:\u0026#39;ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹\u0026#39; } return \u0026lt;Container\u0026gt; {(cProps) =\u0026gt; \u0026lt;Children {...cProps} { ...aProps } /\u0026gt;} \u0026lt;/Container\u0026gt; } å‚è€ƒèµ„æ–™:\nã€ŒReact è¿›é˜¶ã€ å­¦å¥½è¿™äº› React è®¾è®¡æ¨¡å¼ï¼Œèƒ½è®©ä½ çš„ React é¡¹ç›®é£èµ·æ¥ ","permalink":"https://carlos19960601.github.io/posts/react%E7%AC%94%E8%AE%B0/","summary":"\u003ch2 id=\"twitterx-åšä¸»_georgemollerhttpsxcom_georgemollerçš„åˆ†äº«\"\u003eTwitter/X åšä¸»\u003ca href=\"https://x.com/_georgemoller\"\u003e@_georgemoller\u003c/a\u003eçš„åˆ†äº«\u003c/h2\u003e\n\u003cp\u003eä¸»è¦è®°å½•Twitteråšä¸»\u003ca href=\"https://x.com/_georgemoller\"\u003e@_georgemoller\u003c/a\u003eåˆ†äº«çš„ReactæŠ€å·§ã€‚å¯¹äºæˆ‘è¿™ç§Reactå°ç™½å¾ˆä½¿ç”¨ã€‚äºæ˜¯æ¬è¿è¿‡æ¥ï¼Œå¹¶é™„ä¸Šä¸ªäººçš„ä¸€äº›ç†è§£ã€‚å¦‚æœ‰é—®é¢˜è¯·é‚®ç®±æœ¬äººï¼Œæ¬¢è¿å„ä½æŒ‡æ­£ã€‚\u003c/p\u003e\n\u003ch3 id=\"solve-re-render-issues-with-composition\"\u003eSolve re-render issues with composition\u003c/h3\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/React%e7%ac%94%e8%ae%b0/georgemoller_1c2c3b.gif\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸ªäººç†è§£ï¼šåŠŸèƒ½å•ä¸€ï¼Œåˆ©ç”¨ç»„åˆæ¨¡å¼å‡å°‘è€¦åˆï¼Œå¸¦æ¥ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"utility-types-for-enhanced-reusablity\"\u003eUtility Types For Enhanced Reusablity\u003c/h3\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/React%e7%ac%94%e8%ae%b0/georgemoller_9378eb.gif\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸ªäººç†è§£ï¼šTypescript Pickçš„ä½¿ç”¨\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"bad-use-case-for-usecallback\"\u003eBad use case for useCallback\u003c/h3\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/React%e7%ac%94%e8%ae%b0/georgemoller_ed1930.gif\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003euseCallback ä½¿ç”¨åœ¨å¤æ‚é€»è¾‘çš„ç»„ä»¶ï¼Œç®€å•ç»„ä»¶ä¸ä¼šæ¶ˆè€—é€ æˆæ€§èƒ½é—®é¢˜æ—¶ä¸å¿…ä½¿ç”¨\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"intersection-types-to-extends-native-props-in-a-component\"\u003eIntersection types to extends native props in a component\u003c/h3\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/React%e7%ac%94%e8%ae%b0/georgemoller_29194f.gif\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003ch3 id=\"dont-listen-for-ref-changes-with-useeffect\"\u003eDon\u0026rsquo;t listen for ref changes with useEffect\u003c/h3\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/React%e7%ac%94%e8%ae%b0/georgemoller_8216ce.gif\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæœ¬äººæ›¾ç»è¿™ä¹ˆå¹²è¿‡\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"useeffect-vs-uselayouteffect\"\u003euseEffect vs useLayoutEffect\u003c/h3\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/React%e7%ac%94%e8%ae%b0/georgemoller_d587ed.gif\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸ªäººç†è§£ï¼šuseLayoutEffectåœ¨DOMæ›´æ–°åï¼Œæµè§ˆå™¨ç»˜åˆ¶å‰æ‰§è¡Œã€‚useEffectåœ¨DOMæ›´æ–°åï¼Œæµè§ˆå™¨ç»˜åˆ¶åæ‰§è¡Œã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3 id=\"separation-of-concerns-in-react\"\u003eSeparation of Concerns in React\u003c/h3\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/React%e7%ac%94%e8%ae%b0/georgemoller_e8833e.gif\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReactä¸­çš„å…³æ³¨ç‚¹åˆ†ç¦»\nè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„è½¯ä»¶è®¾è®¡åŸåˆ™ï¼Œåœ¨Reactå¼€å‘ä¸­ä¹ŸåŒæ ·é€‚ç”¨ã€‚å®ƒæŒ‡çš„æ˜¯å°†ä»£ç æŒ‰ç…§ä¸åŒçš„åŠŸèƒ½æˆ–è´£ä»»è¿›è¡Œåˆ’åˆ†å’Œç»„ç»‡ï¼Œä½¿æ¯ä¸ªéƒ¨åˆ†ä¸“æ³¨äºç‰¹å®šçš„ä»»åŠ¡ã€‚åœ¨Reactä¸­ï¼Œè¿™é€šå¸¸ä½“ç°ä¸º:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eå°†UIå’Œé€»è¾‘åˆ†ç¦»\u003c/li\u003e\n\u003cli\u003eå°†çŠ¶æ€ç®¡ç†ä¸æ¸²æŸ“é€»è¾‘åˆ†ç¦»\u003c/li\u003e\n\u003cli\u003eå°†å¯å¤ç”¨çš„é€»è¾‘æŠ½ç¦»æˆè‡ªå®šä¹‰Hook\u003c/li\u003e\n\u003cli\u003eå°†å¤§å‹ç»„ä»¶æ‹†åˆ†æˆæ›´å°çš„ã€åŠŸèƒ½å•ä¸€çš„ç»„ä»¶\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eéµå¾ªè¿™ä¸€åŸåˆ™å¯ä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯è¯»æ€§å’Œå¯é‡ç”¨æ€§ã€‚\u003c/p\u003e","title":"Reactç¬”è®°"},{"content":"æ¡Œé¢å®¢æˆ·ç«¯ tauri tauri åç«¯ä½¿ç”¨rustã€‚\nclash-verge-rev: åŸºäºMihomoå†…æ ¸çš„ç¿»å¢™å®¢æˆ·ç«¯GUI rust system-proxyçš„å®ç° Electron Electron åç«¯ä½¿ç”¨nodeã€‚\neveryone-can-use-english: è‹±è¯­å­¦ä¹ è½¯ä»¶ é¡¹ç›®ç»“æ„æ¸…æ™°ï¼Œå¯ä»¥å‚è€ƒå­¦ä¹  mihomo-party: Mihomo GUI ä¸ªäººè§‚ç‚¹ï¼štauriæ˜¯webview+rustçš„å®ç°ï¼Œæ€§èƒ½å’Œæ‰“åŒ…çš„ä½“ç§¯æ¯”è¾ƒå°ï¼Œä½†æ˜¯rusté—¨æ§›é«˜ï¼Œtauriçš„ç”Ÿæ€å¯èƒ½æ¯”ä¸ä¸Šnodeã€‚Electronæ˜¯Chromeå†…æ ¸å’ŒNodeJSï¼Œå…¥é—¨é—¨æ§›ä½ï¼Œè€Œä¸”nodeçš„ç”Ÿæ€æ¯”è¾ƒå¥½ã€‚å†ä¸åœ¨ä¹åŒ…ä½“ç§¯å’Œæ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯æ¨èElectronã€‚\nç§»åŠ¨å®¢æˆ·ç«¯ Flutter pilipala: ç¬¬ä¸‰æ–¹bilibiliå®¢æˆ·ç«¯ ä½¿ç”¨GetåšçŠ¶æ€ç®¡ç† ä½¿ç”¨Hiveåšæœ¬åœ°å­˜å‚¨ å°è£…äº†dioç½‘ç»œè¯·æ±‚ åŸºäºmedia-kitå®ç°è§†é¢‘æ’­æ”¾ Cashew: An app created to help users manage a budget and purchases flutter_cloud_music: è¿˜åŸç½‘æ˜“äº‘ï¼Œflutter SDKç‰ˆæœ¬è¾ƒä½ï¼Œä¾èµ–åŒ…æœ‰äº›ç¼ºä¹ç»´æŠ¤ Taskez: A Productivity Mobile Application UI kit built with Flutter E-commerce-Complete-Flutter-UI: å­¦ä¹ skleton Flclash: åŸºäºClashMetaçš„å®¢æˆ·ç«¯ã€‚ cgo ffi Webå‰ç«¯ React eidos: ç±»ä¼¼notionçš„è½¯ä»¶ ä½¿ç”¨zustandåšçŠ¶æ€ç®¡ç† èƒ½å¤Ÿäº†è§£åˆ°PWAã€serivce-wokerã€web-workerç­‰ jsoncrack.com: jsonå¯è§†åŒ–å±•ç¤º c-shopping: åŸºäºNext.jsçš„å…¨æ ˆè´­ç‰©ç½‘ç«™ ä½¿ç”¨ mongoose æ“ä½œæ•°æ®åº“ å­¦ä¹  nextjs çš„ Route Handlers çš„ä½¿ç”¨ noodle: Rethinking Student Productivity å­¦ä¹ åœ¨nextjsä¸­ä½¿ç”¨trpc novel: åŸºäºTiptapå®ç°çš„ç¼–è¾‘å™¨ tiptapæ’ä»¶ç¼–å†™ åç«¯ Golang mihomo: ç¿»å¢™è½¯ä»¶ï¼ŒClashMeta èƒ½å¤Ÿå­¦ä¹ åˆ°å„ç§ç¿»å¢™åè®®çš„å†…å®¹ asynq: åŸºäºRediså®ç°çš„åˆ†å¸ƒå¼ä»»åŠ¡ redis luaè„šæœ¬çš„ä½¿ç”¨ golang å¤šä¸ªseverçš„å¯åŠ¨ä¸åœæ­¢çš„å®ç° galene: The GalÃ¨ne videoconference server äº†è§£WebRTCç›¸å…³çš„æŒ‡ç¤º badger: KVå­˜å‚¨å¼•æ“ èƒ½å¤Ÿå­¦ä¹ åˆ°LSMæ ‘çš„å®ç° Rust xh: ç±»ä¼¼äºcurlçš„å‘½ä»¤è¡Œè¯·æ±‚å·¥å…· æ•°æ®åˆ†æä¸æœºå™¨å­¦ä¹  handson-ml3: Hands-on Machine Learning with Scikit-Learn, Keras and TensorFlow (3rd edition) 100-Days-Of-ML-Code ","permalink":"https://carlos19960601.github.io/posts/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E6%8E%A8%E8%8D%90/","summary":"\u003ch1 id=\"æ¡Œé¢å®¢æˆ·ç«¯\"\u003eæ¡Œé¢å®¢æˆ·ç«¯\u003c/h1\u003e\n\u003ch2 id=\"taurihttpstauriapp\"\u003e\u003ca href=\"https://tauri.app/\"\u003etauri\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003etauri åç«¯ä½¿ç”¨\u003ccode\u003erust\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/clash-verge-rev/clash-verge-rev\"\u003eclash-verge-rev\u003c/a\u003e: åŸºäºMihomoå†…æ ¸çš„ç¿»å¢™å®¢æˆ·ç«¯GUI\n\u003cul\u003e\n\u003cli\u003erust system-proxyçš„å®ç°\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"electronhttpswwwelectronforgeio\"\u003e\u003ca href=\"https://www.electronforge.io/\"\u003eElectron\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eElectron åç«¯ä½¿ç”¨\u003ccode\u003enode\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/ZuodaoTech/everyone-can-use-english\"\u003eeveryone-can-use-english\u003c/a\u003e: è‹±è¯­å­¦ä¹ è½¯ä»¶\n\u003cul\u003e\n\u003cli\u003eé¡¹ç›®ç»“æ„æ¸…æ™°ï¼Œå¯ä»¥å‚è€ƒå­¦ä¹ \u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/pompurin404/mihomo-party\"\u003emihomo-party\u003c/a\u003e: Mihomo GUI\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸ªäººè§‚ç‚¹ï¼štauriæ˜¯webview+rustçš„å®ç°ï¼Œæ€§èƒ½å’Œæ‰“åŒ…çš„ä½“ç§¯æ¯”è¾ƒå°ï¼Œä½†æ˜¯rusté—¨æ§›é«˜ï¼Œtauriçš„ç”Ÿæ€å¯èƒ½æ¯”ä¸ä¸Šnodeã€‚Electronæ˜¯Chromeå†…æ ¸å’ŒNodeJSï¼Œå…¥é—¨é—¨æ§›ä½ï¼Œè€Œä¸”nodeçš„ç”Ÿæ€æ¯”è¾ƒå¥½ã€‚å†ä¸åœ¨ä¹åŒ…ä½“ç§¯å’Œæ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯æ¨èElectronã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"ç§»åŠ¨å®¢æˆ·ç«¯\"\u003eç§»åŠ¨å®¢æˆ·ç«¯\u003c/h1\u003e\n\u003ch2 id=\"flutter\"\u003eFlutter\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/guozhigq/pilipala\"\u003epilipala\u003c/a\u003e: ç¬¬ä¸‰æ–¹bilibiliå®¢æˆ·ç«¯\n\u003cul\u003e\n\u003cli\u003eä½¿ç”¨GetåšçŠ¶æ€ç®¡ç†\u003c/li\u003e\n\u003cli\u003eä½¿ç”¨Hiveåšæœ¬åœ°å­˜å‚¨\u003c/li\u003e\n\u003cli\u003eå°è£…äº†dioç½‘ç»œè¯·æ±‚\u003c/li\u003e\n\u003cli\u003eåŸºäºmedia-kitå®ç°è§†é¢‘æ’­æ”¾\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/jameskokoska/Cashew\"\u003eCashew\u003c/a\u003e: An app created to help users manage a budget and purchases\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/AIYO77/flutter_cloud_music\"\u003eflutter_cloud_music\u003c/a\u003e: è¿˜åŸç½‘æ˜“äº‘ï¼Œflutter SDKç‰ˆæœ¬è¾ƒä½ï¼Œä¾èµ–åŒ…æœ‰äº›ç¼ºä¹ç»´æŠ¤\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Davies-K/Taskez\"\u003eTaskez\u003c/a\u003e: A Productivity Mobile Application UI kit built with Flutter\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/abuanwar072/E-commerce-Complete-Flutter-UI\"\u003eE-commerce-Complete-Flutter-UI\u003c/a\u003e: å­¦ä¹ skleton\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/chen08209/FlClash\"\u003eFlclash\u003c/a\u003e: åŸºäºClashMetaçš„å®¢æˆ·ç«¯ã€‚\n\u003cul\u003e\n\u003cli\u003ecgo\u003c/li\u003e\n\u003cli\u003effi\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"webå‰ç«¯\"\u003eWebå‰ç«¯\u003c/h1\u003e\n\u003ch2 id=\"react\"\u003eReact\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/mayneyao/eidos\"\u003eeidos\u003c/a\u003e: ç±»ä¼¼notionçš„è½¯ä»¶\n\u003cul\u003e\n\u003cli\u003eä½¿ç”¨zustandåšçŠ¶æ€ç®¡ç†\u003c/li\u003e\n\u003cli\u003eèƒ½å¤Ÿäº†è§£åˆ°PWAã€serivce-wokerã€web-workerç­‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/AykutSarac/jsoncrack.com\"\u003ejsoncrack.com\u003c/a\u003e: jsonå¯è§†åŒ–å±•ç¤º\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/huanghanzhilian/c-shopping\"\u003ec-shopping\u003c/a\u003e: åŸºäº\u003ccode\u003eNext.js\u003c/code\u003eçš„å…¨æ ˆè´­ç‰©ç½‘ç«™\n\u003cul\u003e\n\u003cli\u003eä½¿ç”¨ \u003ccode\u003emongoose\u003c/code\u003e æ“ä½œæ•°æ®åº“\u003c/li\u003e\n\u003cli\u003eå­¦ä¹  nextjs çš„ Route Handlers çš„ä½¿ç”¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/noodle-run/noodle\"\u003enoodle\u003c/a\u003e: Rethinking Student Productivity\n\u003cul\u003e\n\u003cli\u003eå­¦ä¹ åœ¨nextjsä¸­ä½¿ç”¨trpc\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/steven-tey/novel\"\u003enovel\u003c/a\u003e: åŸºäºTiptapå®ç°çš„ç¼–è¾‘å™¨\n\u003cul\u003e\n\u003cli\u003etiptapæ’ä»¶ç¼–å†™\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"åç«¯\"\u003eåç«¯\u003c/h1\u003e\n\u003ch2 id=\"golang\"\u003eGolang\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/MetaCubeX/mihomo\"\u003emihomo\u003c/a\u003e: ç¿»å¢™è½¯ä»¶ï¼ŒClashMeta\n\u003cul\u003e\n\u003cli\u003eèƒ½å¤Ÿå­¦ä¹ åˆ°å„ç§ç¿»å¢™åè®®çš„å†…å®¹\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/hibiken/asynq\"\u003easynq\u003c/a\u003e: åŸºäºRediså®ç°çš„åˆ†å¸ƒå¼ä»»åŠ¡\n\u003cul\u003e\n\u003cli\u003eredis luaè„šæœ¬çš„ä½¿ç”¨\u003c/li\u003e\n\u003cli\u003egolang å¤šä¸ªseverçš„å¯åŠ¨ä¸åœæ­¢çš„å®ç°\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/jech/galene\"\u003egalene\u003c/a\u003e: The GalÃ¨ne videoconference server\n\u003cul\u003e\n\u003cli\u003eäº†è§£WebRTCç›¸å…³çš„æŒ‡ç¤º\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/dgraph-io/badger\"\u003ebadger\u003c/a\u003e: KVå­˜å‚¨å¼•æ“\n\u003cul\u003e\n\u003cli\u003eèƒ½å¤Ÿå­¦ä¹ åˆ°LSMæ ‘çš„å®ç°\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"rust\"\u003eRust\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/ducaale/xh\"\u003exh\u003c/a\u003e: ç±»ä¼¼äº\u003ccode\u003ecurl\u003c/code\u003eçš„å‘½ä»¤è¡Œè¯·æ±‚å·¥å…·\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"æ•°æ®åˆ†æä¸æœºå™¨å­¦ä¹ \"\u003eæ•°æ®åˆ†æä¸æœºå™¨å­¦ä¹ \u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/ageron/handson-ml3\"\u003ehandson-ml3\u003c/a\u003e: Hands-on Machine Learning with Scikit-Learn, Keras and TensorFlow (3rd edition)\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/MLEveryday/100-Days-Of-ML-Code\"\u003e100-Days-Of-ML-Code\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"å¼€æºé¡¹ç›®å­¦ä¹ æ¨è"},{"content":"ç”Ÿå‘½å‘¨æœŸ rustè‡ªåŠ¨æ¨æ–­å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ\nfn longest(x: \u0026amp;str, y: \u0026amp;str) -\u0026gt; \u0026amp;str { if x.len() \u0026gt; y.len() { x } else { y } } ä½†æ˜¯ä¸Šé¢è¿™æ®µä»£ç ï¼Œrustæ— æ³•æ¨æ–­å‡ºå˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚æ‰€ä»¥éœ€è¦æ˜¾ç¤ºçš„æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚\nç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å¹¶ä¸ä¼šæ”¹å˜ä»»ä½•å¼•ç”¨çš„å®é™…ä½œç”¨åŸŸ\nå‚è€ƒèµ„æ–™ é€šè¿‡ä¾‹å­å­¦ Rust Rust ç¨‹åºè®¾è®¡è¯­è¨€ Rustè¯­è¨€åœ£ç»( ","permalink":"https://carlos19960601.github.io/posts/%E5%AD%A6%E4%B9%A0rust/","summary":"\u003ch1 id=\"ç”Ÿå‘½å‘¨æœŸ\"\u003eç”Ÿå‘½å‘¨æœŸ\u003c/h1\u003e\n\u003cp\u003erustè‡ªåŠ¨æ¨æ–­å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-rust\" data-lang=\"rust\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003elongest\u003c/span\u003e(x: \u003cspan style=\"color:#66d9ef\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003estr\u003c/span\u003e, y: \u003cspan style=\"color:#66d9ef\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003estr\u003c/span\u003e) -\u0026gt; \u003cspan style=\"color:#66d9ef\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003estr\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e x.len() \u003cspan style=\"color:#f92672\"\u003e\u0026gt;\u003c/span\u003e y.len() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        x\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    } \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        y\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä½†æ˜¯ä¸Šé¢è¿™æ®µä»£ç ï¼Œrustæ— æ³•æ¨æ–­å‡ºå˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚æ‰€ä»¥éœ€è¦æ˜¾ç¤ºçš„æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å¹¶ä¸ä¼šæ”¹å˜ä»»ä½•å¼•ç”¨çš„å®é™…ä½œç”¨åŸŸ\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"å‚è€ƒèµ„æ–™\"\u003eå‚è€ƒèµ„æ–™\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://rustwiki.org/zh-CN/rust-by-example/index.html\"\u003eé€šè¿‡ä¾‹å­å­¦ Rust\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://kaisery.github.io/trpl-zh-cn/title-page.html\"\u003eRust ç¨‹åºè®¾è®¡è¯­è¨€\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://course.rs/about-book.html\"\u003eRustè¯­è¨€åœ£ç»(\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"å­¦ä¹ rust"},{"content":"pipxæ˜¯ä»€ä¹ˆï¼Ÿ å¯ä»¥å‚åŠ pipxçš„ä»‹ç»ã€‚\nä½œä¸ºä¸€ä¸ªpythonå°ç™½ï¼Œçœ‹äº†å‡ éï¼Œæœç´¢äº†å¤šç¯‡åšå®¢äº†è§£pipxæ˜¯ä»€ä¹ˆï¼Œä»ç„¶ä¸æ‡‚æ˜¯ä¸ªå•¥ã€‚\næˆ‘åœ¨è¿™ä»…è¯´æ˜ä¸€ä¸‹æˆ‘è‡ªå·±çš„ç†è§£ã€‚pipxç›¸å½“äºä¸€ä¸ªå®‰è£…å·¥å…·ã€‚pythonæœ‰è‡ªå·±çš„å®‰è£…åŒ…çš„å·¥å…·pipã€‚é‚£ä¹ˆpipå’Œpipxæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\nå¦‚æœç›´æ¥pipå®‰è£…åŒ…ä¼šå®‰è£…åœ¨pythonç›®å½•ä¸‹çš„site-packagesä¸‹ã€‚ç”±äºè¿™æ˜¯ä¸ªå…¨å±€ç›®å½•ã€‚å¦‚æœåœ¨ä¸åŒçš„é¡¹ç›®é‡Œé¢ï¼Œå¯èƒ½ä½¿ç”¨çš„å„ä¸ªåŒ…ç‰ˆæœ¬ä¸åŒï¼Œå¯èƒ½ä¼šäº§ç”Ÿå†²çªã€‚æ‰€ä»¥æˆ‘ä»¬åå‘ä½¿ç”¨ä¸€ä¸ªå¹²å‡€çš„site-packageã€‚å…¶å®pythonæä¾›äº†è§£å†³æ–¹æ¡ˆ\u0026ndash;è™šæ‹Ÿç¯å¢ƒã€‚pipxåªæ˜¯åŸºäºè¿™ä¸ªæ¦‚å¿µï¼Œè®©ä½¿ç”¨è€…æ›´å¥½çš„ä½¿ç”¨ã€‚\næ³¨æ„ pipx å®‰è£…çš„æ˜¯ä¸€äº›å¯æ‰§è¡Œçš„pythonåº”ç”¨ã€‚æ¯”å¦‚ poetry, jupyterç­‰\nç®€å•ä½¿ç”¨ å®‰è£…pipx\nbrew install pipx pipx ensurepath å®‰è£…jupyter\nå¯ä»¥ä½¿ç”¨--pythonå‚æ•°æŒ‡å®šè™šæ‹Ÿç¯å¢ƒpythonç‰ˆæœ¬ã€‚å¦‚æœä¸æŒ‡å®šï¼Œä½¿ç”¨çš„æ˜¯ä½ ç”µè„‘ä¸Šå®‰è£…çš„æœ€æ–°çš„python`ç‰ˆæœ¬ã€‚\npipx install notebook --python=python3.11 --force æ‰§è¡Œå, jupyterå°±ä¼šè¢«å®‰è£…åœ¨ ~/.local/pipx/venvs/notebook/binã€‚å¯ä»¥çœ‹åˆ°åœ¨pipxçš„venvsç›®å½•ä¸‹é¢ã€‚ä¹Ÿå°±è¯´pipxå®‰è£…çš„æ¯ä¸ªåº”ç”¨éƒ½ä¼šæœ‰è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒã€‚\nåœ¨å†™jupyter notebookçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦numpyï¼Œpandaç­‰è¿™äº›pythonåº“ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™äº›å®‰è£…åˆ°notebookçš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œæ‰èƒ½ä½¿ç”¨\npipx inject notebook pandas numpy é—®é¢˜è®°å½• å¦‚æœpipx injectçš„æ—¶å€™éœ€è¦ä½¿ç”¨proxyã€‚ç”±äºåº•å±‚è¿˜æ˜¯ä½¿ç”¨pipï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡PIP_*çš„ç¯å¢ƒå˜é‡ä¼ é€’proxyä¿¡æ¯ export PIP_PROXY=http://127.0.0.1:7890 https_proxy=http://127.0.0.1:7890 ","permalink":"https://carlos19960601.github.io/posts/pipx%E4%BD%BF%E7%94%A8/","summary":"\u003ch1 id=\"pipxæ˜¯ä»€ä¹ˆ\"\u003epipxæ˜¯ä»€ä¹ˆï¼Ÿ\u003c/h1\u003e\n\u003cp\u003eå¯ä»¥å‚åŠ \u003ca href=\"https://github.com/pypa/pipx\"\u003epipx\u003c/a\u003eçš„ä»‹ç»ã€‚\u003c/p\u003e\n\u003cp\u003eä½œä¸ºä¸€ä¸ªpythonå°ç™½ï¼Œçœ‹äº†å‡ éï¼Œæœç´¢äº†å¤šç¯‡åšå®¢äº†è§£\u003ccode\u003epipx\u003c/code\u003eæ˜¯ä»€ä¹ˆï¼Œä»ç„¶ä¸æ‡‚æ˜¯ä¸ªå•¥ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘åœ¨è¿™ä»…è¯´æ˜ä¸€ä¸‹æˆ‘è‡ªå·±çš„ç†è§£ã€‚\u003ccode\u003epipx\u003c/code\u003eç›¸å½“äºä¸€ä¸ªå®‰è£…å·¥å…·ã€‚\u003ccode\u003epython\u003c/code\u003eæœ‰è‡ªå·±çš„å®‰è£…åŒ…çš„å·¥å…·\u003ccode\u003epip\u003c/code\u003eã€‚é‚£ä¹ˆ\u003ccode\u003epip\u003c/code\u003eå’Œ\u003ccode\u003epipx\u003c/code\u003eæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå¦‚æœç›´æ¥\u003ccode\u003epip\u003c/code\u003eå®‰è£…åŒ…ä¼šå®‰è£…åœ¨\u003ccode\u003epython\u003c/code\u003eç›®å½•ä¸‹çš„\u003ccode\u003esite-packages\u003c/code\u003eä¸‹ã€‚ç”±äºè¿™æ˜¯ä¸ªå…¨å±€ç›®å½•ã€‚å¦‚æœåœ¨ä¸åŒçš„é¡¹ç›®é‡Œé¢ï¼Œå¯èƒ½ä½¿ç”¨çš„å„ä¸ªåŒ…ç‰ˆæœ¬ä¸åŒï¼Œå¯èƒ½ä¼šäº§ç”Ÿå†²çªã€‚æ‰€ä»¥æˆ‘ä»¬åå‘ä½¿ç”¨ä¸€ä¸ªå¹²å‡€çš„\u003ccode\u003esite-package\u003c/code\u003eã€‚å…¶å®\u003ccode\u003epython\u003c/code\u003eæä¾›äº†è§£å†³æ–¹æ¡ˆ\u0026ndash;è™šæ‹Ÿç¯å¢ƒã€‚\u003ccode\u003epipx\u003c/code\u003eåªæ˜¯åŸºäºè¿™ä¸ªæ¦‚å¿µï¼Œè®©ä½¿ç”¨è€…æ›´å¥½çš„ä½¿ç”¨ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ³¨æ„ pipx å®‰è£…çš„æ˜¯ä¸€äº›å¯æ‰§è¡Œçš„pythonåº”ç”¨ã€‚æ¯”å¦‚ poetry, jupyterç­‰\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch1 id=\"ç®€å•ä½¿ç”¨\"\u003eç®€å•ä½¿ç”¨\u003c/h1\u003e\n\u003cp\u003eå®‰è£…pipx\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-shells\" data-lang=\"shells\"\u003ebrew install pipx\npipx ensurepath\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eå®‰è£…jupyter\u003c/p\u003e\n\u003cp\u003eå¯ä»¥ä½¿ç”¨\u003ccode\u003e--python\u003c/code\u003eå‚æ•°æŒ‡å®šè™šæ‹Ÿç¯å¢ƒpython\u003ccode\u003eç‰ˆæœ¬ã€‚å¦‚æœä¸æŒ‡å®šï¼Œä½¿ç”¨çš„æ˜¯ä½ ç”µè„‘ä¸Šå®‰è£…çš„æœ€æ–°çš„\u003c/code\u003epython`ç‰ˆæœ¬ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epipx install notebook --python\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003epython3.11 --force\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæ‰§è¡Œå, jupyterå°±ä¼šè¢«å®‰è£…åœ¨ \u003ccode\u003e~/.local/pipx/venvs/notebook/bin\u003c/code\u003eã€‚å¯ä»¥çœ‹åˆ°åœ¨\u003ccode\u003epipx\u003c/code\u003eçš„\u003ccode\u003evenvs\u003c/code\u003eç›®å½•ä¸‹é¢ã€‚ä¹Ÿå°±è¯´\u003ccode\u003epipx\u003c/code\u003eå®‰è£…çš„æ¯ä¸ªåº”ç”¨éƒ½ä¼šæœ‰è‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨å†™jupyter notebookçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦\u003ccode\u003enumpy\u003c/code\u003eï¼Œ\u003ccode\u003epanda\u003c/code\u003eç­‰è¿™äº›\u003ccode\u003epython\u003c/code\u003eåº“ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™äº›å®‰è£…åˆ°notebookçš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œæ‰èƒ½ä½¿ç”¨\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode class=\"language-shells\" data-lang=\"shells\"\u003epipx inject notebook pandas numpy\n\u003c/code\u003e\u003c/pre\u003e\u003ch1 id=\"é—®é¢˜è®°å½•\"\u003eé—®é¢˜è®°å½•\u003c/h1\u003e\n\u003col\u003e\n\u003cli\u003eå¦‚æœpipx injectçš„æ—¶å€™éœ€è¦ä½¿ç”¨proxyã€‚ç”±äºåº•å±‚è¿˜æ˜¯ä½¿ç”¨pipï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡PIP_*çš„ç¯å¢ƒå˜é‡ä¼ é€’proxyä¿¡æ¯\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport PIP_PROXY\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ehttp://127.0.0.1:7890 https_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ehttp://127.0.0.1:7890\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"pipxä½¿ç”¨"},{"content":"å…ƒå­—ç¬¦ æ­£åˆ™è¡¨è¾¾å¼ä¸»è¦ä¾èµ–äºå…ƒå­—ç¬¦ã€‚\nå…ƒå­—ç¬¦ä¸ä»£è¡¨ä»–ä»¬æœ¬èº«çš„å­—é¢æ„æ€ï¼Œä»–ä»¬éƒ½æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚ä¸€äº›å…ƒå­—ç¬¦å†™åœ¨æ–¹æ‹¬å·ä¸­çš„æ—¶å€™æœ‰ä¸€äº›ç‰¹æ®Šçš„æ„æ€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…ƒå­—ç¬¦çš„ä»‹ç»ï¼š\nå…ƒå­—ç¬¦ æè¿° . å¥å·åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦é™¤äº†æ¢è¡Œç¬¦ã€‚ [ ] å­—ç¬¦ç§ç±»ã€‚åŒ¹é…æ–¹æ‹¬å·å†…çš„ä»»æ„å­—ç¬¦ã€‚ [^ ] å¦å®šçš„å­—ç¬¦ç§ç±»ã€‚åŒ¹é…é™¤äº†æ–¹æ‹¬å·é‡Œçš„ä»»æ„å­—ç¬¦ * åŒ¹é…\u0026gt;=0ä¸ªé‡å¤çš„åœ¨*å·ä¹‹å‰çš„å­—ç¬¦ã€‚ + åŒ¹é…\u0026gt;=1ä¸ªé‡å¤çš„+å·å‰çš„å­—ç¬¦ã€‚ ? æ ‡è®°?ä¹‹å‰çš„å­—ç¬¦ä¸ºå¯é€‰. {n,m} åŒ¹é…numä¸ªå¤§æ‹¬å·ä¹‹å‰çš„å­—ç¬¦æˆ–å­—ç¬¦é›† (n \u0026lt;= num \u0026lt;= m). (xyz) å­—ç¬¦é›†ï¼ŒåŒ¹é…ä¸ xyz å®Œå…¨ç›¸ç­‰çš„å­—ç¬¦ä¸². | æˆ–è¿ç®—ç¬¦ï¼ŒåŒ¹é…ç¬¦å·å‰æˆ–åçš„å­—ç¬¦. \\ è½¬ä¹‰å­—ç¬¦,ç”¨äºåŒ¹é…ä¸€äº›ä¿ç•™çš„å­—ç¬¦ [ ] ( ) { } . * + ? ^ $ \\ | ^ ä»å¼€å§‹è¡Œå¼€å§‹åŒ¹é…. $ ä»æœ«ç«¯å¼€å§‹åŒ¹é…. ç®€å†™å­—ç¬¦é›† æ­£åˆ™è¡¨è¾¾å¼æä¾›ä¸€äº›å¸¸ç”¨çš„å­—ç¬¦é›†ç®€å†™ã€‚å¦‚ä¸‹:\nç®€å†™ æè¿° . é™¤æ¢è¡Œç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦ \\w åŒ¹é…æ‰€æœ‰å­—æ¯æ•°å­—ï¼Œç­‰åŒäº [a-zA-Z0-9_] \\W åŒ¹é…æ‰€æœ‰éå­—æ¯æ•°å­—ï¼Œå³ç¬¦å·ï¼Œç­‰åŒäºï¼š [^\\w] \\d åŒ¹é…æ•°å­—ï¼š [0-9] \\D åŒ¹é…éæ•°å­—ï¼š [^\\d] \\s åŒ¹é…æ‰€æœ‰ç©ºæ ¼å­—ç¬¦ï¼Œç­‰åŒäºï¼š [\\t\\n\\f\\r\\p{Z}] \\S åŒ¹é…æ‰€æœ‰éç©ºæ ¼å­—ç¬¦ï¼š [^\\s] \\f åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ \\n åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ \\r åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ \\t åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ \\v åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ \\p åŒ¹é… CR/LFï¼ˆç­‰åŒäº \\r\\nï¼‰ï¼Œç”¨æ¥åŒ¹é… DOS è¡Œç»ˆæ­¢ç¬¦ é›¶å®½åº¦æ–­è¨€ï¼ˆå‰åé¢„æŸ¥ï¼‰ å…ˆè¡Œæ–­è¨€å’Œåå‘æ–­è¨€ï¼ˆåˆç§° lookaroundï¼‰éƒ½å±äºéæ•è·ç»„ï¼ˆç”¨äºåŒ¹é…æ¨¡å¼ï¼Œä½†ä¸åŒ…æ‹¬åœ¨åŒ¹é…åˆ—è¡¨ä¸­ï¼‰ã€‚å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¨¡å¼çš„å‰é¢æˆ–åé¢æœ‰å¦ä¸€ä¸ªç‰¹å®šçš„æ¨¡å¼æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›ä»ä¸‹é¢çš„è¾“å…¥å­—ç¬¦ä¸² $4.44 å’Œ $10.88 ä¸­è·å¾—æ‰€æœ‰ä»¥ $ å­—ç¬¦å¼€å¤´çš„æ•°å­—ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹çš„æ­£åˆ™è¡¨è¾¾å¼ (?\u0026lt;=\\$)[0-9\\.]*ã€‚æ„æ€æ˜¯ï¼šè·å–æ‰€æœ‰åŒ…å« . å¹¶ä¸”å‰é¢æ˜¯ $ çš„æ•°å­—ã€‚\né›¶å®½åº¦æ–­è¨€å¦‚ä¸‹ï¼š\nç¬¦å· æè¿° ?= æ­£å…ˆè¡Œæ–­è¨€-å­˜åœ¨ ?! è´Ÿå…ˆè¡Œæ–­è¨€-æ’é™¤ ?\u0026lt;= æ­£åå‘æ–­è¨€-å­˜åœ¨ ?\u0026lt;! è´Ÿåå‘æ–­è¨€-æ’é™¤ æ ‡å¿— æ ‡å¿—ä¹Ÿå«æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œå› ä¸ºå®ƒå¯ä»¥ç”¨æ¥ä¿®æ”¹è¡¨è¾¾å¼çš„æœç´¢ç»“æœã€‚ è¿™äº›æ ‡å¿—å¯ä»¥ä»»æ„çš„ç»„åˆä½¿ç”¨ï¼Œå®ƒä¹Ÿæ˜¯æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ã€‚\næ ‡å¿— æè¿° i å¿½ç•¥å¤§å°å†™ã€‚ g å…¨å±€æœç´¢ã€‚ m å¤šè¡Œä¿®é¥°ç¬¦ï¼šé”šç‚¹å…ƒå­—ç¬¦ ^ $ å·¥ä½œèŒƒå›´åœ¨æ¯è¡Œçš„èµ·å§‹ã€‚ è´ªå©ªåŒ¹é…ä¸æƒ°æ€§åŒ¹é… (Greedy vs lazy matching) æ­£åˆ™è¡¨è¾¾å¼é»˜è®¤é‡‡ç”¨è´ªå©ªåŒ¹é…æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹æ„å‘³ç€ä¼šåŒ¹é…å°½å¯èƒ½é•¿çš„å­ä¸²ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ? å°†è´ªå©ªåŒ¹é…æ¨¡å¼è½¬åŒ–ä¸ºæƒ°æ€§åŒ¹é…æ¨¡å¼ã€‚%\n","permalink":"https://carlos19960601.github.io/posts/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/","summary":"\u003ch1 id=\"å…ƒå­—ç¬¦\"\u003eå…ƒå­—ç¬¦\u003c/h1\u003e\n\u003cp\u003eæ­£åˆ™è¡¨è¾¾å¼ä¸»è¦ä¾èµ–äºå…ƒå­—ç¬¦ã€‚\u003c/p\u003e\n\u003cp\u003eå…ƒå­—ç¬¦ä¸ä»£è¡¨ä»–ä»¬æœ¬èº«çš„å­—é¢æ„æ€ï¼Œä»–ä»¬éƒ½æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚ä¸€äº›å…ƒå­—ç¬¦å†™åœ¨æ–¹æ‹¬å·ä¸­çš„æ—¶å€™æœ‰ä¸€äº›ç‰¹æ®Šçš„æ„æ€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…ƒå­—ç¬¦çš„ä»‹ç»ï¼š\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth style=\"text-align: center\"\u003eå…ƒå­—ç¬¦\u003c/th\u003e\n          \u003cth\u003eæè¿°\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e.\u003c/td\u003e\n          \u003ctd\u003eå¥å·åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦é™¤äº†æ¢è¡Œç¬¦ã€‚\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e[ ]\u003c/td\u003e\n          \u003ctd\u003eå­—ç¬¦ç§ç±»ã€‚åŒ¹é…æ–¹æ‹¬å·å†…çš„ä»»æ„å­—ç¬¦ã€‚\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e[^ ]\u003c/td\u003e\n          \u003ctd\u003eå¦å®šçš„å­—ç¬¦ç§ç±»ã€‚åŒ¹é…é™¤äº†æ–¹æ‹¬å·é‡Œçš„ä»»æ„å­—ç¬¦\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e*\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…\u0026gt;=0ä¸ªé‡å¤çš„åœ¨*å·ä¹‹å‰çš„å­—ç¬¦ã€‚\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e+\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…\u0026gt;=1ä¸ªé‡å¤çš„+å·å‰çš„å­—ç¬¦ã€‚\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e?\u003c/td\u003e\n          \u003ctd\u003eæ ‡è®°?ä¹‹å‰çš„å­—ç¬¦ä¸ºå¯é€‰.\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e{n,m}\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…numä¸ªå¤§æ‹¬å·ä¹‹å‰çš„å­—ç¬¦æˆ–å­—ç¬¦é›† (n \u0026lt;= num \u0026lt;= m).\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e(xyz)\u003c/td\u003e\n          \u003ctd\u003eå­—ç¬¦é›†ï¼ŒåŒ¹é…ä¸ xyz å®Œå…¨ç›¸ç­‰çš„å­—ç¬¦ä¸².\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e|\u003c/td\u003e\n          \u003ctd\u003eæˆ–è¿ç®—ç¬¦ï¼ŒåŒ¹é…ç¬¦å·å‰æˆ–åçš„å­—ç¬¦.\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\\u003c/td\u003e\n          \u003ctd\u003eè½¬ä¹‰å­—ç¬¦,ç”¨äºåŒ¹é…ä¸€äº›ä¿ç•™çš„å­—ç¬¦ \u003c!-- raw HTML omitted --\u003e[ ] ( ) { } . * + ? ^ $ \\ |\u003c!-- raw HTML omitted --\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e^\u003c/td\u003e\n          \u003ctd\u003eä»å¼€å§‹è¡Œå¼€å§‹åŒ¹é….\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e$\u003c/td\u003e\n          \u003ctd\u003eä»æœ«ç«¯å¼€å§‹åŒ¹é….\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch1 id=\"ç®€å†™å­—ç¬¦é›†\"\u003eç®€å†™å­—ç¬¦é›†\u003c/h1\u003e\n\u003cp\u003eæ­£åˆ™è¡¨è¾¾å¼æä¾›ä¸€äº›å¸¸ç”¨çš„å­—ç¬¦é›†ç®€å†™ã€‚å¦‚ä¸‹:\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth style=\"text-align: center\"\u003eç®€å†™\u003c/th\u003e\n          \u003cth\u003eæè¿°\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e.\u003c/td\u003e\n          \u003ctd\u003eé™¤æ¢è¡Œç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\w\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…æ‰€æœ‰å­—æ¯æ•°å­—ï¼Œç­‰åŒäº \u003ccode\u003e[a-zA-Z0-9_]\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\W\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…æ‰€æœ‰éå­—æ¯æ•°å­—ï¼Œå³ç¬¦å·ï¼Œç­‰åŒäºï¼š \u003ccode\u003e[^\\w]\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\d\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…æ•°å­—ï¼š \u003ccode\u003e[0-9]\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\D\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…éæ•°å­—ï¼š \u003ccode\u003e[^\\d]\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\s\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…æ‰€æœ‰ç©ºæ ¼å­—ç¬¦ï¼Œç­‰åŒäºï¼š \u003ccode\u003e[\\t\\n\\f\\r\\p{Z}]\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\S\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…æ‰€æœ‰éç©ºæ ¼å­—ç¬¦ï¼š \u003ccode\u003e[^\\s]\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\f\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\n\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\r\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\t\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\v\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e\\p\u003c/td\u003e\n          \u003ctd\u003eåŒ¹é… CR/LFï¼ˆç­‰åŒäº \u003ccode\u003e\\r\\n\u003c/code\u003eï¼‰ï¼Œç”¨æ¥åŒ¹é… DOS è¡Œç»ˆæ­¢ç¬¦\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch1 id=\"é›¶å®½åº¦æ–­è¨€å‰åé¢„æŸ¥\"\u003eé›¶å®½åº¦æ–­è¨€ï¼ˆå‰åé¢„æŸ¥ï¼‰\u003c/h1\u003e\n\u003cp\u003eå…ˆè¡Œæ–­è¨€å’Œåå‘æ–­è¨€ï¼ˆåˆç§° lookaroundï¼‰éƒ½å±äº\u003cstrong\u003eéæ•è·ç»„\u003c/strong\u003eï¼ˆç”¨äºåŒ¹é…æ¨¡å¼ï¼Œä½†ä¸åŒ…æ‹¬åœ¨åŒ¹é…åˆ—è¡¨ä¸­ï¼‰ã€‚å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¨¡å¼çš„å‰é¢æˆ–åé¢æœ‰å¦ä¸€ä¸ªç‰¹å®šçš„æ¨¡å¼æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚\u003c/p\u003e","title":"æ­£åˆ™è¡¨è¾¾å¼"},{"content":"å®‰è£…Docker å‚è€ƒInstall using the apt repository\n# Add Docker\u0026#39;s official GPG key: sudo apt-get update sudo apt-get install ca-certificates curl sudo install -m 0755 -d /etc/apt/keyrings sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc sudo chmod a+r /etc/apt/keyrings/docker.asc # Add the repository to Apt sources: echo \\ \u0026#34;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \\ $(. /etc/os-release \u0026amp;\u0026amp; echo \u0026#34;$VERSION_CODENAME\u0026#34;) stable\u0026#34; | \\ sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null sudo apt-get update å…¶ä¸­åœ¨è¿™æ­¥ä¸­ï¼Œå³ä½¿è®¾ç½®äº†Proxy\nexport https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890 å¥½åƒå¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œæˆ‘å½“æ—¶æ˜¯ç›´æ¥ä¸‹è½½gpgæ–‡ä»¶ï¼Œç„¶åæ‰‹åŠ¨copyåˆ°/etc/apt/keyrings/docker.asc\nå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨\nsudo curl -x http://127.0.0.1:7890 -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc åç»­å®‰è£…å°±å¾ˆé¡ºåˆ©äº†ã€‚\nå…³äºDockerä½¿ç”¨Proxy å‚è€ƒConfigure Docker to use a proxy server\nè¿™é‡Œè¯´æ˜äº†2ä¸­Proxyã€‚ä¸€ç§æ˜¯Dockerè‡ªèº«ä½¿ç”¨Proxyã€‚ä¸€ç§æ˜¯Docker Containerå®¹å™¨ä½¿ç”¨Proxyã€‚\nä¸€èˆ¬æˆ‘ä»¬pull imageéœ€è¦ä½¿ç”¨Proxyåº”è¯¥é…ç½®Docker deamon /etc/docker/daemon.json\n{ \u0026#34;proxies\u0026#34;: { \u0026#34;http-proxy\u0026#34;: \u0026#34;http://127.0.0.1:7890\u0026#34;, \u0026#34;https-proxy\u0026#34;: \u0026#34;http://127.0.0.1:7890\u0026#34;, \u0026#34;no-proxy\u0026#34;: \u0026#34;127.0.0.0/8\u0026#34; } } æœ€ååˆ«å¿˜äº†\nsudo systemctl restart docker æˆ‘çŠ¯é”™å°±æ˜¯é…ç½®æˆ~/.docker/config.jsonï¼Œå¯¼è‡´å®¹å™¨ä¸­ä½¿ç”¨http-proxyè¯·æ±‚127.0.0.1è¯·æ±‚ä¸åŒï¼Œå®¹å™¨ä¹‹é—´é€šä¿¡å¤±è´¥ã€‚\n{ \u0026#34;proxies\u0026#34;: { \u0026#34;default\u0026#34;: { \u0026#34;http-proxy\u0026#34;: \u0026#34;http://127.0.0.1:7890\u0026#34;, \u0026#34;https-proxy\u0026#34;: \u0026#34;http://127.0.0.1:7890\u0026#34;, \u0026#34;no-proxy\u0026#34;: \u0026#34;127.0.0.0/8\u0026#34; } } } ","permalink":"https://carlos19960601.github.io/posts/docker%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/","summary":"\u003ch1 id=\"å®‰è£…docker\"\u003eå®‰è£…Docker\u003c/h1\u003e\n\u003cp\u003eå‚è€ƒ\u003ca href=\"https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository\"\u003eInstall using the apt repository\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Add Docker\u0026#39;s official GPG key:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get install ca-certificates curl\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo install -m \u003cspan style=\"color:#ae81ff\"\u003e0755\u003c/span\u003e -d /etc/apt/keyrings\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo chmod a+r /etc/apt/keyrings/docker.asc\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Add the repository to Apt sources:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;deb [arch=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003edpkg --print-architecture\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e  \u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003e. /etc/os-release \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e echo \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e$VERSION_CODENAME\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e stable\u0026#34;\u003c/span\u003e | \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e  sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get update\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå…¶ä¸­åœ¨è¿™æ­¥ä¸­ï¼Œå³ä½¿è®¾ç½®äº†Proxy\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport https_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ehttp://127.0.0.1:7890 http_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ehttp://127.0.0.1:7890 all_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esocks5://127.0.0.1:7890\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eå¥½åƒå¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œæˆ‘å½“æ—¶æ˜¯ç›´æ¥ä¸‹è½½\u003ccode\u003egpg\u003c/code\u003eæ–‡ä»¶ï¼Œç„¶åæ‰‹åŠ¨copyåˆ°\u003ccode\u003e/etc/apt/keyrings/docker.asc\u003c/code\u003e\u003c/p\u003e","title":"Dockerä½¿ç”¨é—®é¢˜è®°å½•"},{"content":"æœ€è¿‘åœ¨çœ‹ 3Blue1Brownçš„Essence of linear algebraã€‚é¢„ä¹ ä¸€ä¸‹å¤§å­¦çŸ¥è¯†ã€‚\nçº¿æ€§å˜æ¢ çº¿æ€§å˜æ¢çŸ©é˜µå¯ä»¥çœ‹ä½œæ˜¯å˜æ¢ä¹‹ååæ ‡ç³»çš„ i, j å•ä½å‘é‡\nçŸ©é˜µä¹˜æ³• çŸ©é˜µä¹˜æ³•å¯ä»¥æ˜¯çœ‹ä½œæ˜¯ä»å³åˆ°å·¦è¿›è¡Œå¤šæ¬¡å˜åŒ–ã€‚\nåŒæ ·çš„3ç»´å°±æ˜¯å¯¹3ç»´ç©ºé—´è¿›è¡Œå˜æ¢ã€‚\nè¡Œåˆ—å¼ è¡Œåˆ—å¼è¡¨ç¤ºå°†é¢ç§¯ç¼©æ”¾çš„å¤§å°\nç‚¹ç§¯ åœ¨å¤§å­¦è¯¾å ‚ä¸Šï¼Œè€å¸ˆè¯´ç‚¹ç§¯æ˜¯å‘é‡é•¿åº¦å’Œå¦å¤–ä¸€ä¸ªå‘é‡ä¸Šåœ¨è¯¥å‘é‡æ–¹å‘ä¸ŠæŠ•å½±çš„ç§¯ã€‚ä½†æ˜¯ä¸€ç›´ä¸æ˜ç™½ä¸ºä»€ä¹ˆã€‚\nå…¶å®å¯ä»¥æŠŠå…¶ä¸­ä¸€ä¸ªå‘é‡çœ‹æˆä¸€ç§å˜æ¢ã€‚ä»äºŒç»´åˆ°ä¸€ç»´çš„è½¬æ¢ã€‚\nå‚è€ƒèµ„æ–™ Essence of linear algebra ","permalink":"https://carlos19960601.github.io/posts/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/","summary":"\u003cp\u003eæœ€è¿‘åœ¨çœ‹ \u003ca href=\"https://www.youtube.com/@3blue1brown\"\u003e3Blue1Brown\u003c/a\u003eçš„\u003ca href=\"https://www.youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab\"\u003eEssence of linear algebra\u003c/a\u003eã€‚é¢„ä¹ ä¸€ä¸‹å¤§å­¦çŸ¥è¯†ã€‚\u003c/p\u003e\n\u003ch1 id=\"çº¿æ€§å˜æ¢\"\u003eçº¿æ€§å˜æ¢\u003c/h1\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e7%ba%bf%e6%80%a7%e4%bb%a3%e6%95%b0/Transform.png\" alt=\"Transform\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003eçº¿æ€§å˜æ¢çŸ©é˜µå¯ä»¥çœ‹ä½œæ˜¯å˜æ¢ä¹‹ååæ ‡ç³»çš„ \u003cstrong\u003ei\u003c/strong\u003e, \u003cstrong\u003ej\u003c/strong\u003e å•ä½å‘é‡\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e7%ba%bf%e6%80%a7%e4%bb%a3%e6%95%b0/transform.gif\" alt=\"Transform\"  /\u003e\n\u003c/p\u003e\n\u003ch1 id=\"çŸ©é˜µä¹˜æ³•\"\u003eçŸ©é˜µä¹˜æ³•\u003c/h1\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e7%ba%bf%e6%80%a7%e4%bb%a3%e6%95%b0/Matrix%20multiplication.png\" alt=\"Matrix multiplication\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003eçŸ©é˜µä¹˜æ³•å¯ä»¥æ˜¯çœ‹ä½œæ˜¯ä»å³åˆ°å·¦è¿›è¡Œå¤šæ¬¡å˜åŒ–ã€‚\u003c/p\u003e\n\u003cp\u003eåŒæ ·çš„3ç»´å°±æ˜¯å¯¹3ç»´ç©ºé—´è¿›è¡Œå˜æ¢ã€‚\u003c/p\u003e\n\u003ch1 id=\"è¡Œåˆ—å¼\"\u003eè¡Œåˆ—å¼\u003c/h1\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e7%ba%bf%e6%80%a7%e4%bb%a3%e6%95%b0/%e8%a1%8c%e5%88%97%e5%bc%8f.png\" alt=\"è¡Œåˆ—å¼\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003eè¡Œåˆ—å¼è¡¨ç¤ºå°†é¢ç§¯ç¼©æ”¾çš„å¤§å°\u003c/p\u003e\n\u003ch1 id=\"ç‚¹ç§¯\"\u003eç‚¹ç§¯\u003c/h1\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e7%ba%bf%e6%80%a7%e4%bb%a3%e6%95%b0/dot.gif\" alt=\"dot\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003eåœ¨å¤§å­¦è¯¾å ‚ä¸Šï¼Œè€å¸ˆè¯´ç‚¹ç§¯æ˜¯å‘é‡é•¿åº¦å’Œå¦å¤–ä¸€ä¸ªå‘é‡ä¸Šåœ¨è¯¥å‘é‡æ–¹å‘ä¸ŠæŠ•å½±çš„ç§¯ã€‚ä½†æ˜¯ä¸€ç›´ä¸æ˜ç™½ä¸ºä»€ä¹ˆã€‚\u003c/p\u003e\n\u003cp\u003eå…¶å®å¯ä»¥æŠŠå…¶ä¸­ä¸€ä¸ªå‘é‡çœ‹æˆä¸€ç§å˜æ¢ã€‚ä»äºŒç»´åˆ°ä¸€ç»´çš„è½¬æ¢ã€‚\u003c/p\u003e\n\u003ch1 id=\"å‚è€ƒèµ„æ–™\"\u003eå‚è€ƒèµ„æ–™\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab\"\u003eEssence of linear algebra\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"çº¿æ€§ä»£æ•°"},{"content":"Socks5åè®® å…·ä½“åè®®è¿‡ç¨‹å‚è€ƒç†è§£socks5åè®®çš„å·¥ä½œè¿‡ç¨‹å’Œåè®®ç»†èŠ‚ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯é€šè¿‡ä»£ç å»ç†è§£socks5åè®®ã€‚\nå®éªŒæ¡ä»¶ä»‹ç» å‘½ä»¤è¡Œè®¾ç½®proxy\nexport https_proxy=socks5://127.0.0.1:7891 http_proxy=socks5://127.0.0.1:7891 ä¹‹åé€šè¿‡curlå‘èµ·httpè¯·æ±‚ã€‚\ncurl www.baidu.com è¿™æ—¶å€™ï¼Œcurlè¿™ä¸ªå‘½ä»¤å°±ä¼šèµ°socksåè®®ï¼Œå¹¶å°è£…socksåè®®æ•°æ®å‘é€ç»™socks5://127.0.0.1:7891ã€‚\nåå•†é˜¶æ®µ æ ¹æ®å‚è€ƒèµ„æ–™ï¼Œæ¡æ‰‹é˜¶æ®µ-åå•†é˜¶æ®µå‘é€çš„æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š\n+----+----------+----------+ |VER | NMETHODS | METHODS | +----+----------+----------+ | 1 | 1 | 1 to 255 | +----+----------+----------+ #ä¸Šæ–¹çš„æ•°å­—è¡¨ç¤ºå­—èŠ‚æ•°ï¼Œä¸‹é¢çš„è¡¨æ ¼åŒç†ï¼Œä¸å†èµ˜è¿° VER: åè®®ç‰ˆæœ¬ï¼Œsocks5ä¸º0x05\nNMETHODS: æ”¯æŒè®¤è¯çš„æ–¹æ³•æ•°é‡\nMETHODS: å¯¹åº”NMETHODSï¼ŒNMETHODSçš„å€¼ä¸ºå¤šå°‘ï¼ŒMETHODSå°±æœ‰å¤šå°‘ä¸ªå­—èŠ‚ã€‚RFCé¢„å®šä¹‰äº†ä¸€äº›å€¼çš„å«ä¹‰ï¼Œå†…å®¹å¦‚ä¸‹:\nXâ€™00â€™ NO AUTHENTICATION REQUIRED Xâ€™01â€™ GSSAPI Xâ€™02â€™ USERNAME/PASSWORD Xâ€™03â€™ to Xâ€™7Fâ€™ IANA ASSIGNED Xâ€™80â€™ to Xâ€™FEâ€™ RESERVED FOR PRIVATE METHODS Xâ€™FFâ€™ NO ACCEPTABLE METHODS é‚£ä¹ˆsocksæœåŠ¡ç«¯æ¥å—åˆ°è¯·æ±‚æ—¶ï¼Œéœ€è¦è§£æå†…å®¹ï¼Œé€‰ä¸­ä¸€ä¸ªMETHODè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ ¼å¼å¦‚ä¸‹:\n+----+--------+ |VER | METHOD | +----+--------+ | 1 | 1 | +----+--------+ func ServerHandshake(rw net.Conn, authenticator auth.Authenticator) (addr Addr, command Command, user string, err error) { ... if _, err = io.ReadFull(rw, buf[:2]); err != nil { return } nmethods := buf[1] if _, err = io.ReadFull(rw, buf[:nmethods]); err != nil { return } // è¿”å›ä¿¡æ¯,éœ€è¦è®¤è¯ if authenticator != nil { // ç‰ˆæœ¬å’Œè®¤è¯æ–¹æ³• if _, err = rw.Write([]byte{5, 2}); err != nil { return } } ... } ä¸Šé¢ä»£ç é€»è¾‘å°±æ˜¯å¤„ç†è¿™ä¸ªè¿‡ç¨‹ã€‚ä»£ç ä¸­å›ºå®šè¿”å›çš„æ˜¯Xâ€™02â€™ USERNAME/PASSWORDè¿™ç§è®¤è¯æ–¹å¼ã€‚\nè®¤è¯é˜¶æ®µ è®¤è¯é˜¶æ®µæ˜¯ä¸€ä¸ªå¯é€‰çš„é˜¶æ®µï¼Œå¦‚æœä¸éœ€è¦è®¤è¯ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡ã€‚\nå¦‚æœéœ€è¦è®¤è¯ï¼Œå®¢æˆ·ç«¯å‘socks5æœåŠ¡å™¨å‘èµ·ä¸€ä¸ªè®¤è¯è¯·æ±‚ï¼Œè¿™é‡Œä»¥0x02çš„è®¤è¯æ–¹å¼ä¸¾ä¾‹:\n|VER | ULEN | UNAME | PLEN | PASSWD | +----+------+----------+------+----------+ | 1 | 1 | 1 to 255 | 1 | 1 to 255 | +----+------+----------+------+----------+ VER: ç‰ˆæœ¬ï¼Œ**é€šå¸¸ä¸º`0x01`** ULEN: ç”¨æˆ·åé•¿åº¦ UNAME: å¯¹åº”ç”¨æˆ·åçš„å­—èŠ‚æ•°æ® PLEN: å¯†ç é•¿åº¦ PASSWD: å¯†ç å¯¹åº”çš„æ•°æ® socks5æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è®¤è¯è¯·æ±‚åï¼Œè§£æå†…å®¹ï¼ŒéªŒè¯ä¿¡æ¯æ˜¯å¦åˆæ³•ï¼Œç„¶åç»™å®¢æˆ·ç«¯å“åº”ç»“æœã€‚å“åº”æ ¼å¼å¦‚ä¸‹:\n+----+--------+ |VER | STATUS | +----+--------+ | 1 | 1 | +----+--------+ æ³¨æ„è¿™é‡Œçš„VERå¹¶ä¸å°‘socksçš„ç‰ˆæœ¬\nfunc ServerHandshake(rw net.Conn, authenticator auth.Authenticator) (addr Addr, command Command, user string, err error) { ... // è¿”å›ä¿¡æ¯,éœ€è¦è®¤è¯ if authenticator != nil { // ç‰ˆæœ¬å’Œè®¤è¯æ–¹æ³• if _, err = rw.Write([]byte{5, 2}); err != nil { return } // è®¤è¯é˜¶æ®µ header := make([]byte, 2) if _, err = io.ReadFull(rw, header); err != nil { return } authBuf := make([]byte, MaxAuthLen) // è¯»å–username userLen := int(header[1]) if userLen \u0026lt;= 0 { // è¿”å›è®¤è¯å¤±è´¥ rw.Write([]byte{1, 1}) err = ErrAuth return } if _, err = io.ReadFull(rw, authBuf[:userLen]); err != nil { return } user = string(authBuf[:userLen]) // è¯»å–pass if _, err = rw.Read(header[:1]); err != nil { return } passLen := int(header[0]) if passLen \u0026lt;= 0 { // è¿”å›è®¤è¯å¤±è´¥ rw.Write([]byte{1, 1}) err = ErrAuth return } if _, err = io.ReadFull(rw, authBuf[:userLen]); err != nil { return } pass := string(authBuf[:userLen]) if ok := authenticator.Verify(user, pass); !ok { // è¿”å›è®¤è¯å¤±è´¥ rw.Write([]byte{1, 1}) err = ErrAuth return } // è¿”å›è®¤æˆåŠŸ if _, err = rw.Write([]byte{1, 0}); err != nil { return } } else { // å‘Šè¯‰å®¢æˆ·ç«¯ä¸éœ€è¦éªŒè¯ if _, err = rw.Write([]byte{5, 0}); err != nil { return } } return } ... è¯·æ±‚é˜¶æ®µ é¡ºåˆ©é€šè¿‡åå•†é˜¶æ®µåï¼Œå®¢æˆ·ç«¯å‘socks5æœåŠ¡å™¨å‘èµ·è¯·æ±‚ç»†èŠ‚ï¼Œæ ¼å¼å¦‚ä¸‹:\n+----+-----+-------+------+----------+----------+ |VER | CMD | RSV | ATYP | DST.ADDR | DST.PORT | +----+-----+-------+------+----------+----------+ | 1 | 1 | X\u0026#39;00\u0026#39; | 1 | Variable | 2 | +----+-----+-------+------+----------+----------+ VER ç‰ˆæœ¬å·ï¼Œsocks5çš„å€¼ä¸º0x05 CMD 0x01è¡¨ç¤ºCONNECTè¯·æ±‚ 0x02è¡¨ç¤ºBINDè¯·æ±‚ 0x03è¡¨ç¤ºUDPè½¬å‘ RSV ä¿ç•™å­—æ®µï¼Œå€¼ä¸º0x00 ATYP ç›®æ ‡åœ°å€ç±»å‹ï¼ŒDST.ADDRçš„æ•°æ®å¯¹åº”è¿™ä¸ªå­—æ®µçš„ç±»å‹ã€‚ 0x01è¡¨ç¤ºIPv4åœ°å€ï¼ŒDST.ADDRä¸º4ä¸ªå­—èŠ‚ 0x03è¡¨ç¤ºåŸŸåï¼ŒDST.ADDRæ˜¯ä¸€ä¸ªå¯å˜é•¿åº¦çš„åŸŸå 0x04è¡¨ç¤ºIPv6åœ°å€ï¼ŒDST.ADDRä¸º16ä¸ªå­—èŠ‚é•¿åº¦ DST.ADDR ä¸€ä¸ªå¯å˜é•¿åº¦çš„å€¼ DST.PORT ç›®æ ‡ç«¯å£ï¼Œå›ºå®š2ä¸ªå­—èŠ‚ ä¸Šé¢çš„å€¼ä¸­ï¼ŒDST.ADDRæ˜¯ä¸€ä¸ªå˜é•¿çš„æ•°æ®ï¼Œå®ƒçš„æ•°æ®é•¿åº¦æ ¹æ®ATYPçš„ç±»å‹å†³å®šã€‚åˆ†ä¸ºä¸‹é¢3ç§æƒ…å†µ:\nXâ€™01â€™ ä¸€ä¸ª4å­—èŠ‚çš„ipv4åœ°å€ Xâ€™03â€™ ä¸€ä¸ªå¯å˜é•¿åº¦çš„åŸŸåï¼Œè¿™ç§æƒ…å†µä¸‹DST.ADDRçš„ç¬¬ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºåŸŸåé•¿åº¦ï¼Œå‰©ä¸‹éƒ¨åˆ†æ˜¯åŸŸåå†…å®¹ã€‚ Xâ€™04â€™ ä¸€ä¸ª16å­—èŠ‚çš„ipv6åœ°å€ socks5æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå“åº”ï¼Œç»“æ„å¦‚ä¸‹\n+----+-----+-------+------+----------+----------+ |VER | REP | RSV | ATYP | BND.ADDR | BND.PORT | +----+-----+-------+------+----------+----------+ | 1 | 1 | X\u0026#39;00\u0026#39; | 1 | Variable | 2 | +----+-----+-------+------+----------+----------+ VER socksç‰ˆæœ¬ï¼Œè¿™é‡Œä¸º0x05 REP Relay field,å†…å®¹å–å€¼å¦‚ä¸‹ Xâ€™00â€™ succeeded Xâ€™01â€™ general SOCKS server failure Xâ€™02â€™ connection not allowed by ruleset Xâ€™03â€™ Network unreachable Xâ€™04â€™ Host unreachable Xâ€™05â€™ Connection refused Xâ€™06â€™ TTL expired Xâ€™07â€™ Command not supported Xâ€™08â€™ Address type not supported Xâ€™09â€™ to Xâ€™FFâ€™ unassigned RSV ä¿ç•™å­—æ®µ ATYPE åŒè¯·æ±‚çš„ATYPE BND.ADDR æœåŠ¡ç»‘å®šçš„åœ°å€ BND.PORT æœåŠ¡ç»‘å®šçš„ç«¯å£DST.PORT // è¯·æ±‚é˜¶æ®µ if _, err = io.ReadFull(rw, buf[:3]); err != nil { return } command = buf[1] addr, err = ReadAddr(rw, buf) if err != nil { return } switch command { case CmdConnect, CmdUDPAssociate: localAddr := ParseAddr(rw.LocalAddr().String()) if localAddr == nil { err = ErrAddressNotSupported } else { // è¿”å›å“åº” _, err = rw.Write(bytes.Join([][]byte{{5, 0, 0}, localAddr}, []byte{})) } ... } func ReadAddr(r io.Reader, b []byte) (Addr, error) { _, err := io.ReadFull(r, b[:1]) if err != nil { return nil, err } switch b[0] { case AtypDomainName: _, err = io.ReadFull(r, b[1:2]) if err != nil { return nil, err } domainLength := uint16(b[1]) _, err = io.ReadFull(r, b[2:2+domainLength+2]) return b[:1+1+domainLength+2], err case AtypIPv4: _, err = io.ReadFull(r, b[1:1+net.IPv4len+2]) return b[:1+net.IPv4len+2], err case AtypIPv6: _, err = io.ReadFull(r, b[1:1+net.IPv6len+2]) return b[:1+net.IPv6len+2], err } return nil, ErrAddressNotSupported } Relayé˜¶æ®µ socks5æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œè§£æå†…å®¹ã€‚å¦‚æœæ˜¯UDPè¯·æ±‚ï¼ŒæœåŠ¡å™¨ç›´æ¥è½¬å‘; å¦‚æœæ˜¯TCPè¯·æ±‚ï¼ŒæœåŠ¡å™¨å‘ç›®æ ‡æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ï¼Œåç»­è´Ÿè´£æŠŠå®¢æˆ·ç«¯çš„æ‰€æœ‰æ•°æ®è½¬å‘åˆ°ç›®æ ‡æœåŠ¡ã€‚\nTrojanåè®® è¿æ¥TrojanæœåŠ¡ç«¯éœ€è¦TLSæ¡æ‰‹ï¼Œåç»­çš„æµé‡å°±æ˜¯TLSä¿æŠ¤çš„äº†ã€‚\ntrojanå®¢æˆ·ç«¯ä¸trojanæœåŠ¡ç«¯ä¹‹é—´ä½¿ç”¨è‡ªå®šä¹‰çš„åè®®ï¼Œå®˜æ–¹æ–‡æ¡£ä¸Šå·²ç»æœ‰ç›¸åº”çš„è¯´æ˜ï¼š\n+-----------------------+---------+----------------+---------+----------+ | hex(SHA224(password)) | CRLF | Trojan Request | CRLF | Payload | +-----------------------+---------+----------------+---------+----------+ | 56 | X\u0026#39;0D0A\u0026#39; | Variable | X\u0026#39;0D0A\u0026#39; | Variable | +-----------------------+---------+----------------+---------+----------+ where Trojan Request is a SOCKS5-like request: +-----+------+----------+----------+ | CMD | ATYP | DST.ADDR | DST.PORT | +-----+------+----------+----------+ | 1 | 1 | Variable | 2 | +-----+------+----------+----------+ where: o CMD o CONNECT X\u0026#39;01\u0026#39; o UDP ASSOCIATE X\u0026#39;03\u0026#39; o ATYP address type of following address o IP V4 address: X\u0026#39;01\u0026#39; o DOMAINNAME: X\u0026#39;03\u0026#39; o IP V6 address: X\u0026#39;04\u0026#39; o DST.ADDR desired destination address o DST.PORT desired destination port in network octet order trojanå®¢æˆ·ç«¯å‘èµ·çš„æ•°æ®åŒ…ä¸­ï¼Œå¤´éƒ¨éƒ½æ˜¯ä¸Šé¢ç»“æ„æ‰€ç¤ºçš„é‚£æ ·ï¼š\nå¤´éƒ¨æœ€å¼€å§‹æ˜¯56å­—èŠ‚çš„hashï¼Œè¿™ä¸ªhashæ˜¯é…ç½®ä¸­è®¾ç½®çš„å­—ç¬¦ä¸²å¯†ç ï¼ˆå®ç°å•†é‡å¥½çš„ï¼‰è®¡ç®—å‡ºæ¥çš„hashå€¼ã€‚ hashä¹‹åè·ŸCRLFæ¢è¡Œç¬¦ã€‚ CRLFåæ˜¯TrojanRequestçš„ç»“æ„ã€‚ TrojanRequestååˆæ˜¯ä¸€ä¸ªCRLFæ¢è¡Œç¬¦ã€‚ CRLFä¹‹åä¾¿æ˜¯çœŸæ­£çš„æ•°æ®ã€‚ å‚è€ƒèµ„æ–™ ç†è§£socks5åè®®çš„å·¥ä½œè¿‡ç¨‹å’Œåè®®ç»†èŠ‚ SOCKS Protocol Version 5 socks4.protocol The Trojan Protocol æµ…ætrojanåè®®åŸç† HTTPS çš„å·¥ä½œåŸç† ","permalink":"https://carlos19960601.github.io/posts/%E5%90%84%E7%A7%8D%E4%BD%A0%E6%87%82%E7%9A%84%E5%8D%8F%E8%AE%AE/","summary":"\u003ch1 id=\"socks5åè®®\"\u003eSocks5åè®®\u003c/h1\u003e\n\u003cp\u003eå…·ä½“åè®®è¿‡ç¨‹å‚è€ƒ\u003ca href=\"https://wiyi.org/socks5-protocol-in-deep.html#25-%E5%8D%8F%E8%AE%AE%E7%BB%86%E8%8A%82\"\u003eç†è§£socks5åè®®çš„å·¥ä½œè¿‡ç¨‹å’Œåè®®ç»†èŠ‚\u003c/a\u003eã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯é€šè¿‡ä»£ç å»ç†è§£socks5åè®®ã€‚\u003c/p\u003e\n\u003ch2 id=\"å®éªŒæ¡ä»¶ä»‹ç»\"\u003eå®éªŒæ¡ä»¶ä»‹ç»\u003c/h2\u003e\n\u003cp\u003eå‘½ä»¤è¡Œè®¾ç½®proxy\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eexport https_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esocks5://127.0.0.1:7891 http_proxy\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003esocks5://127.0.0.1:7891\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¹‹åé€šè¿‡curlå‘èµ·httpè¯·æ±‚ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl www.baidu.com\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿™æ—¶å€™ï¼Œcurlè¿™ä¸ªå‘½ä»¤å°±ä¼šèµ°socksåè®®ï¼Œå¹¶å°è£…socksåè®®æ•°æ®å‘é€ç»™\u003ccode\u003esocks5://127.0.0.1:7891\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch2 id=\"åå•†é˜¶æ®µ\"\u003eåå•†é˜¶æ®µ\u003c/h2\u003e\n\u003cp\u003eæ ¹æ®å‚è€ƒèµ„æ–™ï¼Œæ¡æ‰‹é˜¶æ®µ-åå•†é˜¶æ®µå‘é€çš„æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-text\" data-lang=\"text\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e+----+----------+----------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e|VER | NMETHODS | METHODS  |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e+----+----------+----------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e| 1  |    1     | 1 to 255 |\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e+----+----------+----------+\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e#ä¸Šæ–¹çš„æ•°å­—è¡¨ç¤ºå­—èŠ‚æ•°ï¼Œä¸‹é¢çš„è¡¨æ ¼åŒç†ï¼Œä¸å†èµ˜è¿°\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVER: åè®®ç‰ˆæœ¬ï¼Œsocks5ä¸º0x05\u003c/p\u003e\n\u003cp\u003eNMETHODS: æ”¯æŒè®¤è¯çš„æ–¹æ³•æ•°é‡\u003c/p\u003e\n\u003cp\u003eMETHODS: å¯¹åº”NMETHODSï¼ŒNMETHODSçš„å€¼ä¸ºå¤šå°‘ï¼ŒMETHODSå°±æœ‰å¤šå°‘ä¸ªå­—èŠ‚ã€‚RFCé¢„å®šä¹‰äº†ä¸€äº›å€¼çš„å«ä¹‰ï¼Œå†…å®¹å¦‚ä¸‹:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eXâ€™00â€™ NO AUTHENTICATION REQUIRED\u003c/li\u003e\n\u003cli\u003eXâ€™01â€™ GSSAPI\u003c/li\u003e\n\u003cli\u003eXâ€™02â€™ USERNAME/PASSWORD\u003c/li\u003e\n\u003cli\u003eXâ€™03â€™ to Xâ€™7Fâ€™ IANA ASSIGNED\u003c/li\u003e\n\u003cli\u003eXâ€™80â€™ to Xâ€™FEâ€™ RESERVED FOR PRIVATE METHODS\u003c/li\u003e\n\u003cli\u003eXâ€™FFâ€™ NO ACCEPTABLE METHODS\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé‚£ä¹ˆsocksæœåŠ¡ç«¯æ¥å—åˆ°è¯·æ±‚æ—¶ï¼Œéœ€è¦è§£æå†…å®¹ï¼Œé€‰ä¸­ä¸€ä¸ªMETHODè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ ¼å¼å¦‚ä¸‹:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+----+--------+\n|VER | METHOD |\n+----+--------+\n| 1  |   1    |\n+----+--------+\n\u003c/code\u003e\u003c/pre\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eServerHandshake\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003erw\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003enet\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eConn\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eauthenticator\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eauth\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eAuthenticator\u003c/span\u003e) (\u003cspan style=\"color:#a6e22e\"\u003eaddr\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eAddr\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ecommand\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eCommand\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003euser\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003estring\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e) {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#f92672\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003eio\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eReadFull\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003erw\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ebuf\u003c/span\u003e[:\u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e]); \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003enmethods\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ebuf\u003c/span\u003e[\u003cspan style=\"color:#ae81ff\"\u003e1\u003c/span\u003e]\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003eio\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eReadFull\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003erw\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ebuf\u003c/span\u003e[:\u003cspan style=\"color:#a6e22e\"\u003enmethods\u003c/span\u003e]); \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// è¿”å›ä¿¡æ¯,éœ€è¦è®¤è¯\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eauthenticator\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e// ç‰ˆæœ¬å’Œè®¤è¯æ–¹æ³•\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003erw\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eWrite\u003c/span\u003e([]\u003cspan style=\"color:#66d9ef\"\u003ebyte\u003c/span\u003e{\u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e2\u003c/span\u003e}); \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!=\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enil\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  \u003cspan style=\"color:#f92672\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸Šé¢ä»£ç é€»è¾‘å°±æ˜¯å¤„ç†è¿™ä¸ªè¿‡ç¨‹ã€‚ä»£ç ä¸­å›ºå®šè¿”å›çš„æ˜¯\u003ccode\u003eXâ€™02â€™ USERNAME/PASSWORD\u003c/code\u003eè¿™ç§è®¤è¯æ–¹å¼ã€‚\u003c/p\u003e","title":"å„ç§ä½ æ‡‚çš„åè®®"},{"content":"å¼€å‘å·¥å…· ç§‘å­¦ä¸Šç½‘\nClash.Verge\nApple MèŠ¯ç‰‡ï¼šClash.Verge_1.7.2_aarch64.dmg\nIntelèŠ¯ç‰‡ï¼šClash.Verge_1.7.2_x64.dmg\nClashX\nClashX.dmg ClashX Pro\nClashX Pro Homebrew\n/bin/bash -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\u0026#34; é€šè¿‡Homebrewå®‰è£…çš„\nbrew install git go hugo git-lfs rust bruno sequel-ace node pnpm brew install --cask warp orbstack flutter losslesscut obsidian google-chrome vscode\nAndroid Studio\nDash è®¾è®¡ Billfish AceMovi Video Editor Amadine Sip Pixelmator Pro å…¶ä»– Telegram DaisyDisk Permute 3 IINA brew install --cask iina Google Chrome ","permalink":"https://carlos19960601.github.io/posts/%E6%96%B0%E6%9C%BA%E5%BF%85%E5%A4%87%E8%BD%AF%E4%BB%B6/","summary":"\u003ch1 id=\"å¼€å‘å·¥å…·\"\u003eå¼€å‘å·¥å…·\u003c/h1\u003e\n\u003cp\u003eç§‘å­¦ä¸Šç½‘\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eClash.Verge\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eApple MèŠ¯ç‰‡ï¼š\u003ca href=\"/%E6%96%B0%E6%9C%BA%E5%BF%85%E5%A4%87%E8%BD%AF%E4%BB%B6/Clash.Verge_1.7.2_aarch64.dmg\"\u003eClash.Verge_1.7.2_aarch64.dmg\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIntelèŠ¯ç‰‡ï¼š\u003ca href=\"/%E6%96%B0%E6%9C%BA%E5%BF%85%E5%A4%87%E8%BD%AF%E4%BB%B6/Clash.Verge_1.7.2_x64.dmg\"\u003eClash.Verge_1.7.2_x64.dmg\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eClashX\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/%E6%96%B0%E6%9C%BA%E5%BF%85%E5%A4%87%E8%BD%AF%E4%BB%B6/ClashX.dmg\"\u003eClashX.dmg\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eClashX Pro\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/%E6%96%B0%E6%9C%BA%E5%BF%85%E5%A4%87%E8%BD%AF%E4%BB%B6/ClashXPro.dmg\"\u003eClashX Pro\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"https://brew.sh/\"\u003eHomebrew\u003c/a\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e/bin/bash -c \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003ecurl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eé€šè¿‡\u003ccode\u003eHomebrew\u003c/code\u003eå®‰è£…çš„\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebrew install git go hugo git-lfs rust bruno sequel-ace node pnpm\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ebrew install --cask warp orbstack flutter losslesscut obsidian google-chrome\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ca href=\"https://code.visualstudio.com/\"\u003evscode\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://developer.android.com/studio?hl=zh-cn\"\u003eAndroid Studio\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eDash\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"è®¾è®¡\"\u003eè®¾è®¡\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eBillfish\u003c/li\u003e\n\u003cli\u003eAceMovi Video Editor\u003c/li\u003e\n\u003cli\u003eAmadine\u003c/li\u003e\n\u003cli\u003eSip\u003c/li\u003e\n\u003cli\u003ePixelmator Pro\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"å…¶ä»–\"\u003eå…¶ä»–\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://telegram.org/\"\u003eTelegram\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eDaisyDisk\u003c/li\u003e\n\u003cli\u003ePermute 3\u003c/li\u003e\n\u003cli\u003eIINA\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ebrew install --cask iina\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eGoogle Chrome\u003c/li\u003e\n\u003c/ul\u003e","title":"æ–°æœºå¿…å¤‡è½¯ä»¶"},{"content":"åŸºæœ¬è¯­æ³• targets: prerequisites command command command å˜é‡ å£°æ˜å˜é‡\nNAME=ClashV BINDIR=bin ä½¿ç”¨$()æ¥å¼•ç”¨å˜é‡\nPLATFORM_LIST = \\ darwin-amd64 \\ darwin-amd64-compatible \\ all-arch: $(PLATFORM_LIST) è‡ªåŠ¨å˜é‡ $@: è¡¨ç¤ºtarget\ndarwin-amd64: GOARCH=amd64 GOOS=darwin $(GOBUILD) -o $(BINDIR)/$(NAME)-$@ æ¡ä»¶åˆ¤æ–­ ifeq ($(BRANCH),Alpha) VERSION=alpha-$(shell git rev-parse --short HEAD) else ifeq ($(BRANCH),Beta) VERSION=beta-$(shell git rev-parse --short HEAD) else ifeq ($(BRANCH),) VERSION=$(shell git describe --tags) else VERSION=$(shell git rev-parse --short HEAD) endif å‡½æ•° shell BRANCH=$(shell git branch --show-current) ç›¸å…³é“¾æ¥ Makefile Tutorial ","permalink":"https://carlos19960601.github.io/posts/%E6%80%8E%E4%B9%88%E5%86%99makefile/","summary":"\u003ch2 id=\"åŸºæœ¬è¯­æ³•\"\u003eåŸºæœ¬è¯­æ³•\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-makefile\" data-lang=\"makefile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003etargets\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e prerequisites\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tcommand\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tcommand\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tcommand\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å˜é‡\"\u003eå˜é‡\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eå£°æ˜å˜é‡\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-makefile\" data-lang=\"makefile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNAME\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eClashV\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBINDIR\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebin\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eä½¿ç”¨\u003ccode\u003e$()\u003c/code\u003eæ¥å¼•ç”¨å˜é‡\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-makefile\" data-lang=\"makefile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePLATFORM_LIST \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e\tdarwin-amd64 \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e\tdarwin-amd64-compatible \u003cspan style=\"color:#ae81ff\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#ae81ff\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eall-arch\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003ePLATFORM_LIST\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"è‡ªåŠ¨å˜é‡\"\u003eè‡ªåŠ¨å˜é‡\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003e$@\u003c/code\u003e: è¡¨ç¤ºtarget\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-makefile\" data-lang=\"makefile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003edarwin-amd64\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\tGOARCH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eamd64 GOOS\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edarwin \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eGOBUILD\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e -o \u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eBINDIR\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e/\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eNAME\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e-$@\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"æ¡ä»¶åˆ¤æ–­\"\u003eæ¡ä»¶åˆ¤æ–­\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-makefile\" data-lang=\"makefile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eifeq\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eBRANCH\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e,Alpha)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVERSION\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ealpha-\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eshell git rev-parse --short HEAD\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eifeq\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eBRANCH\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e,Beta)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVERSION\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebeta-\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eshell git rev-parse --short HEAD\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eifeq\u003c/span\u003e \u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eBRANCH\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003e,)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVERSION\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eshell git describe --tags\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eelse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eVERSION\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eshell git rev-parse --short HEAD\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#960050;background-color:#1e0010\"\u003eendif\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"å‡½æ•°\"\u003eå‡½æ•°\u003c/h2\u003e\n\u003ch3 id=\"shell\"\u003eshell\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-makefile\" data-lang=\"makefile\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eBRANCH\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003eshell git branch --show-current\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"ç›¸å…³é“¾æ¥\"\u003eç›¸å…³é“¾æ¥\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://makefiletutorial.com/\"\u003eMakefile Tutorial\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"æ€ä¹ˆå†™Makefile"},{"content":" react-rough-fiber: æ¸²æŸ“æ‰‹ç»˜é£ SVG çš„ React æ¸²æŸ“å™¨ï¼Œå¯ä»¥è½»æ¾æŠŠ SVG è½¬æ¢æˆæ‰‹ç»˜é£å›¾ç‰‡ ","permalink":"https://carlos19960601.github.io/posts/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%8E%A8%E8%8D%90/","summary":"\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Bowen7/react-rough-fiber\"\u003ereact-rough-fiber\u003c/a\u003e: æ¸²æŸ“æ‰‹ç»˜é£ SVG çš„ React æ¸²æŸ“å™¨ï¼Œå¯ä»¥è½»æ¾æŠŠ SVG è½¬æ¢æˆæ‰‹ç»˜é£å›¾ç‰‡\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e5%bc%80%e6%ba%90%e9%a1%b9%e7%9b%ae%e6%8e%a8%e8%8d%90/react-rough-fiber.png\" alt=\"react-rough-fiber\"  /\u003e\n\u003c/p\u003e","title":"å¼€æºé¡¹ç›®æ¨èã€æŒç»­æ›´æ–°ã€‘"},{"content":" happyhues: ç½‘ç«™é¢œè‰²æ­é…ç¥å™¨ cobalt: è§†é¢‘ä¸‹è½½ indiehackers: ç‹¬ç«‹å¼€å‘å¯¼èˆªç«™ openalternative: æŸ¥æ‰¾å¹³æ›¿è½¯ä»¶ ","permalink":"https://carlos19960601.github.io/posts/%E5%B7%A5%E5%85%B7%E6%8E%A8%E8%8D%90/","summary":"\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.happyhues.co/\"\u003ehappyhues\u003c/a\u003e: ç½‘ç«™é¢œè‰²æ­é…ç¥å™¨\n\u003cimg loading=\"lazy\" src=\"/%e5%b7%a5%e5%85%b7%e6%8e%a8%e8%8d%90/happyhues.png\" alt=\"\"  /\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://cobalt.tools/\"\u003ecobalt\u003c/a\u003e: è§†é¢‘ä¸‹è½½\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.indiehackers.site/\"\u003eindiehackers\u003c/a\u003e: ç‹¬ç«‹å¼€å‘å¯¼èˆªç«™\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://openalternative.co/\"\u003eopenalternative\u003c/a\u003e: æŸ¥æ‰¾å¹³æ›¿è½¯ä»¶\u003c/li\u003e\n\u003c/ul\u003e","title":"å·¥å…·æ¨èã€æŒç»­æ›´æ–°ã€‘"},{"content":" Least Recently Used(LRU): åˆ é™¤æœ€æ—§çš„æ•°æ®ã€‚åŸºæœ¬å‡è®¾æ˜¯æœ€è¿‘è®¿é—®çš„æ•°æ®å¯èƒ½å¾ˆå¿«ä¼šå†æ¬¡è¢«éœ€è¦ã€‚ Most Recently Used(MRU): ä¸LRUç›¸åï¼Œåˆ é™¤æœ€æ–°çš„æ•°æ®ã€‚å¸¸ç”¨äºæµå¤„ç†æˆ–æ‰¹å¤„ç†å¹³å°ï¼Œè¿™äº›å¹³å°ä¸€æ—¦ä½¿ç”¨æ•°æ®å°±ä¸å¤ªå¯èƒ½å†æ¬¡éœ€è¦ã€‚ Least Frequently Used(LFU): åˆ é™¤ä½¿ç”¨æœ€å°‘çš„æ•°æ®ã€‚è™½ç„¶å®ƒæ˜¯ä¸€ç§æ¯” LRU æ›´å‡†ç¡®çš„æ–¹æ³•ï¼Œä½†å®ƒéœ€è¦ä¸€ç§æœºåˆ¶æ¥è®°å½•æ•°æ®è®¿é—®çš„é¢‘ç‡ï¼Œè¿™å¢åŠ äº†å¤æ‚æ€§ã€‚å®ƒé€šå¸¸ä¸ LRU ç­‰ç­–ç•¥é…åˆä½¿ç”¨ï¼Œä»¥é™ä½ç¼“å­˜è¿‡æ—¶æ•°æ®çš„é£é™©ã€‚ Time-To-Live (TTL)ï¼šæ•°æ®åœ¨é¢„è®¾çš„æ—¶é—´æ®µæœ‰æ•ˆã€‚å¸¸ç”¨åœ¨ä¼šè¯æ•°æ®ä¸­ã€‚ Two-tiered cachingä¸¤å±‚ç¼“å­˜æä¾›äº†ä¸€ç§æ›´å¤æ‚çš„æ–¹æ³•ã€‚å¯ä»¥åœ¨é€Ÿåº¦å’Œæˆæœ¬ä¹‹é—´å–å¾—å¹³è¡¡ã€‚åœ¨æ­¤è®¾è®¡ä¸­ï¼Œæ•°æ®è¢«åˆ†ä¸ºå¿«é€Ÿã€æ˜‚è´µçš„å±‚ï¼ˆç”¨äºæµè¡Œæ•°æ®ï¼‰å’Œè¾ƒæ…¢ã€ç»æµçš„å±‚ï¼ˆç”¨äºè¾ƒå°‘è®¿é—®çš„æ•°æ®ï¼‰ã€‚ ä¸Šè¿°äº”ç§ç­–ç•¥æ˜¯æœ€æµè¡Œçš„ç¼“å­˜æ–¹æ³•ã€‚è¿˜æœ‰å…¶ä»–ä¸€äº›ç­–ç•¥ï¼š\nå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ï¼šæœ€æ—§çš„æ•°æ®é¦–å…ˆè¢«åˆ é™¤ã€‚ éšæœºæ›¿æ¢ï¼ˆRRï¼‰ï¼šéšæœºé€‰æ‹©è¦åˆ é™¤çš„æ•°æ®ã€‚ è‡ªé€‚åº”æ›¿æ¢ç¼“å­˜ (ARC)ï¼šä½¿ç”¨è‡ªè°ƒæ•´ç®—æ³•è·Ÿè¸ªæ–°è¿‘åº¦å’Œé¢‘ç‡æ¥ç¡®å®šé¦–å…ˆåˆ é™¤å“ªäº›æ•°æ®ã€‚ ","permalink":"https://carlos19960601.github.io/posts/%E7%BC%93%E5%AD%98%E9%A9%B1%E9%80%90%E7%AD%96%E7%95%A5/","summary":"\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e7%bc%93%e5%ad%98%e9%a9%b1%e9%80%90%e7%ad%96%e7%95%a5/Cache%20Eviction%20Strtegies.gif\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eLeast Recently Used(LRU)\u003c/strong\u003e: åˆ é™¤æœ€æ—§çš„æ•°æ®ã€‚åŸºæœ¬å‡è®¾æ˜¯æœ€è¿‘è®¿é—®çš„æ•°æ®å¯èƒ½å¾ˆå¿«ä¼šå†æ¬¡è¢«éœ€è¦ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eMost Recently Used(MRU)\u003c/strong\u003e: ä¸\u003cstrong\u003eLRU\u003c/strong\u003eç›¸åï¼Œåˆ é™¤æœ€æ–°çš„æ•°æ®ã€‚å¸¸ç”¨äºæµå¤„ç†æˆ–æ‰¹å¤„ç†å¹³å°ï¼Œè¿™äº›å¹³å°ä¸€æ—¦ä½¿ç”¨æ•°æ®å°±ä¸å¤ªå¯èƒ½å†æ¬¡éœ€è¦ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eLeast Frequently Used(LFU)\u003c/strong\u003e: åˆ é™¤ä½¿ç”¨æœ€å°‘çš„æ•°æ®ã€‚è™½ç„¶å®ƒæ˜¯ä¸€ç§æ¯” \u003cstrong\u003eLRU\u003c/strong\u003e æ›´å‡†ç¡®çš„æ–¹æ³•ï¼Œä½†å®ƒéœ€è¦ä¸€ç§æœºåˆ¶æ¥è®°å½•æ•°æ®è®¿é—®çš„é¢‘ç‡ï¼Œè¿™å¢åŠ äº†å¤æ‚æ€§ã€‚å®ƒé€šå¸¸ä¸ \u003cstrong\u003eLRU\u003c/strong\u003e ç­‰ç­–ç•¥é…åˆä½¿ç”¨ï¼Œä»¥é™ä½ç¼“å­˜è¿‡æ—¶æ•°æ®çš„é£é™©ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTime-To-Live (TTL)\u003c/strong\u003eï¼šæ•°æ®åœ¨é¢„è®¾çš„æ—¶é—´æ®µæœ‰æ•ˆã€‚å¸¸ç”¨åœ¨ä¼šè¯æ•°æ®ä¸­ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTwo-tiered caching\u003c/strong\u003eä¸¤å±‚ç¼“å­˜æä¾›äº†ä¸€ç§æ›´å¤æ‚çš„æ–¹æ³•ã€‚å¯ä»¥åœ¨é€Ÿåº¦å’Œæˆæœ¬ä¹‹é—´å–å¾—å¹³è¡¡ã€‚åœ¨æ­¤è®¾è®¡ä¸­ï¼Œæ•°æ®è¢«åˆ†ä¸ºå¿«é€Ÿã€æ˜‚è´µçš„å±‚ï¼ˆç”¨äºæµè¡Œæ•°æ®ï¼‰å’Œè¾ƒæ…¢ã€ç»æµçš„å±‚ï¼ˆç”¨äºè¾ƒå°‘è®¿é—®çš„æ•°æ®ï¼‰ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä¸Šè¿°äº”ç§ç­–ç•¥æ˜¯æœ€æµè¡Œçš„ç¼“å­˜æ–¹æ³•ã€‚è¿˜æœ‰å…¶ä»–ä¸€äº›ç­–ç•¥ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå…ˆè¿›å…ˆå‡ºï¼ˆFIFO\u003c/strong\u003eï¼‰ï¼šæœ€æ—§çš„æ•°æ®é¦–å…ˆè¢«åˆ é™¤ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eéšæœºæ›¿æ¢ï¼ˆRRï¼‰\u003c/strong\u003eï¼šéšæœºé€‰æ‹©è¦åˆ é™¤çš„æ•°æ®ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eè‡ªé€‚åº”æ›¿æ¢ç¼“å­˜ (ARC)\u003c/strong\u003eï¼šä½¿ç”¨è‡ªè°ƒæ•´ç®—æ³•è·Ÿè¸ªæ–°è¿‘åº¦å’Œé¢‘ç‡æ¥ç¡®å®šé¦–å…ˆåˆ é™¤å“ªäº›æ•°æ®ã€‚\u003c/li\u003e\n\u003c/ul\u003e","title":"ç¼“å­˜é©±é€ç­–ç•¥"},{"content":"å…ˆçœ‹è¿™æ®µä»£ç \nimport ( \u0026#34;io\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;sync/atomic\u0026#34; ) func main() { var v atomic.Value var err error err = \u0026amp;http.ProtocolError{} v.Store(err) err = io.EOF v.Store(err) } è¿è¡Œåä¼šæŠ¥é”™ panic: sync/atomic: store of inconsistently typed value into Valueã€‚\nåŸå› æ˜¯atomic.Value.Storeéœ€è¦ç±»å‹æ˜¯ä¸€è‡´çš„ã€‚åœ¨è¿™é‡Œerrç±»å‹å‘ç”Ÿäº†å˜åŒ–ï¼Œè™½ç„¶ä»–ä»¬éƒ½æ˜¯erroræ¥å£ç±»å‹ã€‚å…·ä½“å‚è€ƒIssues#22550\næ€ä¹ˆè§£å†³ï¼ŸåŒ…è£…ä¸€å±‚å°±èƒ½è¿è¡Œäº†ã€‚\ntype tValue[T any] struct { value T } func main() { var v atomic.Value var err error err = \u0026amp;http.ProtocolError{} v.Store(tValue[error]{err}) err = io.EOF v.Store(tValue[error]{err}) } ","permalink":"https://carlos19960601.github.io/posts/atomic.value%E5%AD%98%E5%82%A8interface%E7%9A%84%E9%97%AE%E9%A2%98/","summary":"\u003cp\u003eå…ˆçœ‹è¿™æ®µä»£ç \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e (\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;io\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;net/http\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sync/atomic\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eatomic\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eValue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eProtocolError\u003c/span\u003e{}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eStore\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003eio\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eStore\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¿è¡Œåä¼šæŠ¥é”™ \u003ccode\u003epanic: sync/atomic: store of inconsistently typed value into Value\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eåŸå› æ˜¯\u003ccode\u003eatomic.Value.Store\u003c/code\u003eéœ€è¦ç±»å‹æ˜¯ä¸€è‡´çš„ã€‚åœ¨è¿™é‡Œ\u003ccode\u003eerr\u003c/code\u003eç±»å‹å‘ç”Ÿäº†å˜åŒ–ï¼Œè™½ç„¶ä»–ä»¬éƒ½æ˜¯\u003ccode\u003eerror\u003c/code\u003eæ¥å£ç±»å‹ã€‚å…·ä½“å‚è€ƒ\u003ca href=\"https://github.com/golang/go/issues/22550\"\u003eIssues#22550\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eæ€ä¹ˆè§£å†³ï¼ŸåŒ…è£…ä¸€å±‚å°±èƒ½è¿è¡Œäº†ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003etype\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etValue\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003eT\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eany\u003c/span\u003e] \u003cspan style=\"color:#66d9ef\"\u003estruct\u003c/span\u003e {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunc\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emain\u003c/span\u003e() {\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eatomic\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eValue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ehttp\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eProtocolError\u003c/span\u003e{}\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eStore\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etValue\u003c/span\u003e[\u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e]{\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e})\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e = \u003cspan style=\"color:#a6e22e\"\u003eio\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ev\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eStore\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003etValue\u003c/span\u003e[\u003cspan style=\"color:#66d9ef\"\u003eerror\u003c/span\u003e]{\u003cspan style=\"color:#a6e22e\"\u003eerr\u003c/span\u003e})\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","title":"atomic.Valueå­˜å‚¨interfaceçš„é—®é¢˜"},{"content":"å¾ˆæ—©ä¹‹å‰åšçš„ä¸€æ¬¡åˆ†äº«ï¼Œä¸‹é¢æ˜¯PPTå†…å®¹\n","permalink":"https://carlos19960601.github.io/posts/mysql%E5%AD%98%E5%82%A8%E4%B8%8E%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86%E5%88%86%E4%BA%AB/","summary":"\u003cp\u003eå¾ˆæ—©ä¹‹å‰åšçš„ä¸€æ¬¡åˆ†äº«ï¼Œä¸‹é¢æ˜¯PPTå†…å®¹\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/01.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/02.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/03.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/04.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/05.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/06.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/07.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/08.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/09.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/10.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/11.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/12.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/13.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/14.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/15.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/16.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/17.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/18.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/19.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/20.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/21.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/22.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/23.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/24.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/25.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/26.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/27.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/28.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/29.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/30.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/31.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/32.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/33.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/34.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/MySQL%e5%ad%98%e5%82%a8%e4%b8%8e%e7%b4%a2%e5%bc%95%e5%8e%9f%e7%90%86/35.png\" alt=\"\"  /\u003e\n\u003c/p\u003e","title":"MySQLå­˜å‚¨ä¸ç´¢å¼•åŸç†åˆ†äº«"},{"content":"ç”±äºGCå¤æ‚ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ä»”ç»†ç ”ç©¶è¿‡GCçš„æºç ï¼Œæ‰€ä»¥åªèƒ½ç«™åœ¨å·¨äººçš„è‚©ä¸Šå­¦ä¹ ï¼Œå¦‚æœæƒ³äº†è§£GCçš„å…·ä½“å®ç°è¯·ç§»æ­¥æ–‡æœ«çš„å‚è€ƒèµ„æ–™ã€‚æœ¬æ–‡åªæ˜¯è®°å½•æˆ‘åœ¨é˜…è¯»å®Œå¤§ä½¬æ–‡ç« ä¸­è‡ªå·±çš„ä¸€äº›é—®é¢˜ä¸æ€è€ƒï¼Œå¯èƒ½æœ‰ä¸€äº›ä¸å¯¹çš„åœ°æ–¹ã€‚æ¬¢è¿å¤§å®¶ä¸€èµ·è®¨è®ºã€‚\næ¸…ç†é˜¶æ®µï¼Œæ–°äº§ç”Ÿçš„å¯¹è±¡è¢«æ ‡è®°æˆç™½è‰²ï¼Œå²‚ä¸æ˜¯ä¼šè¢«å›æ”¶æ‰ï¼Ÿ åœ¨å‚è€ƒæ–‡ç« 1ç•™è¨€ä¸­ä¹Ÿæœ‰äººæäº†è¿™ä¸ªé—®é¢˜\næˆ‘å†å°†é—®é¢˜æè¿°ä¸€ä¸‹\nåœ¨æ ‡è®°å®Œæˆçš„æ—¶å€™ä¼šSTWï¼Œå°†çŠ¶æ€åˆ‡æ¢æˆ_GCoffï¼Œç„¶åå°±ä¼šè¿›å…¥æ¸…ç†é˜¶æ®µï¼Œè¿›å…¥æ¸…ç†é˜¶æ®µçš„æ—¶å€™ï¼Œå·²ç»ç»“æŸæ ‡è®°é˜¶æ®µï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±æ²¡æœ‰é¢œè‰²çš„åŒºåˆ†äº†(å½“ç„¶ä¹Ÿå¯ä»¥è¯´æ–°äº§ç”Ÿçš„å¯¹è±¡æ—¶ç™½è‰²çš„ï¼Œå› ä¸ºGCå¼€å§‹çš„æ—¶å€™é»˜è®¤æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ç™½è‰²)ã€‚\né‚£æ–°äº§ç”Ÿçš„å¯¹è±¡ï¼Œåœ¨æ¸…ç†é˜¶æ®µä¼šè¢«å›æ”¶å—ï¼Ÿè‚¯å®šæ˜¯ä¸ä¼šçš„ï¼Œè¦ä¸ç„¶æ—©å°±å´©äº†ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰è¢«å›æ”¶å‘¢\næˆ‘ä¸ªäººç†è§£æ˜¯è¿™æ ·çš„ï¼Œæ¸…ç†é˜¶æ®µï¼Œå½“Goroutineç”³è¯·æ–°å†…å­˜çš„æ—¶å€™å°±ä¼šè§¦å‘æ¸…ç†ï¼Œå…ˆè¿›è¡Œæ¸…ç†å†è¿›è¡Œå¯¹è±¡çš„åˆ†é…ï¼Œè¿™æ ·å°±æ²¡é—®é¢˜äº†ã€‚å› ä¸ºå·²ç»æ¸…ç†äº†ï¼Œæ‰€ä»¥åç»­ä¹Ÿä¸ä¼šæ¸…ç†è¿™å—å†…å­˜äº†ï¼Œæ–°å¯¹è±¡åœ¨æ¸…ç†åå†åˆ†é…ä¹Ÿå°±ä¸ä¼šæœ‰é—®é¢˜äº†ã€‚\næ ˆä¸Šçš„é»‘è‰²å¯¹è±¡æŒ‡å‘äº†å †ä¸­çš„ç™½è‰²å¯¹è±¡ï¼Ÿ åœ¨å‚è€ƒæ–‡ç« 1ç•™è¨€ä¸­ä¹Ÿæœ‰äººæäº†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å°±ä¸å†é‡æ–°æè¿°äº†\næˆ‘è¿˜æ˜¯è¯´ä¸‹æˆ‘çš„ç†è§£ï¼Œé¦–å…ˆæ ˆåˆ†ä¸º3ç§\nè¿˜æ²¡æ²¡æœ‰æ‰«æçš„æ ˆ æ‰«æä¸­çš„æ ˆ æ‰«æè¿‡çš„æ ˆ å¦‚æœæ˜¯æ‰«æä¸­çš„æ ˆï¼ŒGroutineæ˜¯æš‚åœçš„ï¼Œä¹Ÿå°±æ˜¯æ ˆä¸Šçš„å¯¹è±¡ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå°±ä¸å†è®¨è®º\nå¦‚æœæ˜¯è¿˜æ²¡æœ‰æ‰«æçš„æ ˆï¼Œå› ä¸ºæ ˆåœ¨æœ€å¼€å§‹çš„æ—¶å€™éƒ½è¢«æ ‡è®°æˆç°è‰²ï¼Œä¸ç®¡æ ˆä¸Šçš„å¯¹è±¡å¼•ç”¨æ€ä¹ˆå˜åŒ–ï¼Œæœ€åéƒ½ä¼šæ‰«ææ ˆï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæœ‰å•¥é—®é¢˜\nå¦‚æœæ˜¯æ‰«æè¿‡çš„æ ˆï¼Œå¦‚æœå‘ç”Ÿæ ˆä¸Šçš„å¯¹è±¡å¼•ç”¨çš„å˜åŒ–ï¼Œç”±äºå·²ç»æ‰«æè¿‡äº†ï¼Œä¸ä¼šå†æ‰«æï¼Œæ‰€ä»¥å°±ä¼šæœ‰é—®é¢˜ã€‚ä½†äº‹å®ä¸Šå´æ²¡æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆï¼Ÿ\nåœ¨å‚è€ƒèµ„æ–™golang æ··åˆå†™å±éšœåŸç†æ·±å…¥å‰–æï¼Œè¿™ç¯‡æ–‡ç« ç»™ä½ æ¢³ç†çš„æ˜æ˜ç™½ç™½ï¼ï¼ï¼ä¸­è¯´æ˜è¿™ä¸ªé—®é¢˜çš„åŸå› \né—®é¢˜åœ¨å›¾ç‰‡ä¸­æè¿°å¾—æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œæ ˆä¸Šçš„Aæƒ³è¦æŒ‡å‘å †ä¸­çš„Cï¼Œæœ‰å¤šç§æ–¹å¼\nA.C = new(C) A.C = B.C A.C = A.X.C ç¬¬1ç§æ–¹å¼ï¼Œç›´æ¥åœ¨å †ä¸­åˆå§‹åŒ–Cï¼Œç„¶åA.CæŒ‡å‘è¿‡å»ï¼›å¦‚æœæ˜¯è¿™æ ·ï¼ŒCå°±ä¸ä¼šæ˜¯ç™½è‰²çš„ï¼Œå› ä¸ºç°åœ¨æ­£åœ¨æ ‡è®°é˜¶æ®µï¼Œæ–°å¯¹è±¡éƒ½æ˜¯é»‘è‰²çš„\nç¬¬2ç§æ–¹å¼ï¼Œè¿™ç§æ˜¯ä¸å¯èƒ½çš„ï¼ŒGoroutine1æ ˆä¸­èƒ½è®¿é—®åˆ°Goroutine2æ ˆä¸­çš„å¯¹è±¡æ ¹æœ¬å°±ä¸å¯èƒ½\nç¬¬3ç§æ–¹æ³•æ˜¯Aèƒ½è®¿é—®åˆ°Xï¼ŒXå¼•ç”¨äº†Cï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œå› ä¸ºGoroutine1å·²ç»è¢«æ‰«æè¿‡äº†ï¼ŒAè¿˜èƒ½è®¿é—®åˆ°Xï¼Œè¯´æ˜Xä¸€å®šä¸æ˜¯ç™½è‰²çš„ï¼ŒXå¼•ç”¨äº†Cï¼Œå½“æ‰«æXçš„æ—¶å€™Cä¸€å®šä¸ä¼šè¢«æ ‡è®°æˆç™½è‰²\nç»¼ä¸Šæ‰€è¿°ï¼ŒGoroutine1æ ˆä¸­çš„Aæƒ³è¦æŒ‡å‘å †ä¸­çš„ç™½è‰²å¯¹è±¡æ˜¯ä¸å¯èƒ½ã€‚\nåˆ é™¤å†™å±éšœåˆ°åº•æ˜¯æŠŠä»€ä¹ˆå¯¹è±¡æŸ“æˆç°è‰² ç†è§£æ··åˆå†™å±éšœä¸€å®šè¦å…ˆç†è§£åˆ é™¤å†™å±éšœ å¾ˆå¤šäººéƒ½èƒ½ç†è§£æ’å…¥å†™å±éšœï¼Œæ’å…¥å†™å±éšœçš„æµç¨‹ä¸ªäººç†è§£å¦‚ä¸‹ï¼š\nSTWï¼Œæ‰«ææ ˆä¸Šçš„å¯¹è±¡ï¼Œæ ‡è®°æˆç°è‰² æ¢å¤è¿è¡Œï¼Œå¼€å§‹å¹¶å‘æ ‡è®° STWï¼Œé‡æ–°æ‰«ææ ˆï¼Œå®Œæˆæ ‡è®°é˜¶æ®µ ç”±äºæ ˆä¸Šçš„å¯¹è±¡è¢«å½“ä½œæ ¹å¯¹è±¡ï¼Œæ ˆä¸Šçš„å¯¹è±¡å‘ç”Ÿå˜æ›´çš„æ—¶å€™ï¼Œéœ€è¦è§¦å‘æ’å…¥å†™å±éšœï¼Œç”±äºæ ˆä¸Šçš„æ“ä½œé¢‘ç¹ï¼Œè€Œä¸”è¦å®ç°æ ˆä¸Šçš„æ’å…¥å†™å±éšœå¾ˆå¤æ‚ã€‚æ‰€ä»¥Golangå¹¶æ²¡æœ‰å®ç°æ ˆä¸Šçš„æ’å…¥å†™å±éšœ\nä½†æ­¤æ—¶å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹çš„æƒ…å†µï¼Œæ ˆä¸Šçš„é»‘è‰²å¯¹è±¡ä¼šæŒ‡å‘ç™½è‰²å¯¹è±¡ã€‚äºæ˜¯éœ€è¦åœ¨æ ‡è®°å®Œæˆçš„æ—¶å€™å¯¹æ ˆè¿›è¡Œäº†é‡æ–°æ‰«æï¼Œè¿™æ—¶éœ€è¦STWï¼Œè¿™ä¸ªè¿‡ç¨‹å¤§æ¦‚éœ€è¦èŠ±è´¹10ms~100ms\nåˆ é™¤å†™å±éšœ\nåˆ é™¤å†™å±éšœä¹Ÿå«åŸºäºå¿«ç…§çš„å†™å±éšœæ–¹æ¡ˆï¼Œå¿…é¡»åœ¨èµ·å§‹æ—¶ï¼ŒSTW æ‰«ææ•´ä¸ªæ ˆï¼ˆæ³¨æ„äº†ï¼Œæ˜¯æ‰€æœ‰çš„ goroutine æ ˆï¼‰ï¼Œä¿è¯æ‰€æœ‰å †ä¸Šåœ¨ç”¨çš„å¯¹è±¡éƒ½å¤„äºç°è‰²ä¿æŠ¤ä¸‹ï¼Œä¿è¯çš„æ˜¯å¼±ä¸‰è‰²ä¸å˜å¼ï¼› ç”±äºèµ·å§‹å¿«ç…§çš„åŸå› ï¼Œèµ·å§‹ä¹Ÿæ˜¯æ‰§è¡Œ STWï¼Œåˆ é™¤å†™å±éšœä¸é€‚ç”¨äºæ ˆç‰¹åˆ«å¤§çš„åœºæ™¯ï¼Œæ ˆè¶Šå¤§ï¼ŒSTW æ‰«ææ—¶é—´è¶Šé•¿ï¼Œå¯¹äºç°ä»£æœåŠ¡å™¨ä¸Šçš„ç¨‹åºæ¥è¯´ï¼Œæ ˆåœ°å€ç©ºé—´éƒ½å¾ˆå¤§ï¼Œæ‰€ä»¥åˆ é™¤å†™å±éšœéƒ½ä¸é€‚ç”¨ï¼Œä¸€èˆ¬é€‚ç”¨äºå¾ˆå°çš„æ ˆå†…å­˜ï¼Œæ¯”å¦‚åµŒå…¥å¼ï¼Œç‰©è”ç½‘çš„ä¸€äº›ç¨‹åºï¼› å¹¶ä¸”åˆ é™¤å†™å±éšœä¼šå¯¼è‡´æ‰«æè¿›åº¦ï¼ˆæ³¢é¢ï¼‰çš„åé€€ï¼Œæ‰€ä»¥æ‰«æç²¾åº¦ä¸å¦‚æ’å…¥å†™å±éšœï¼› æ€è€ƒé—®é¢˜ï¼šæˆ‘ä¸æ•´æœºæš‚åœ STW æ ˆï¼Œè€Œæ˜¯ä¸€ä¸ªæ ˆä¸€ä¸ªæ ˆçš„å¿«ç…§ï¼Œè¿™æ ·ä¹Ÿæ²¡æœ‰ STW äº†ï¼Œæ˜¯å¦å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Ÿï¼ˆè¿™ä¸ªå°±æ˜¯å½“å‰ golang æ··åˆå†™å±éšœçš„æ—¶å€™åšçš„å“ˆï¼Œè™½ç„¶æ²¡æœ‰ STW äº†ï¼Œä½†æ˜¯æ‰«æåˆ°æŸä¸€ä¸ªå…·ä½“çš„æ ˆçš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦æš‚åœè¿™ä¸€ä¸ª goroutine çš„ï¼‰\nä¸è¡Œï¼Œçº¯ç²¹çš„åˆ é™¤å†™å±éšœï¼Œèµ·å§‹å¿…é¡»æ•´ä¸ªæ ˆæ‰“å¿«ç…§ï¼Œè¦æŠŠæ‰€æœ‰çš„å †å¯¹è±¡éƒ½å¤„äºç°è‰²ä¿æŠ¤ä¸­æ‰è¡Œã€‚\nä¸¾ä¾‹ï¼šå¦‚æœæ²¡æœ‰æŠŠæ ˆå®Œå…¨æ‰«é»‘ï¼Œé‚£ä¹ˆå¯èƒ½å‡ºç°ä¸¢æ•°æ®ï¼Œå¦‚ä¸‹ï¼š\nåˆå§‹çŠ¶æ€ï¼š\nA æ˜¯ g1 æ ˆçš„ä¸€ä¸ªå¯¹è±¡ï¼Œg1æ ˆå·²ç»æ‰«æå®Œäº†ï¼Œå¹¶ä¸” C ä¹Ÿæ˜¯æ‰«é»‘äº†çš„å¯¹è±¡ï¼› B æ˜¯ g2 æ ˆçš„å¯¹è±¡ï¼ŒæŒ‡å‘äº†Â C å’Œ Dï¼Œg2 å®Œå…¨è¿˜æ²¡æ‰«æï¼ŒB æ˜¯ä¸€ä¸ªç°è‰²å¯¹è±¡ï¼ŒD æ˜¯ç™½è‰²å¯¹è±¡ï¼› æ­¥éª¤ä¸€ï¼šg2 è¿›è¡Œèµ‹å€¼å˜æ›´ï¼ŒæŠŠ C æŒ‡å‘ D å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™é»‘è‰²çš„ C å°±æŒ‡å‘äº†ç™½è‰²çš„ Dï¼ˆç”±äºæ˜¯åˆ é™¤å±éšœï¼Œè¿™é‡Œæ˜¯ä¸ä¼šè§¦å‘hookçš„ï¼‰\næ­¥éª¤äºŒï¼šæŠŠ B æŒ‡å‘ C çš„å¼•ç”¨åˆ é™¤ï¼Œç”±äºæ˜¯æ ˆå¯¹è±¡æ“ä½œï¼Œä¸ä¼šè§¦å‘åˆ é™¤å†™å±éšœï¼›\næ­¥éª¤ä¸‰ï¼šæ¸…ç†ï¼Œå› ä¸º C å·²ç»æ˜¯é»‘è‰²å¯¹è±¡äº†ï¼Œæ‰€ä»¥ä¸ä¼šå†æ‰«æï¼Œæ‰€ä»¥ D å°±ä¼šè¢«é”™è¯¯çš„æ¸…ç†æ‰ã€‚\nè§£å†³åŠæ³•æœ‰å¦‚ä¸‹ï¼š\næ–¹æ³•ä¸€ï¼šæ ˆä¸Šå¯¹è±¡ä¹Ÿ hookï¼Œæ‰€æœ‰å¯¹è±¡èµ‹å€¼ï¼ˆæ’å…¥ï¼Œåˆ é™¤ï¼‰éƒ½ hookï¼ˆè¿™ä¸ªå°±ä¸å®é™…äº†ï¼‰;\næ‰€æœ‰çš„æ’å…¥ï¼Œåˆ é™¤å¦‚æœéƒ½ hook ï¼Œé‚£ä¹ˆä¸€å®šéƒ½ä¸ä¼šæœ‰é—®é¢˜ï¼Œè™½ç„¶æœ¬è½®ç²¾åº¦å¾ˆå·®ï¼Œä½†æ˜¯ä¸‹è½®å›æ”¶å¯ä»¥å›æ”¶äº†ã€‚ä½†æ˜¯è¿˜æ˜¯é‚£å¥è¯ï¼Œæ ˆï¼Œå¯„å­˜å™¨çš„èµ‹å€¼ hook æ˜¯ä¸ç°å®çš„ã€‚\næ–¹æ³•äºŒï¼šèµ·å§‹å¿«ç…§æ•´æ ˆæ‰«é»‘ï¼Œä½¿å¾—æ•´ä¸ªå †ä¸Šçš„åœ¨ç”¨å¯¹è±¡éƒ½å¤„äºç°è‰²ä¿æŠ¤ï¼›\næ•´æ ˆæ‰«é»‘ï¼Œé‚£ä¹ˆåœ¨ç”¨çš„å †ä¸Šçš„å¯¹è±¡æ˜¯ä¸€å®šå¤„äºç°è‰²å †å¯¹è±¡çš„ä¿æŠ¤ä¸‹çš„ï¼Œä¹‹åé…åˆå †å¯¹è±¡åˆ é™¤å†™å±éšœå°±èƒ½ä¿è¯åœ¨ç”¨å¯¹è±¡ä¸ä¸¢å¤±ã€‚\næ–¹æ³•ä¸‰ï¼šåŠ å…¥æ’å…¥å†™å±éšœçš„é€»è¾‘ï¼ŒC æŒ‡å‘ D çš„æ—¶å€™ï¼ŒæŠŠ D ç½®ç°ï¼Œè¿™æ ·æ‰«æä¹Ÿæ²¡é—®é¢˜ã€‚è¿™æ ·å°±èƒ½å»æ‰èµ·å§‹ STW æ‰«æï¼Œä»è€Œå¯ä»¥å¹¶å‘ï¼Œä¸€ä¸ªä¸€ä¸ªæ ˆæ‰«æã€‚\nç»†å“ä¸‹ï¼Œè¿™ä¸å°±æˆäº†å½“å‰åœ¨ç”¨çš„æ··åˆå†™å±éšœäº†ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æ­£ç¡®çš„ç†è§£æ–¹å¼åº”è¯¥æ˜¯ï¼šæ··åˆå†™å±éšœ = åˆ é™¤å†™å±éšœ + æ’å…¥å†™å±éšœï¼Œå¿…é¡»å…ˆç†è§£ä¸‹åˆ é™¤å†™å±éšœï¼Œä½ æ‰èƒ½ç†è§£æ··åˆå†™å±éšœã€‚\næ··åˆå†™å±éšœcurrent stack is greyçš„ ç†è§£ åœ¨æ··åˆå†™å±éšœä¸­è®¸å¤šæ–‡ç« éƒ½è¿™ä¹ˆæè¿°\nwritePointer(slot, ptr): shade(*slot) if current stack is grey: shade(ptr) *slot = ptr current stack is greyè¯¥æ€ä¹ˆç†è§£\nProposalä¸­æ˜¯è¿™ä¹ˆæè¿°çš„\nif the current goroutine\u0026rsquo;s stack has not yet been scanned, also shades the reference being installed.\nç¿»è¯‘è¿‡æ¥å°±æ˜¯å½“å‰æ ˆè¿˜æ²¡æœ‰è¢«è¢«æ‰«æçš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨æ’å…¥å†™å±éšœ\né¦–å…ˆçœ‹ä¸€ä¸‹æ ˆå·²ç»è¢«æ‰«æçš„æƒ…å†µ\næ­£åœ¨è¢«æ‰«æ/æœªè¢«æ‰«æçš„æ ˆ\næ ˆè¢«æ‰«æè¿‡çš„å­˜åœ¨ä¸Šé¢2ç§æƒ…å†µ\næ ˆä¸Šä»¥åŠç›¸å…³è”å †ä¸Šçš„å¯¹è±¡éƒ½å·²ç»è¢«æ ‡è®°æˆé»‘è‰² æ ˆä¸Šçš„æ˜¯é»‘è‰²ï¼Œå †ä¸Šéƒ¨åˆ†å¯¹è±¡è¿˜æ²¡æœ‰è¢«æ ‡è®°æˆé»‘è‰² è¿™2ç§æƒ…å†µä¸‹å³ä½¿ä¸ä½¿ç”¨æ’å…¥å†™å±éšœä¹Ÿä¸ä¼šå‡ºç°é»‘è‰²å¯¹è±¡æŒ‡å‘ç™½è‰²å¯¹è±¡çš„æƒ…å†µ\nè¦æƒ³è®©é»‘è‰²å¯¹è±¡æŒ‡å‘ç™½è‰²å¯¹è±¡æœ‰2ç§é€”å¾„\nå½“å‰æ ˆä¸­çš„ç™½è‰²å¯¹è±¡ï¼ˆè¿™ç§æƒ…å†µä¸‹å°±æ˜¯ä¸Šå›¾æ‰€ç¤ºï¼ŒEå¯¹è±¡åœ¨ç°è‰²Då¯¹è±¡çš„ä¿æŠ¤ä¸‹ï¼Œæœ€åè¿˜æ˜¯ä¼šè¢«æ‰«ææˆé»‘è‰²ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰é—®é¢˜ï¼‰ å…¶ä»–æ ˆå¼•ç”¨äº†å½“å‰æ ˆçš„é»‘è‰²å¯¹è±¡ï¼Œå°†è¯¥é»‘è‰²å¯¹è±¡æŒ‡å‘äº†ç™½è‰²å¯¹è±¡(è¿™ä¸ªå±äºæ ˆæœªè¢«æ‰«æï¼Œä¼šæ­£åœ¨æ‰«æçš„æƒ…å†µï¼Œåé¢è¯´è¿™ç§æƒ…å†µ) æ¥ä¸‹æ¥æ˜¯æ ˆæ­£åœ¨è¢«æ‰«ææˆ–è€…æœªè¢«æ‰«æçš„æƒ…å†µï¼Œå¦‚ä¸‹å›¾\nå¦‚æœä¸å¼€å¯æ’å…¥å†™å±éšœå°±ä¼šå‡ºç°é»‘è‰²å¯¹è±¡æŒ‡å‘ç™½è‰²å¯¹è±¡çš„æƒ…å†µï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹éœ€è¦å¼€å¯æ’å…¥å†™å±éšœ\nå‚è€ƒèµ„æ–™ Go è¯­è¨€åƒåœ¾æ”¶é›†å™¨çš„å®ç°åŸç†\nGoè¯­è¨€GCå®ç°åŸç†åŠæºç åˆ†æ - luozhiyun`s Blog\nProposal: Eliminate STW stack re-scanning\ngolang åƒåœ¾å›æ”¶ ï¼ˆä¸€ï¼‰æ¦‚è¿°ç¯‡\ngolang åƒåœ¾å›æ”¶ï¼ˆäºŒï¼‰å±éšœæŠ€æœ¯\ngolang åƒåœ¾å›æ”¶ï¼ˆä¸‰ï¼‰æ’å…¥å†™å±éšœ\ngolang åƒåœ¾å›æ”¶ - åˆ é™¤å†™å±éšœ\ngolang æ··åˆå†™å±éšœåŸç†æ·±å…¥å‰–æï¼Œè¿™ç¯‡æ–‡ç« ç»™ä½ æ¢³ç†çš„æ˜æ˜ç™½ç™½ï¼ï¼ï¼\nGolangåƒåœ¾å›æ”¶ å±éšœæŠ€æœ¯\n","permalink":"https://carlos19960601.github.io/posts/%E5%85%B3%E4%BA%8Egolang-gc%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%9D%E8%80%83/","summary":"\u003cp\u003eç”±äºGCå¤æ‚ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ä»”ç»†ç ”ç©¶è¿‡GCçš„æºç ï¼Œæ‰€ä»¥åªèƒ½ç«™åœ¨å·¨äººçš„è‚©ä¸Šå­¦ä¹ ï¼Œå¦‚æœæƒ³äº†è§£GCçš„å…·ä½“å®ç°è¯·ç§»æ­¥æ–‡æœ«çš„å‚è€ƒèµ„æ–™ã€‚æœ¬æ–‡åªæ˜¯è®°å½•æˆ‘åœ¨é˜…è¯»å®Œå¤§ä½¬æ–‡ç« ä¸­è‡ªå·±çš„ä¸€äº›é—®é¢˜ä¸æ€è€ƒï¼Œå¯èƒ½æœ‰ä¸€äº›ä¸å¯¹çš„åœ°æ–¹ã€‚æ¬¢è¿å¤§å®¶ä¸€èµ·è®¨è®ºã€‚\u003c/p\u003e","title":"å…³äºGolang GCé—®é¢˜çš„æ€è€ƒ"},{"content":"è¿™æ˜¯åœ¨å°å›¢é˜Ÿé‡Œé¢çš„ä¸€æ¬¡åˆ†äº«ï¼Œä»¥ä¸‹æ˜¯PPTå†…å®¹\n","permalink":"https://carlos19960601.github.io/posts/timer%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E5%88%86%E4%BA%AB/","summary":"\u003cp\u003eè¿™æ˜¯åœ¨å°å›¢é˜Ÿé‡Œé¢çš„ä¸€æ¬¡åˆ†äº«ï¼Œä»¥ä¸‹æ˜¯PPTå†…å®¹\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/01.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/02.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/03.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/04.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/05.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/06.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/07.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/08.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/10.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/11.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/12.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/13.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/14.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/15.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/16.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/17.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/18.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/19.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/20.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/21.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/22.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/23.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/24.png\" alt=\"\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/timer%e6%ba%90%e7%a0%81%e9%98%85%e8%af%bb%e5%88%86%e4%ba%ab/25.png\" alt=\"\"  /\u003e\n\u003c/p\u003e","title":"Timeræºç é˜…è¯»åˆ†äº«"},{"content":"æ ¹æ®6.3 è®¡æ—¶å™¨ä¸­çš„æè¿°ï¼ŒGolang Timerçš„è®¾è®¡ç»å†äº†å¦‚ä¸‹é˜¶æ®µï¼š\nGo 1.9 ç‰ˆæœ¬ä¹‹å‰ï¼Œæ‰€æœ‰çš„è®¡æ—¶å™¨ç”±å…¨å±€å”¯ä¸€çš„å››å‰å †ç»´æŠ¤ï¼› Go 1.10 ~ 1.13ï¼Œå…¨å±€ä½¿ç”¨ 64 ä¸ªå››å‰å †ç»´æŠ¤å…¨éƒ¨çš„è®¡æ—¶å™¨ï¼Œæ¯ä¸ªå¤„ç†å™¨ï¼ˆPï¼‰åˆ›å»ºçš„è®¡æ—¶å™¨ä¼šç”±å¯¹åº”çš„å››å‰å †ç»´æŠ¤ï¼› Go 1.14 ç‰ˆæœ¬ä¹‹åï¼Œæ¯ä¸ªå¤„ç†å™¨å•ç‹¬ç®¡ç†è®¡æ—¶å™¨å¹¶é€šè¿‡ç½‘ç»œè½®è¯¢å™¨è§¦å‘ï¼› Go 1.9 ç‰ˆæœ¬ä¹‹å‰ç”±äºä½¿ç”¨å…¨å±€çš„å››å‰å †ï¼Œåœ¨å¤šæ ¸æƒ…å†µä¸‹ä¼šå‡ºç°é”ç«äº‰å¯¼è‡´æ€§èƒ½é—®é¢˜ Go 1.10 ~ 1.13ä½¿ç”¨äº†64ä¸ªå››å‰å †ï¼Œæœ‰æ¯ä¸ªPæ¥ç»´æŠ¤å¯¹åº”çš„å››å‰å †ï¼Œç›¸å½“äºå°†é”çš„ç²’åº¦å‡å°ï¼Œä½†æ˜¯å½“timeråœ¨æœªåˆ°æ—¶é—´å’Œåˆ°æ—¶é—´éœ€è¦æ‰§è¡Œè¿›è¡Œåˆ‡æ¢çš„æ—¶å€™ï¼Œä¼šå‘ç”ŸPå’ŒMçš„ç»‘å®šå’Œè§£ç»‘ï¼Œå°¤å…¶æ˜¯å½“timerè§¦å‘æ—¶é—´é—´éš”æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´CPUå ç”¨è¿‡é«˜ï¼ŒM/Påˆ‡æ¢çš„å¼€é”€å¢åŠ (TODO ä¸ºä»€ä¹ˆä¼šå‘ç”ŸPå’ŒMçš„ç»‘å®šå’Œè§£ç»‘) Go 1.14 ç‰ˆæœ¬åæ¯ä¸ªPç®¡ç†è®¡æ—¶å™¨å››å‰å †ï¼Œç”±ç½‘ç»œè½®è¯¢å™¨å’Œè°ƒåº¦å™¨è¿›è¡Œè§¦å‘ æˆ‘ä½¿ç”¨çš„æ˜¯Go 1.16çš„ç‰ˆæœ¬è¿›è¡Œåˆ†æ\ntimeråŒ…çš„ä½¿ç”¨ ä¸»è¦åˆ†ä¸º2ç±»ï¼Œä¸€æ¬¡æ€§è§¦å‘çš„timerå’Œå¤šæ¬¡è§¦å‘çš„ticker\nfunc TestTimer(t *testing.T) { timer := time.NewTimer(time.Second) // for tm := range timer.C { // t.Log(tm) // timer.Reset(time.Second) // } var ch chan int for { select { case tm := \u0026lt;-timer.C: t.Log(tm) timer.Reset(time.Second) case \u0026lt;-ch: } } } func TestAfter(t *testing.T) { var ch chan int select { case tm := \u0026lt;-time.After(time.Second): t.Log(tm) case \u0026lt;-ch: } } func TestAfterFunc(t *testing.T) { var ch chan int timer := time.AfterFunc(time.Second, func() { t.Log(\u0026#34;æˆ‘æ‰§è¡Œäº†\u0026#34;) ch \u0026lt;- 0 }) defer timer.Stop() \u0026lt;-ch } func TestTicker(t *testing.T) { ticker := time.NewTicker(time.Second) var ch chan int for { select { case tm := \u0026lt;-ticker.C: t.Log(tm) case \u0026lt;-ch: } } } func NewTicker(d Duration) *Ticker { if d \u0026lt;= 0 { panic(errors.New(\u0026#34;non-positive interval for NewTicker\u0026#34;)) } // Give the channel a 1-element time buffer. // If the client falls behind while reading, we drop ticks // on the floor until the client catches up. c := make(chan Time, 1) t := \u0026amp;Ticker{ C: c, r: runtimeTimer{ when: when(d), period: int64(d), f: sendTime, arg: c, }, } startTimer(\u0026amp;t.r) return t } func TestTick(t *testing.T) { for tm := range time.Tick(time.Second) { t.Log(tm) } } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨forå¾ªç¯ä¸­ä½¿ç”¨çš„æ—¶å€™éœ€è¦è€ƒè™‘æ˜¯å¦ä¼šé€ æˆtimerçš„æ³„æ¼ï¼›å…·ä½“çš„ç¤ºä¾‹åˆ†æå¯ä»¥å‚è€ƒ Go å†…å­˜æ³„éœ²ä¹‹ç—›ï¼Œè¿™ç¯‡æŠŠ Go timer.After é—®é¢˜æ ¹å› è®²é€äº†ï¼\næ•°æ®ç»“æ„ func NewTimer(d Duration) *Timer { c := make(chan Time, 1) t := \u0026amp;Timer{ C: c, r: runtimeTimer{ when: when(d), f: sendTime, arg: c, }, } startTimer(\u0026amp;t.r) return t } å¯ä»¥çœ‹åˆ°NewTimerå’ŒNewTickeréƒ½ä¼šåˆå§‹åŒ–runtimeTimerï¼Œå·®åˆ«åœ¨äºTickerä¼šæ¯”Timerå¤šäº†periodå‚æ•°ã€‚æœ€åè°ƒç”¨startTimerå°†timeræ·»åŠ åˆ°åº•å±‚çš„æœ€å°å››å‰å †ä¸­\nruntimeTimerå’Œruntime/time.go#timerç»“æ„æ˜¯ä¿æŒä¸€è‡´çš„\ntype timer struct { // If this timer is on a heap, which P\u0026#39;s heap it is on. // puintptr rather than *p to match uintptr in the versions // of this struct defined in other packages. pp puintptr // å½“å‰Pçš„æŒ‡é’ˆ // Timer wakes up at when, and then at when+period, ... (period \u0026gt; 0 only) // each time calling f(arg, now) in the timer goroutine, so f must be // a well-behaved function and not block. // // when must be positive on an active timer. when int64 // å½“å‰è®¡æ—¶å™¨è¢«å”¤é†’çš„æ—¶é—´ period int64 // ä¸¤æ¬¡è¢«å”¤é†’çš„é—´éš” f func(interface{}, uintptr) // æ¯å½“è®¡æ—¶å™¨è¢«å”¤é†’æ—¶éƒ½ä¼šè°ƒç”¨çš„å‡½æ•° arg interface{} // è®¡æ—¶å™¨è¢«å”¤é†’æ—¶è°ƒç”¨ f ä¼ å…¥çš„å‚æ•° seq uintptr // What to set the when field to in timerModifiedXX status. nextwhen int64 // è®¡æ—¶å™¨å¤„äº timerModifiedXX çŠ¶æ€æ—¶ï¼Œç”¨äºè®¾ç½® when å­—æ®µï¼› // The status field holds one of the values below. status uint32 // è®¡æ—¶å™¨çš„çŠ¶æ€ } æ·»åŠ timer å‰é¢çš„startTimeræ–¹æ³•å…¶å®æ˜¯runtime/time.goä¸­çš„startTimeræ–¹æ³•ï¼Œé€šè¿‡//go:linknameå…³è”èµ·æ¥çš„\n// æŠŠ t æ·»åŠ åˆ° timer å † // startTimer adds t to the timer heap. //go:linkname startTimer time.startTimer func startTimer(t *timer) { if raceenabled { racerelease(unsafe.Pointer(t)) } addtimer(t) } ç»§ç»­è°ƒç”¨addtimeræ–¹æ³•\n// addtimer adds a timer to the current P. // This should only be called with a newly created timer. // That avoids the risk of changing the when field of a timer in some P\u0026#39;s heap, // which could cause the heap to become unsorted. func addtimer(t *timer) { // when must be positive. A negative value will cause runtimer to // overflow during its delta calculation and never expire other runtime // timers. Zero will cause checkTimers to fail to notice the timer. if t.when \u0026lt;= 0 { throw(\u0026#34;timer when must be positive\u0026#34;) } if t.period \u0026lt; 0 { throw(\u0026#34;timer period must be non-negative\u0026#34;) } if t.status != timerNoStatus { // æ·»åŠ æ–°çš„timerå¿…é¡»æ˜¯timerNoStatus throw(\u0026#34;addtimer called with initialized timer\u0026#34;) } t.status = timerWaiting when := t.when pp := getg().m.p.ptr() lock(\u0026amp;pp.timersLock) cleantimers(pp) doaddtimer(pp, t) unlock(\u0026amp;pp.timersLock) wakeNetPoller(when) } addtimeré¦–å…ˆå¯¹å‚æ•°è¿›è¡Œäº†æ ¡éªŒï¼Œtimerçš„åˆå§‹åŒ–statuså¿…é¡»æ˜¯timerNoStatus(è®¡æ—¶å™¨å°šæœªè®¾ç½®çŠ¶æ€)ï¼Œç„¶åå°†timerçš„statusåˆ‡æ¢æˆtimerWaiting(ç­‰å¾…è®¡æ—¶å™¨å¯åŠ¨)\nç„¶åè°ƒç”¨cleantimers(pp)å¤„ç†Pä¸­timerså †é¡¶ä¸Šå·²ç»å–æ¶ˆ(timerDeleted)æˆ–è€…æ—¶é—´å‘ç”Ÿæ”¹å˜(timerModifiedEarlier/timerModifiedLaterçš„timer)ï¼Œå¯¹timersè¿›è¡Œæ¸…ç†\n// æ¸…ç†å †é¡¶éƒ¨çš„timerï¼Œä¸adjusttimersæ–¹æ³•ç±»ä¼¼ï¼Œåªæ˜¯adjusttimersä¼šéå†æœç´¢çš„timers // æ³¨æ„cleantimersæ¸…ç†çš„æ˜¯å †é¡¶éƒ¨çš„timerï¼Œåªè¦é¡¶éƒ¨æ˜¯timerDeletedï¼ŒtimerModifiedEarlier/timerModifiedLaterçš„timeréƒ½ä¼šå¤„ç† // å¤„ç†å®Œåä¼šè°ƒæ•´å †ï¼Œå†å¤„ç†å †é¡¶éƒ¨çš„timerï¼Œæ‰€ä»¥ä¸åªæ˜¯å¤„ç†1ä¸ªtimerï¼Œ // å½“å †å‰é¢çš„timeræ˜¯timerDeletedï¼ŒtimerModifiedEarlier/timerModifiedLaterçŠ¶æ€çš„æ—¶å€™éƒ½ä¼šè¿›è¡Œå¤„ç† // adjusttimersä¸ç®¡æ˜¯ä»€ä¹ˆçŠ¶æ€çš„timerï¼Œéƒ½ä¼šä¾¿åˆ©å¤„ç†ä¸€é // cleantimersä¼šå‡ºç°ä¸‹é¢2ç§çŠ¶æ€çš„å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯æ¸…é™¤å·²ç»åˆ é™¤çš„ï¼Œç§»åŠ¨timer0 // timerDeleted -\u0026gt; timerRemoving -\u0026gt; timerRemoved // timerModifiedEarlier/timerModifiedLater -\u0026gt; timerMoving -\u0026gt; timerWaiting func cleantimers(pp *p) { gp := getg() for { if len(pp.timers) == 0 { return } // This loop can theoretically run for a while, and because // it is holding timersLock it cannot be preempted. // If someone is trying to preempt us, just return. // We can clean the timers later. if gp.preemptStop { return } t := pp.timers[0] // å †é¡¶ï¼Œwhenæœ€å°ï¼Œæœ€æ—©å‘ç”Ÿçš„timer if t.pp.ptr() != pp { throw(\u0026#34;cleantimers: bad p\u0026#34;) } switch s := atomic.Load(\u0026amp;t.status); s { case timerDeleted: // timerDeleted --\u0026gt; timerRemoving --\u0026gt; ä»å †ä¸­åˆ é™¤timer --\u0026gt; timerRemoved if !atomic.Cas(\u0026amp;t.status, s, timerRemoving) { continue } dodeltimer0(pp) if !atomic.Cas(\u0026amp;t.status, timerRemoving, timerRemoved) { badTimer() } atomic.Xadd(\u0026amp;pp.deletedTimers, -1) case timerModifiedEarlier, timerModifiedLater: // TODO å¦‚æœmodTimerå°†étimer0çš„whenæ”¹æˆäº†æ¯”timer0æ›´å…ˆè§¦å‘çš„æ—¶å€™æ˜¯æ€ä¹ˆå¤„ç†çš„ // timerMoving --\u0026gt; è°ƒæ•´ timer çš„æ—¶é—´ --\u0026gt; timerWaiting // æ­¤æ—¶ timer è¢«è°ƒæ•´ä¸ºæ›´æ—©æˆ–æ›´æ™šï¼Œå°†åŸå…ˆçš„ timer è¿›è¡Œåˆ é™¤ï¼Œå†é‡æ–°æ·»åŠ  if !atomic.Cas(\u0026amp;t.status, s, timerMoving) { continue } // Now we can change the when field. t.when = t.nextwhen // Move t to the right position. // åˆ é™¤åŸæ¥çš„ dodeltimer0(pp) // ç„¶åå†é‡æ–°æ·»åŠ  doaddtimer(pp, t) if s == timerModifiedEarlier { atomic.Xadd(\u0026amp;pp.adjustTimers, -1) // å¦‚æœt0ä¹‹å‰æ˜¯timerModifiedEarlierï¼Œå› ä¸ºå·²ç»è°ƒæ•´äº†t0ï¼Œæ‰€ä»¥éœ€è¦å°†adjustTimerså‡1 } if !atomic.Cas(\u0026amp;t.status, timerMoving, timerWaiting) { badTimer() } default: // Head of timers does not need adjustment. return } } } cleantimers(pp *p)æ–¹æ³•ä¼šå¾ªç¯å¤„ç†å †é¡¶éƒ¨æ˜¯timerDeletedï¼ŒtimerModifiedEarlier/timerModifiedLaterçš„timer\nå¦‚æœæ˜¯timerDeletedï¼Œè¯´æ˜timerå·²ç»å–æ¶ˆäº†ï¼Œä»timerså †ä¸­åˆ é™¤ï¼Œé‡æ–°è°ƒæ•´timerså † å¦‚æœæ˜¯timerModifiedEarlier/timerModifiedLaterï¼Œè¯´æ˜timerçš„æ—¶é—´å‘ç”Ÿæ”¹å˜ï¼Œä¿®æ”¹timerçš„whenå­—æ®µï¼Œåˆ é™¤ä¹‹å‰çš„timerï¼Œé‡æ–°æ·»åŠ æ–°çš„timer cleantimers(pp *p)æ–¹æ³•åªæ˜¯å¯¹pä¸­çš„timerså †åšäº†ä¸€äº›æ¸…ç†è°ƒæ•´çš„å·¥ä½œï¼ŒçœŸæ­£æ·»åŠ æ˜¯doaddtimeræ–¹æ³•\n// doaddtimer adds t to the current P\u0026#39;s heap. // The caller must have locked the timers for pp. func doaddtimer(pp *p, t *timer) { // Timersä¾èµ–network pollerï¼Œç¡®ä¿netpollç»åˆå§‹åŒ–äº† // Timers rely on the network poller, so make sure the poller // has started. if netpollInited == 0 { netpollGenericInit() } if t.pp != 0 { // åˆ›å»ºtimeræ—¶æ²¡æœ‰ç»‘å®špï¼Œå¦‚æœpå­˜åœ¨çš„è¯å±äºå¼‚å¸¸æƒ…å†µ throw(\u0026#34;doaddtimer: P already set in timer\u0026#34;) } t.pp.set(pp) // timerç»‘å®šåˆ°å½“å‰Pçš„å †ä¸Š i := len(pp.timers) pp.timers = append(pp.timers, t) siftupTimer(pp.timers, i) // è°ƒæ•´4å‰å † if t == pp.timers[0] { // å¦‚æœæ–°åŠ å…¥çš„timeræ˜¯å½“å‰pä¸­æœ€æ–°è§¦å‘çš„ï¼Œå°†t.whenä¿å­˜åˆ°pp.timer0When atomic.Store64(\u0026amp;pp.timer0When, uint64(t.when)) } atomic.Xadd(\u0026amp;pp.numTimers, 1) } doaddtimeræ–¹æ³•ä¸­åˆ¤æ–­äº†netpollæ˜¯å¦åˆå§‹åŒ–äº†ï¼Œå¦‚æœæ²¡æœ‰å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œæˆ‘è¿˜æ²¡æœ‰ç†è§£timerå’Œnetpollä¹‹é—´çš„å…³ç³»ï¼Œä½œä¸ºtodoï¼Œåç»­å†è¡¥å……\nåé¢å°±æ˜¯pçš„timerä¹‹é—´çš„ç»‘å®šï¼Œæ·»åŠ åˆ°å››å‰å †ï¼Œç„¶åå¹³è¡¡å››å‰å †ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†\ndoaddtimeræ–¹æ³•è¿”å›åï¼Œå›åˆ°addtimeræ–¹æ³•ä¼šè°ƒç”¨wakeNetPolleræ–¹æ³•\n// wakeNetPoller wakes up the thread sleeping in the network poller if it isn\u0026#39;t // going to wake up before the when argument; or it wakes an idle P to service // timers and the network poller if there isn\u0026#39;t one already. func wakeNetPoller(when int64) { if atomic.Load64(\u0026amp;sched.lastpoll) == 0 { // In findrunnable we ensure that when polling the pollUntil // field is either zero or the time to which the current // poll is expected to run. This can have a spurious wakeup // but should never miss a wakeup. pollerPollUntil := int64(atomic.Load64(\u0026amp;sched.pollUntil)) if pollerPollUntil == 0 || pollerPollUntil \u0026gt; when { // ç½‘ç»œè½®è¯¢å™¨poll \u0026gt; timerçš„è§¦å‘æ—¶é—´ï¼Œç«‹å³å”¤é†’netpoll netpollBreak() } } else { // There are no threads in the network poller, try to get // one there so it can handle new timers. if GOOS != \u0026#34;plan9\u0026#34; { // Temporary workaround - see issue #42303. wakep() } } } // netpollBreak interrupts a kevent. func netpollBreak() { if atomic.Cas(\u0026amp;netpollWakeSig, 0, 1) { for { var b byte n := write(netpollBreakWr, unsafe.Pointer(\u0026amp;b), 1) if n == 1 || n == -_EAGAIN { break } if n == -_EINTR { continue } println(\u0026#34;runtime: netpollBreak write failed with\u0026#34;, -n) throw(\u0026#34;runtime: netpollBreak write failed\u0026#34;) } } } wakeNetPolleræ–¹æ³•å…¶å®å°±æ˜¯å‘netpollåˆå§‹åŒ–çš„å…¨å±€epfdæ–‡ä»¶æè¿°ç¬¦å†™å…¥äº†æ•°æ®ï¼ˆepfdå’Œgolang netpollæœ‰å…³ï¼Œæƒ³äº†è§£netpollçš„è¯·è‡ªè¡Œäº†è§£ï¼‰ã€‚ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å”¤é†’netpoll\nåœæ­¢timer å¯ä»¥é€šè¿‡Ticker#Stopå’ŒTimer#Stopåœæ­¢timer\n// Stop prevents the Timer from firing. // It returns true if the call stops the timer, false if the timer has already // expired or been stopped. // Stop does not close the channel, to prevent a read from the channel succeeding // incorrectly. // // To ensure the channel is empty after a call to Stop, check the // return value and drain the channel. // For example, assuming the program has not received from t.C already: // // if !t.Stop() { // \u0026lt;-t.C // } // // This cannot be done concurrent to other receives from the Timer\u0026#39;s // channel or other calls to the Timer\u0026#39;s Stop method. // // For a timer created with AfterFunc(d, f), if t.Stop returns false, then the timer // has already expired and the function f has been started in its own goroutine; // Stop does not wait for f to complete before returning. // If the caller needs to know whether f is completed, it must coordinate // with f explicitly. func (t *Timer) Stop() bool { if t.r.f == nil { panic(\u0026#34;time: Stop called on uninitialized Timer\u0026#34;) } return stopTimer(\u0026amp;t.r) } // Stop turns off a ticker. After Stop, no more ticks will be sent. // Stop does not close the channel, to prevent a concurrent goroutine // reading from the channel from seeing an erroneous \u0026#34;tick\u0026#34;. func (t *Ticker) Stop() { stopTimer(\u0026amp;t.r) } æœ€åéƒ½æ˜¯è°ƒç”¨runtime.stopTimeræ–¹æ³•ï¼›é€šè¿‡//go:linknameè¿›è¡Œå…³è”\n// stopTimer stops a timer. // It reports whether t was stopped before being run. //go:linkname stopTimer time.stopTimer func stopTimer(t *timer) bool { return deltimer(t) } // è¿”å›çš„æ˜¯è¿™ä¸ªtimeråœ¨æ‰§è¡Œå‰è¢«ç§»é™¤çš„ï¼Œå·²ç»æ‰§è¡Œè¿‡äº†å°±è¿”å›falseï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œå°±è¿”å›true // deltimer deletes the timer t. It may be on some other P, so we can\u0026#39;t // actually remove it from the timers heap. We can only mark it as deleted. // It will be removed in due course by the P whose heap it is on. // Reports whether the timer was removed before it was run. func deltimer(t *timer) bool { for { switch s := atomic.Load(\u0026amp;t.status); s { case timerWaiting, timerModifiedLater: // timerè¿˜æ²¡å¯åŠ¨æˆ–ä¿®æ”¹ä¸ºæ›´æ™šçš„æ—¶é—´ // Prevent preemption while the timer is in timerModifying. // This could lead to a self-deadlock. See #38070. mp := acquirem() // timerWaiting/timerModifiedLater --\u0026gt; timerModifying --\u0026gt; timerDeleted if atomic.Cas(\u0026amp;t.status, s, timerModifying) { // TODO ä¸ºä»€ä¹ˆè¦å…ˆåˆ‡æ¢ä¸ºtimerModifying // Must fetch t.pp before changing status, // as cleantimers in another goroutine // can clear t.pp of a timerDeleted timer. tpp := t.pp.ptr() if !atomic.Cas(\u0026amp;t.status, timerModifying, timerDeleted) { // ç½®ä¸ºtimerDeletedçŠ¶æ€ badTimer() } releasem(mp) atomic.Xadd(\u0026amp;tpp.deletedTimers, 1) // Timer was not yet run. return true } else { // ä¿®æ”¹ä¸ºtimerModifyingå¤±è´¥ï¼Œè¯´æ˜tçš„çŠ¶æ€å·²ç»ä¸å†æ˜¯timerWaiting, timerModifiedLateräº† releasem(mp) // ä¸‹ä¸€æ¬¡å†æ¥å¤„ç† } case timerModifiedEarlier: // Prevent preemption while the timer is in timerModifying. // This could lead to a self-deadlock. See #38070. mp := acquirem() // timerModifiedEarlier --\u0026gt; timerModifying --\u0026gt; timerDeleted if atomic.Cas(\u0026amp;t.status, s, timerModifying) { // Must fetch t.pp before setting status // to timerDeleted. tpp := t.pp.ptr() atomic.Xadd(\u0026amp;tpp.adjustTimers, -1) // timerModifiedEarlierçš„timerè¢«stopäº†ï¼Œæ‰€ä»¥éœ€è¦å°†adjustTimers-1 if !atomic.Cas(\u0026amp;t.status, timerModifying, timerDeleted) { badTimer() } releasem(mp) atomic.Xadd(\u0026amp;tpp.deletedTimers, 1) // Timer was not yet run. return true } else { releasem(mp) // ä¸‹ä¸€æ¬¡å†æ¥å¤„ç† } case timerDeleted, timerRemoving, timerRemoved: // Timer was already run. // Timer å·²ç»è¿è¡Œ return false case timerRunning, timerMoving: // æ­£åœ¨æ‰§è¡Œæˆ–è¢«ç§»åŠ¨äº†ï¼Œç­‰å¾…å®Œæˆï¼Œä¸‹ä¸€æ¬¡å†æ¥å¤„ç† // The timer is being run or moved, by a different P. // Wait for it to complete. osyield() case timerNoStatus: // Removing timer that was never added or // has already been run. Also see issue 21874. return false case timerModifying: // åŒæ—¶è°ƒç”¨äº†deltimerï¼Œmodtimerï¼›ç­‰å¾…å…¶ä»–è°ƒç”¨å®Œæˆï¼Œä¸‹ä¸€æ¬¡å†æ¥å¤„ç† // Simultaneous calls to deltimer and modtimer. // Wait for the other call to complete. osyield() default: badTimer() } } } ä»deltimeræ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼Œtimerä¼šå‘ç”Ÿå¦‚ä¸‹çš„çŠ¶æ€å˜åŒ–\ntimerWaiting, timerModifiedLater â†’ timerModifying â†’ timerDeleted\nå¦‚æœè¦åœæ­¢çš„timerçŠ¶æ€æ˜¯timerWaiting, timerModifiedLaterï¼Œè¯´æ˜timerè¿˜æ²¡æœ‰æ‰§è¡Œï¼Œå°†çŠ¶æ€åˆ‡æ¢æˆtimerModifyingæ”¹å˜ä¸­ï¼Œæœ€åå°†çŠ¶æ€åˆ‡æ¢æˆtimerDeleted\ntimerModifiedEarlier â†’ timerModifying \u0026ndash;\u0026gt; timerDeleted\nå¦‚æœè¦åœæ­¢çš„timerçŠ¶æ€æ˜¯timerModifiedEarlierï¼Œè¯´æ˜timerçš„æ—¶é—´è¢«æ”¹å˜è¿‡ï¼Œæ¯”å¦‚resetè¿‡ï¼Œå°†çŠ¶æ€åˆ‡æ¢æˆtimerModifyingæ”¹å˜ä¸­ï¼Œæœ€åå°†çŠ¶æ€åˆ‡æ¢æˆtimerDeleted\ntimerDeleted, timerRemoving, timerRemoved â†’ ä»€ä¹ˆéƒ½ä¸åš\ntimerRunning, timerMoving â†’ ç­‰å¾…æ“ä½œå®Œæˆ\ntimerNoStatus â†’ ç›´æ¥è¿”å›\ntimerModifying â†’ ç­‰å¾…æ“ä½œå®Œæˆ\næˆ‘åœ¨è¿™é‡Œæœ‰2ä¸ªé—®é¢˜\nä¸ºä»€ä¹ˆtimerçŠ¶æ€å˜åŒ–çš„æ—¶å€™éœ€è¦éœ€è¦å…ˆæ”¹ä¸ºtimerModifyingç„¶åå†ä¿®æ”¹æˆæœ€åçš„çŠ¶æ€ï¼Ÿ\nç­”ï¼šé¦–å…ˆå£°æ˜è¿™ä¸ªåªæ˜¯æˆ‘ä¸ªäººçš„ç†è§£å¯èƒ½ä¼šå­˜åœ¨é”™è¯¯ï¼›åœ¨timerçš„statusçŠ¶æ€å¸¸é‡è¿™æœ‰è¿™ä¹ˆä¸€æ®µæ³¨é‡Š\n// We don\u0026#39;t permit calling addtimer/deltimer/modtimer/resettimer simultaneously, // but adjusttimers and runtimer can be called at the same time as any of those. ä¸ºäº†ä¿è¯addtimer/deltimer/modtimer/resettimerä¸èƒ½è¢«åŒæ—¶è°ƒç”¨ï¼Œæ‰€ä»¥éœ€è¦timerModifyingè¿™ä¸ªçŠ¶æ€\ndeltimerå¹¶æ²¡æœ‰ä» å››å‰å †ä¸­åˆ é™¤timerï¼Œåªæ˜¯å°†timerçš„çŠ¶æ€åˆ‡æ¢æˆtimerDeletedï¼Œè¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\nè¿™ä¸ªåœ¨deltimerçš„æ³¨é‡Šä¸Šå·²ç»è¯´æ˜äº†\n// deltimer deletes the timer t. It may be on some other P, so we can\u0026#39;t // actually remove it from the timers heap. We can only mark it as deleted. // It will be removed in due course by the P whose heap it is on. deltimeråˆ é™¤çš„timerå¯èƒ½åœ¨å…¶ä»–Pä¸Šï¼Œä»¥ä¸ºè°ƒåº¦å¾ªç¯çš„ æ—¶å€™ä¸ä»…ä¼šä»å…¶ä»–Pä¸Šå·Gï¼Œè¿˜ä¼šå·timerï¼Œæ‰€ä»¥åªæ˜¯å¯¹timerè¿›è¡Œæ ‡è®°ï¼Œåœ¨timeræ‰€åœ¨çš„Pä¸­ï¼Œé€šè¿‡ cleantimers/adjusttimersç­‰æ–¹æ³•æ¥çœŸæ­£ä»å †ä¸­åˆ é™¤\nå…¶ä»–timerçš„æ–¹æ³• åˆ†æäº†2ä¸ªtimerçš„æ–¹æ³•åï¼Œå°±ä¸å†é€ä¸ªçœ‹å…¶ä»–çš„æ–¹æ³•äº†ï¼Œå¤§æ¦‚éƒ½å·®ä¸å¤šï¼Œéƒ½æ˜¯å¯¹timerså †ä¸­çš„timerçŠ¶æ€è¿›è¡Œä¿®æ”¹ï¼Œtimersçš„è°ƒæ•´ç­‰\nä¿®æ”¹timer // modtimer modifies an existing timer. // This is called by the netpoll code or time.Ticker.Reset or time.Timer.Reset. // Reports whether the timer was modified before it was run. func modtimer(t *timer, when, period int64, f func(interface{}, uintptr), arg interface{}, seq uintptr) bool { if when \u0026lt;= 0 { throw(\u0026#34;timer when must be positive\u0026#34;) } if period \u0026lt; 0 { throw(\u0026#34;timer period must be non-negative\u0026#34;) } status := uint32(timerNoStatus) wasRemoved := false var pending bool var mp *m loop: for { switch status = atomic.Load(\u0026amp;t.status); status { case timerWaiting, timerModifiedEarlier, timerModifiedLater: // Prevent preemption while the timer is in timerModifying. // This could lead to a self-deadlock. See #38070. mp = acquirem() // timerWaiting, timerModifiedEarlier, timerModifiedLater --\u0026gt; timerModifying if atomic.Cas(\u0026amp;t.status, status, timerModifying) { pending = true // timer not yet run break loop } releasem(mp) case timerNoStatus, timerRemoved: // Prevent preemption while the timer is in timerModifying. // This could lead to a self-deadlock. See #38070. mp = acquirem() // Timer was already run and t is no longer in a heap. // Act like addtimer. // timerNoStatus, timerRemoved --\u0026gt; timerModifying if atomic.Cas(\u0026amp;t.status, status, timerModifying) { wasRemoved = true pending = false // timer already run or stopped break loop } releasem(mp) case timerDeleted: // Prevent preemption while the timer is in timerModifying. // This could lead to a self-deadlock. See #38070. mp = acquirem() // timerDeleted --\u0026gt; timerModifying if atomic.Cas(\u0026amp;t.status, status, timerModifying) { atomic.Xadd(\u0026amp;t.pp.ptr().deletedTimers, -1) pending = false // timer already stopped break loop } releasem(mp) case timerRunning, timerRemoving, timerMoving: // The timer is being run or moved, by a different P. // Wait for it to complete. osyield() // ç­‰å¾…çŠ¶æ€æ”¹å˜ case timerModifying: // Multiple simultaneous calls to modtimer. // Wait for the other call to complete. osyield() // ç­‰å¾…çŠ¶æ€æ”¹å˜ default: badTimer() } } t.period = period t.f = f t.arg = arg t.seq = seq if wasRemoved { t.when = when pp := getg().m.p.ptr() lock(\u0026amp;pp.timersLock) doaddtimer(pp, t) unlock(\u0026amp;pp.timersLock) if !atomic.Cas(\u0026amp;t.status, timerModifying, timerWaiting) { badTimer() } releasem(mp) wakeNetPoller(when) } else { // The timer is in some other P\u0026#39;s heap, so we can\u0026#39;t change // the when field. If we did, the other P\u0026#39;s heap would // be out of order. So we put the new when value in the // nextwhen field, and let the other P set the when field // when it is prepared to resort the heap. t.nextwhen = when newStatus := uint32(timerModifiedLater) if when \u0026lt; t.when { newStatus = timerModifiedEarlier } tpp := t.pp.ptr() // Update the adjustTimers field. Subtract one if we // are removing a timerModifiedEarlier, add one if we // are adding a timerModifiedEarlier. adjust := int32(0) if status == timerModifiedEarlier { adjust-- } if newStatus == timerModifiedEarlier { adjust++ updateTimerModifiedEarliest(tpp, when) } if adjust != 0 { atomic.Xadd(\u0026amp;tpp.adjustTimers, adjust) } // Set the new status of the timer. if !atomic.Cas(\u0026amp;t.status, timerModifying, newStatus) { badTimer() } releasem(mp) // If the new status is earlier, wake up the poller. if newStatus == timerModifiedEarlier { wakeNetPoller(when) } } return pending } è°ƒæ•´timer // ä¸cleantimersç±»ä¼¼ï¼Œåªæ˜¯ cleantimers åªå¤„ç†é˜Ÿåˆ—å¤´éƒ¨çš„timer // adjusttimers looks through the timers in the current P\u0026#39;s heap for // any timers that have been modified to run earlier, and puts them in // the correct place in the heap. While looking for those timers, // it also moves timers that have been modified to run later, // and removes deleted timers. The caller must have locked the timers for pp. func adjusttimers(pp *p, now int64) { if atomic.Load(\u0026amp;pp.adjustTimers) == 0 { if verifyTimers { verifyTimerHeap(pp) } // There are no timers to adjust, so it is safe to clear // timerModifiedEarliest. Do so in case it is stale. // Everything will work if we don\u0026#39;t do this, // but clearing here may save future calls to adjusttimers. atomic.Store64(\u0026amp;pp.timerModifiedEarliest, 0) return } // If we haven\u0026#39;t yet reached the time of the first timerModifiedEarlier // timer, don\u0026#39;t do anything. This speeds up programs that adjust // a lot of timers back and forth if the timers rarely expire. // We\u0026#39;ll postpone looking through all the adjusted timers until // one would actually expire. if first := atomic.Load64(\u0026amp;pp.timerModifiedEarliest); first != 0 { if int64(first) \u0026gt; now { if verifyTimers { verifyTimerHeap(pp) } return } // We are going to clear all timerModifiedEarlier timers. atomic.Store64(\u0026amp;pp.timerModifiedEarliest, 0) } var moved []*timer loop: for i := 0; i \u0026lt; len(pp.timers); i++ { t := pp.timers[i] if t.pp.ptr() != pp { throw(\u0026#34;adjusttimers: bad p\u0026#34;) } switch s := atomic.Load(\u0026amp;t.status); s { case timerDeleted: if atomic.Cas(\u0026amp;t.status, s, timerRemoving) { dodeltimer(pp, i) if !atomic.Cas(\u0026amp;t.status, timerRemoving, timerRemoved) { badTimer() } atomic.Xadd(\u0026amp;pp.deletedTimers, -1) // Look at this heap position again. i-- } case timerModifiedEarlier, timerModifiedLater: if atomic.Cas(\u0026amp;t.status, s, timerMoving) { // Now we can change the when field. t.when = t.nextwhen // Take t off the heap, and hold onto it. // We don\u0026#39;t add it back yet because the // heap manipulation could cause our // loop to skip some other timer. dodeltimer(pp, i) moved = append(moved, t) if s == timerModifiedEarlier { if n := atomic.Xadd(\u0026amp;pp.adjustTimers, -1); int32(n) \u0026lt;= 0 { break loop } } // Look at this heap position again. i-- } case timerNoStatus, timerRunning, timerRemoving, timerRemoved, timerMoving: badTimer() case timerWaiting: // OK, nothing to do. case timerModifying: // Check again after modification is complete. osyield() i-- default: badTimer() } } if len(moved) \u0026gt; 0 { addAdjustedTimers(pp, moved) } if verifyTimers { verifyTimerHeap(pp) } } è¿è¡Œtimer // runtimer æ£€æŸ¥timerså››å‰å †é¡¶éƒ¨çš„timer // runtimer examines the first timer in timers. If it is ready based on now, // it runs the timer and removes or updates it. // Returns 0 if it ran a timer, -1 if there are no more timers, or the time // when the first timer should run. // The caller must have locked the timers for pp. // If a timer is run, this will temporarily unlock the timers. //go:systemstack func runtimer(pp *p, now int64) int64 { for { t := pp.timers[0] if t.pp.ptr() != pp { throw(\u0026#34;runtimer: bad p\u0026#34;) } switch s := atomic.Load(\u0026amp;t.status); s { case timerWaiting: if t.when \u0026gt; now { // è¿˜æ²¡åˆ°æ—¶é—´æ‰§è¡Œ // Not ready to run. return t.when } // è¯¥æ‰§è¡Œè¿™ä¸ªtimeräº† if !atomic.Cas(\u0026amp;t.status, s, timerRunning) { continue } // Note that runOneTimer may temporarily unlock // pp.timersLock. runOneTimer(pp, t, now) return 0 case timerDeleted: // åˆ é™¤å·²ç»æ‰§è¡Œäº†çš„timer if !atomic.Cas(\u0026amp;t.status, s, timerRemoving) { continue } dodeltimer0(pp) if !atomic.Cas(\u0026amp;t.status, timerRemoving, timerRemoved) { badTimer() } atomic.Xadd(\u0026amp;pp.deletedTimers, -1) if len(pp.timers) == 0 { return -1 } case timerModifiedEarlier, timerModifiedLater: // è°ƒæ•´timerModifiedEarlier, timerModifiedLater timerçš„æ—¶é—´ if !atomic.Cas(\u0026amp;t.status, s, timerMoving) { continue } t.when = t.nextwhen dodeltimer0(pp) doaddtimer(pp, t) if s == timerModifiedEarlier { atomic.Xadd(\u0026amp;pp.adjustTimers, -1) } if !atomic.Cas(\u0026amp;t.status, timerMoving, timerWaiting) { badTimer() } case timerModifying: // Wait for modification to complete. osyield() // ç­‰åˆ°å…¶ä»–æ“ä½œç»“æŸ case timerNoStatus, timerRemoved: // Should not see a new or inactive timer on the heap. badTimer() case timerRunning, timerRemoving, timerMoving: // These should only be set when timers are locked, // and we didn\u0026#39;t do it. badTimer() default: badTimer() } } } è§¦å‘timer å‰é¢ä»‹ç»çš„éƒ½æ˜¯å°† timeråŠ å…¥åˆ° å †ä¸­ï¼Œä»å †ä¸­åˆ é™¤è¿™äº›ï¼Œé‚£ä¹ˆtimeræ—¶é—´åˆ°äº†ï¼Œæ˜¯æ€ä¹ˆè§¦å‘çš„å‘¢ï¼Ÿ\nè§¦å‘timerä¸€å®šä¼šæ‰§è¡Œå‰é¢æ‰€è¯´çš„runtimeræ–¹æ³•ï¼Œå¯ä»¥å‘ç°runtimeræ˜¯åœ¨checkTimersæ–¹æ³•ä¸­è¢«è°ƒç”¨çš„\n// checkTimers runs any timers for the P that are ready. // If now is not 0 it is the current time. // It returns the current time or 0 if it is not known, // and the time when the next timer should run or 0 if there is no next timer, // and reports whether it ran any timers. // If the time when the next timer should run is not 0, // it is always larger than the returned time. // We pass now in and out to avoid extra calls of nanotime. //go:yeswritebarrierrec func checkTimers(pp *p, now int64) (rnow, pollUntil int64, ran bool) { // If it\u0026#39;s not yet time for the first timer, or the first adjusted // timer, then there is nothing to do. next := int64(atomic.Load64(\u0026amp;pp.timer0When)) nextAdj := int64(atomic.Load64(\u0026amp;pp.timerModifiedEarliest)) if next == 0 || (nextAdj != 0 \u0026amp;\u0026amp; nextAdj \u0026lt; next) { next = nextAdj } if next == 0 { // æ²¡æœ‰timeréœ€è¦æ‰§è¡Œå’Œè°ƒæ•´ // No timers to run or adjust. return now, 0, false } if now == 0 { now = nanotime() } if now \u0026lt; next { // æœ€å¿«çš„ timerè¿˜æ²¡åˆ° æ‰§è¡Œçš„æ—¶é—´ // Next timer is not ready to run, but keep going // if we would clear deleted timers. // This corresponds to the condition below where // we decide whether to call clearDeletedTimers. if pp != getg().m.p.ptr() || int(atomic.Load(\u0026amp;pp.deletedTimers)) \u0026lt;= int(atomic.Load(\u0026amp;pp.numTimers)/4) { return now, next, false } } lock(\u0026amp;pp.timersLock) if len(pp.timers) \u0026gt; 0 { adjusttimers(pp, now) // åˆ é™¤å·²ç»æ‰§è¡Œçš„timerï¼Œè°ƒæ•´timerModifiedEarlier å’Œ timerModifiedLater çš„è®¡æ—¶å™¨çš„æ—¶é—´ for len(pp.timers) \u0026gt; 0 { // æ‰§è¡Œæ‰€æœ‰åˆ°æœŸçš„timer // Note that runtimer may temporarily unlock // pp.timersLock. if tw := runtimer(pp, now); tw != 0 { if tw \u0026gt; 0 { pollUntil = tw } break } ran = true } } // If this is the local P, and there are a lot of deleted timers, // clear them out. We only do this for the local P to reduce // lock contention on timersLock. // å½“å‰ Goroutine çš„å¤„ç†å™¨å’Œä¼ å…¥çš„å¤„ç†å™¨ç›¸åŒ,å¹¶ä¸”å¤„ç†å™¨ä¸­åˆ é™¤çš„è®¡æ—¶å™¨æ˜¯å †ä¸­è®¡æ—¶å™¨çš„ 1/4 ä»¥ä¸Šï¼Œ if pp == getg().m.p.ptr() \u0026amp;\u0026amp; int(atomic.Load(\u0026amp;pp.deletedTimers)) \u0026gt; len(pp.timers)/4 { clearDeletedTimers(pp) } unlock(\u0026amp;pp.timersLock) return now, pollUntil, ran } è€ŒcheckTimersåœ¨findrunnableå’Œscheduleä¸­è¢«è°ƒç”¨ï¼Œè€Œè¿™2ä¸ªæ–¹æ³•éƒ½æ˜¯runtimeè°ƒåº¦ä¼šæ‰§è¡Œçš„æ–¹æ³•ï¼ˆPSï¼šruntimeè°ƒåº¦ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œäº†è§£ï¼‰\né™¤äº†runtimeè°ƒåº¦æ—¶ä¼šæ‰§è¡Œtimerå¤–ï¼Œç³»ç»Ÿç›‘æ§sysmonä¹Ÿä¼šæ‰§è¡Œtimerï¼Œå…¶å®è¿™é‡Œæˆ‘æ²¡æœ‰ç†è§£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ç”¨dravenesså¤§ä½¬æ–‡ç« ä¸­çš„è¯´æ˜\nç³»ç»Ÿç›‘æ§å‡½æ•° runtime.sysmon ä¹Ÿå¯èƒ½ä¼šè§¦å‘å‡½æ•°çš„è®¡æ—¶å™¨ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­çœç•¥äº†å¤§é‡ä¸è®¡æ—¶å™¨æ— å…³çš„ä»£ç ï¼š\nfunc sysmon() { ... for { ... now := nanotime() next, _ := timeSleepUntil() ... lastpoll := int64(atomic.Load64(\u0026amp;sched.lastpoll)) if netpollinited() \u0026amp;\u0026amp; lastpoll != 0 \u0026amp;\u0026amp; lastpoll+10*1000*1000 \u0026lt; now { atomic.Cas64(\u0026amp;sched.lastpoll, uint64(lastpoll), uint64(now)) list := netpoll(0) if !list.empty() { incidlelocked(-1) injectglist(\u0026amp;list) incidlelocked(1) } } if next \u0026lt; now { startm(nil, false) } ... } è°ƒç”¨Â [runtime.timeSleepUntil](https://draveness.me/golang/tree/runtime.timeSleepUntil)Â è·å–è®¡æ—¶å™¨çš„åˆ°æœŸæ—¶é—´ä»¥åŠæŒæœ‰è¯¥è®¡æ—¶å™¨çš„å †ï¼› å¦‚æœè¶…è¿‡ 10ms çš„æ—¶é—´æ²¡æœ‰è½®è¯¢ï¼Œè°ƒç”¨Â [runtime.netpoll](https://draveness.me/golang/tree/runtime.netpoll)Â è½®è¯¢ç½‘ç»œï¼› å¦‚æœå½“å‰æœ‰åº”è¯¥è¿è¡Œçš„è®¡æ—¶å™¨æ²¡æœ‰æ‰§è¡Œï¼Œå¯èƒ½å­˜åœ¨æ— æ³•è¢«æŠ¢å çš„å¤„ç†å™¨ï¼Œè¿™æ—¶æˆ‘ä»¬åº”è¯¥å¯åŠ¨æ–°çš„çº¿ç¨‹å¤„ç†è®¡æ—¶å™¨ï¼› åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­Â [runtime.timeSleepUntil](https://draveness.me/golang/tree/runtime.timeSleepUntil)Â ä¼šéå†è¿è¡Œæ—¶çš„å…¨éƒ¨å¤„ç†å™¨å¹¶æŸ¥æ‰¾ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„è®¡æ—¶å™¨ã€‚\né—ç•™é—®é¢˜ æœ€åæ˜¯æˆ‘è¿˜å­˜åœ¨çš„é—®é¢˜\nsysmonä¸­ä¸ºä»€ä¹ˆä¼šè§¦å‘timer\naddtimeræ–¹æ³•ä¸­è°ƒç”¨äº†wakeNetPoller(when)æ–¹æ³•å”¤é†’netpollï¼Œä½†æ˜¯netpoll()æ–¹æ³•ä¸­å¯¹netpollBreakRdçš„å¤„ç†å¹¶æ²¡æœ‰å‘ç°ä¸timeræœ‰å•¥å…³ç³»\n// netpoll checks for ready network connections. // Returns list of goroutines that become runnable. // delay \u0026lt; 0: blocks indefinitely // delay == 0: does not block, just polls // delay \u0026gt; 0: block for up to that many nanoseconds // delay \u0026lt; 0 æ— é™blockç­‰å¾… // delay == 0 ä¸ä¼šblock // delay block æœ€å¤šdelayæ—¶é—´ // runtime.netpoll è¿”å›çš„ Goroutine åˆ—è¡¨éƒ½ä¼šè¢« runtime.injectglist æ³¨å…¥åˆ°å¤„ç†å™¨æˆ–è€…å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ä¸Šã€‚ // å› ä¸ºç³»ç»Ÿç›‘æ§ Goroutine ç›´æ¥è¿è¡Œåœ¨çº¿ç¨‹ä¸Šï¼Œæ‰€ä»¥å®ƒè·å–çš„ Goroutine åˆ—è¡¨ä¼šç›´æ¥åŠ å…¥å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ï¼Œ // å…¶ä»– Goroutine è·å–çš„åˆ—è¡¨éƒ½ä¼šåŠ å…¥ Goroutine æ‰€åœ¨å¤„ç†å™¨çš„è¿è¡Œé˜Ÿåˆ—ä¸Šã€‚ func netpoll(delay int64) gList { if epfd == -1 { // æ²¡æœ‰epfd ç›¸å½“äºnetpollæ²¡æœ‰åˆå§‹åŒ– return gList{} } var waitms int32 if delay \u0026lt; 0 { waitms = -1 } else if delay == 0 { waitms = 0 } else if delay \u0026lt; 1e6 { waitms = 1 } else if delay \u0026lt; 1e15 { waitms = int32(delay / 1e6) } else { // An arbitrary cap on how long to wait for a timer. // 1e9 ms == ~11.5 days. waitms = 1e9 } var events [128]epollevent retry: // ç­‰å¾…æ–‡ä»¶æè¿°ç¬¦è½¬æ¢æˆå¯è¯»æˆ–è€…å¯å†™ n := epollwait(epfd, \u0026amp;events[0], int32(len(events)), waitms) if n \u0026lt; 0 { // å¦‚æœè¿”å›äº†è´Ÿå€¼ï¼Œå¯èƒ½ä¼šè¿”å›ç©ºçš„ Goroutine åˆ—è¡¨æˆ–è€…é‡æ–°è°ƒç”¨ epollwait é™·å…¥ç­‰å¾…ï¼š if n != -_EINTR { println(\u0026#34;runtime: epollwait on fd\u0026#34;, epfd, \u0026#34;failed with\u0026#34;, -n) throw(\u0026#34;runtime: netpoll failed\u0026#34;) } // If a timed sleep was interrupted, just return to // recalculate how long we should sleep now. if waitms \u0026gt; 0 { return gList{} } goto retry } // å½“ epollwait ç³»ç»Ÿè°ƒç”¨è¿”å›çš„å€¼å¤§äº 0 æ—¶ï¼Œæ„å‘³ç€è¢«ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦å‡ºç°äº†å¾…å¤„ç†çš„äº‹ä»¶ var toRun gList for i := int32(0); i \u0026lt; n; i++ { ev := \u0026amp;events[i] if ev.events == 0 { continue } // runtime.netpollBreak è§¦å‘çš„äº‹ä»¶ if *(**uintptr)(unsafe.Pointer(\u0026amp;ev.data)) == \u0026amp;netpollBreakRd { if ev.events != _EPOLLIN { println(\u0026#34;runtime: netpoll: break fd ready for\u0026#34;, ev.events) throw(\u0026#34;runtime: netpoll: break fd ready for something unexpected\u0026#34;) } if delay != 0 { // netpollBreak could be picked up by a // nonblocking poll. Only read the byte // if blocking. var tmp [16]byte read(int32(netpollBreakRd), noescape(unsafe.Pointer(\u0026amp;tmp[0])), int32(len(tmp))) atomic.Store(\u0026amp;netpollWakeSig, 0) } continue } // å¦ä¸€ç§æ˜¯å…¶ä»–æ–‡ä»¶æè¿°ç¬¦çš„æ­£å¸¸è¯»å†™äº‹ä»¶ var mode int32 if ev.events\u0026amp;(_EPOLLIN|_EPOLLRDHUP|_EPOLLHUP|_EPOLLERR) != 0 { mode += \u0026#39;r\u0026#39; } if ev.events\u0026amp;(_EPOLLOUT|_EPOLLHUP|_EPOLLERR) != 0 { mode += \u0026#39;w\u0026#39; } if mode != 0 { pd := *(**pollDesc)(unsafe.Pointer(\u0026amp;ev.data)) pd.everr = false if ev.events == _EPOLLERR { pd.everr = true } netpollready(\u0026amp;toRun, pd, mode) } } return toRun } dravenesså¤§ä½¬æ–‡ç« çš„è¯„è®ºä¸­ä¹Ÿæœ‰äººæåˆ°è¿™ä¸ªç–‘é—®ï¼Œä½†æ˜¯è¿˜æ˜¯æœªèƒ½ç†è§£ï¼Œæˆ‘ä¹ŸåŠ å…¥ äº†è®¨è®ºï¼ŒæœŸå¾…åç»­çš„è§£ç­”\nå‚è€ƒèµ„æ–™ 6.3 è®¡æ—¶å™¨ Goä¸­å®šæ—¶å™¨å®ç°åŸç†åŠæºç è§£æ éš¾ä»¥é©¾é©­çš„ Go timerï¼Œä¸€æ–‡å¸¦ä½ å‚é€è®¡æ—¶å™¨çš„å¥¥ç§˜ go1.14åŸºäºnetpollä¼˜åŒ–timerå®šæ—¶å™¨å®ç°åŸç† https://www.youtube.com/watch?v=XJx0eTP-y9I ","permalink":"https://carlos19960601.github.io/posts/timer%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/","summary":"\u003cp\u003eæ ¹æ®\u003ca href=\"https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-timer/\"\u003e6.3 è®¡æ—¶å™¨\u003c/a\u003eä¸­çš„æè¿°ï¼ŒGolang Timerçš„è®¾è®¡ç»å†äº†å¦‚ä¸‹é˜¶æ®µï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGo 1.9 ç‰ˆæœ¬ä¹‹å‰ï¼Œæ‰€æœ‰çš„è®¡æ—¶å™¨ç”±å…¨å±€å”¯ä¸€çš„å››å‰å †ç»´æŠ¤ï¼›\u003c/li\u003e\n\u003cli\u003eGo 1.10 ~ 1.13ï¼Œå…¨å±€ä½¿ç”¨ 64 ä¸ªå››å‰å †ç»´æŠ¤å…¨éƒ¨çš„è®¡æ—¶å™¨ï¼Œæ¯ä¸ªå¤„ç†å™¨ï¼ˆPï¼‰åˆ›å»ºçš„è®¡æ—¶å™¨ä¼šç”±å¯¹åº”çš„å››å‰å †ç»´æŠ¤ï¼›\u003c/li\u003e\n\u003cli\u003eGo 1.14 ç‰ˆæœ¬ä¹‹åï¼Œæ¯ä¸ªå¤„ç†å™¨å•ç‹¬ç®¡ç†è®¡æ—¶å™¨å¹¶é€šè¿‡ç½‘ç»œè½®è¯¢å™¨è§¦å‘ï¼›\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003eGo 1.9 ç‰ˆæœ¬ä¹‹å‰ç”±äºä½¿ç”¨å…¨å±€çš„å››å‰å †ï¼Œåœ¨å¤šæ ¸æƒ…å†µä¸‹ä¼šå‡ºç°é”ç«äº‰å¯¼è‡´æ€§èƒ½é—®é¢˜\u003c/li\u003e\n\u003cli\u003eGo 1.10 ~ 1.13ä½¿ç”¨äº†64ä¸ªå››å‰å †ï¼Œæœ‰æ¯ä¸ªPæ¥ç»´æŠ¤å¯¹åº”çš„å››å‰å †ï¼Œç›¸å½“äºå°†é”çš„ç²’åº¦å‡å°ï¼Œä½†æ˜¯å½“timeråœ¨æœªåˆ°æ—¶é—´å’Œåˆ°æ—¶é—´éœ€è¦æ‰§è¡Œè¿›è¡Œåˆ‡æ¢çš„æ—¶å€™ï¼Œä¼šå‘ç”ŸPå’ŒMçš„ç»‘å®šå’Œè§£ç»‘ï¼Œå°¤å…¶æ˜¯å½“timerè§¦å‘æ—¶é—´é—´éš”æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´CPUå ç”¨è¿‡é«˜ï¼ŒM/Påˆ‡æ¢çš„å¼€é”€å¢åŠ (TODO  ä¸ºä»€ä¹ˆä¼šå‘ç”ŸPå’ŒMçš„ç»‘å®šå’Œè§£ç»‘)\u003c/li\u003e\n\u003cli\u003eGo 1.14 ç‰ˆæœ¬åæ¯ä¸ªPç®¡ç†è®¡æ—¶å™¨å››å‰å †ï¼Œç”±ç½‘ç»œè½®è¯¢å™¨å’Œè°ƒåº¦å™¨è¿›è¡Œè§¦å‘\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæˆ‘ä½¿ç”¨çš„æ˜¯Go 1.16çš„ç‰ˆæœ¬è¿›è¡Œåˆ†æ\u003c/p\u003e","title":"Timeræºç é˜…è¯»"},{"content":"çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆï¼Ÿ çº¿ç¨‹æ± ç”¨äºå¤šçº¿ç¨‹å¤„ç†ä¸­ï¼Œå®ƒå¯ä»¥æ ¹æ®ç³»ç»Ÿçš„æƒ…å†µï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶çº¿ç¨‹æ‰§è¡Œçš„æ•°é‡ï¼Œä¼˜åŒ–è¿è¡Œæ•ˆæœã€‚çº¿ç¨‹æ± åšçš„å·¥ä½œä¸»è¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹çš„æ•°é‡ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡è¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™ï¼Œç­‰å…¶å®ƒçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚\nçº¿ç¨‹æ± çš„ä½œç”¨ åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œåˆ›å»ºå¯¹è±¡å’Œé”€æ¯å¯¹è±¡æ˜¯éå¸¸æ¶ˆè€—æ—¶é—´å’Œèµ„æºçš„ã€‚å› æ­¤æƒ³è¦æœ€å°åŒ–è¿™ç§æ¶ˆè€—çš„ä¸€ç§æ€æƒ³å°±æ˜¯ã€æ± åŒ–èµ„æºã€ã€‚çº¿ç¨‹æ± å°±æ˜¯è¿™æ ·çš„ä¸€ç§æ€æƒ³ã€‚æˆ‘ä»¬é€šè¿‡é‡ç”¨çº¿ç¨‹æ± ä¸­çš„èµ„æºæ¥å‡å°‘åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ‰€éœ€è¦è€—è´¹çš„æ—¶é—´å’Œèµ„æºã€‚\nçº¿ç¨‹æ± çš„ä¸€ä¸ªä½œç”¨æ˜¯åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼›å¦ä¸€ä¸ªä½œç”¨æ˜¯å¯æ ¹æ®ç³»ç»Ÿæƒ…å†µè°ƒæ•´æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œé˜²æ­¢æ¶ˆè€—è¿‡å¤šå†…å­˜ã€‚å¦å¤–ï¼Œé€šè¿‡çº¿ç¨‹æ± ï¼Œèƒ½æœ‰æ•ˆçš„æ§åˆ¶çº¿ç¨‹çš„æœ€å¤§å¹¶å‘æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡ï¼ŒåŒæ—¶é¿å…è¿‡å¤šçš„èµ„æºç«äº‰ï¼Œé¿å…å µå¡ã€‚\nçº¿ç¨‹æ± çš„ä¼˜ç‚¹æ€»ç»“å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nçº¿ç¨‹å¤ç”¨ æ§åˆ¶æœ€å¤§å¹¶å‘æ•° ç®¡ç†çº¿ç¨‹ çº¿ç¨‹æ± çš„ç»„æˆ ä¸€èˆ¬çš„çº¿ç¨‹æ± ä¸»è¦åˆ†ä¸ºä»¥ä¸‹4ä¸ªç»„æˆéƒ¨åˆ†ï¼š\nçº¿ç¨‹æ± ç®¡ç†å™¨ï¼šç”¨äºåˆ›å»ºå¹¶ç®¡ç†çº¿ç¨‹æ±  å·¥ä½œçº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ ä»»åŠ¡æ¥å£ï¼šæ¯ä¸ªä»»åŠ¡å¿…é¡»å®ç°çš„æ¥å£ï¼Œç”¨äºå·¥ä½œçº¿ç¨‹è°ƒåº¦å…¶è¿è¡Œ ä»»åŠ¡é˜Ÿåˆ—ï¼šç”¨äºå­˜æ”¾å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œæä¾›ä¸€ç§ç¼“å†²æœºåˆ¶ çº¿ç¨‹æ± çš„å¸¸è§åº”ç”¨åœºæ™¯ è®¸å¤šæœåŠ¡å™¨åº”ç”¨å¸¸å¸¸éœ€è¦å¤„ç†å¤§é‡è€ŒçŸ­å°çš„è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼ŒWeb æœåŠ¡å™¨ï¼Œæ•°æ®åº“æœåŠ¡å™¨ç­‰ç­‰ï¼‰ï¼Œé€šå¸¸å®ƒä»¬æ”¶åˆ°çš„è¯·æ±‚æ•°é‡å¾ˆå¤§ï¼Œä¸€ä¸ªç®€å•çš„æ¨¡å‹æ˜¯ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°æ¥è‡ªè¿œç¨‹çš„è¯·æ±‚æ—¶ï¼Œä¸ºæ¯ä¸€ä¸ªè¯·æ±‚å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨è¯·æ±‚å®Œæ¯•ä¹‹åå†å¯¹çº¿ç¨‹è¿›è¡Œé”€æ¯ã€‚è¿™æ ·å¤„ç†å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œåˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ‰€æ¶ˆè€—çš„æ—¶é—´å¾€å¾€æ¯”ä»»åŠ¡æœ¬èº«æ‰€éœ€æ¶ˆè€—çš„èµ„æºè¦å¤§å¾—å¤šã€‚é‚£ä¹ˆåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\nçº¿ç¨‹æ± ä¸ºçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸå¼€é”€é—®é¢˜å’Œèµ„æºä¸è¶³é—®é¢˜æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡çº¿ç¨‹æ± åšåˆ°çº¿ç¨‹å¤ç”¨ï¼Œä¸éœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œè®©çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸€ç›´å­˜åœ¨äºçº¿ç¨‹æ± ä¸­ï¼Œç„¶åçº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å¾—ä»»åŠ¡æ¥æ‰§è¡Œã€‚è€Œä¸”è¿™æ ·åšçš„å¦ä¸€ä¸ªå¥½å¤„æœ‰ï¼Œé€šè¿‡é€‚å½“åœ°è°ƒæ•´çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®ï¼Œä¹Ÿå°±æ˜¯å½“è¯·æ±‚çš„æ•°ç›®è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå°±å¼ºåˆ¶å…¶å®ƒä»»ä½•æ–°åˆ°çš„è¯·æ±‚ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å¾—ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ä¸ºæ­¢ï¼Œä»è€Œå¯ä»¥é˜²æ­¢èµ„æºä¸è¶³ã€‚\nJavaçº¿ç¨‹æ± çš„ç®€ä»‹ Javaä¸­æä¾›äº†å®ç°çº¿ç¨‹æ± çš„æ¡†æ¶Executorï¼Œå¹¶ä¸”æä¾›äº†è®¸å¤šç§ç±»çš„çº¿ç¨‹æ± ï¼Œæ¥ä¸‹æ¥çš„æ–‡ç« ä¸­å°†ä¼šåšè¯¦ç»†ä»‹ç»ã€‚\nJavaçº¿ç¨‹æ± æ¡†æ¶ Javaä¸­çš„çº¿ç¨‹æ± æ˜¯é€šè¿‡Executoræ¡†æ¶å®ç°çš„ï¼Œè¯¥æ¡†æ¶ä¸­ç”¨åˆ°äº†Executorï¼ŒExecutorsï¼ŒExecutorServiceï¼ŒThreadPoolExecutor ï¼ŒCallableå’ŒFutureã€FutureTaskè¿™å‡ ä¸ªç±»ã€‚\nExecutorï¼šæ‰€æœ‰çº¿ç¨‹æ± çš„æ¥å£ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³• Executorsï¼šExecutor çš„å·¥å‚ç±»ï¼Œæä¾›äº†åˆ›å»ºå„ç§ä¸åŒçº¿ç¨‹æ± çš„æ–¹æ³•ï¼Œè¿”å›çš„çº¿ç¨‹æ± éƒ½å®ç°äº†ExecutorService æ¥å£ ThreadPoolExecutorï¼šçº¿ç¨‹æ± çš„å…·ä½“å®ç°ç±»ï¼Œä¸€èˆ¬æ‰€æœ‰çš„çº¿ç¨‹æ± éƒ½æ˜¯åŸºäºè¿™ä¸ªç±»å®ç°çš„ å…¶ä¸­ThreadPoolExecutorçš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š\npublic ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u0026lt;Runnable\u0026gt; workQueue) { this(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue, Executors.defaultThreadFactory(), defaultHandler); } å…¶ä¸­ï¼š\ncorePoolSizeï¼šçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•° maximumPoolSizeï¼šçº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•° keepAliveTimeï¼šç©ºé—²çº¿ç¨‹ç»“æŸçš„è¶…æ—¶æ—¶é—´ unitï¼šæ˜¯ä¸€ä¸ªæšä¸¾ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯ keepAliveTime çš„å•ä½ workQueueï¼šå·¥ä½œé˜Ÿåˆ—ï¼Œç”¨äºä»»åŠ¡çš„å­˜æ”¾ Javaçº¿ç¨‹æ± çš„å·¥ä½œè¿‡ç¨‹ Javaçº¿ç¨‹æ± çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š\nçº¿ç¨‹æ± åˆšåˆ›å»ºæ—¶ï¼Œé‡Œé¢æ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä½œä¸ºå‚æ•°ä¼ è¿›æ¥çš„ã€‚ä¸è¿‡ï¼Œå°±ç®—é˜Ÿåˆ—é‡Œé¢æœ‰ä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¹Ÿä¸ä¼šé©¬ä¸Šæ‰§è¡Œå®ƒä»¬ã€‚ å½“è°ƒç”¨ execute() æ–¹æ³•æ·»åŠ ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­ï¼š å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº corePoolSizeï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼› å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº corePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼› å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº maximumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼› å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº maximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šæŠ›å‡ºå¼‚å¸¸RejectExecutionExceptionã€‚ å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚ å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšï¼Œè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆkeepAliveTimeï¼‰æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äº corePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ã€‚æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ° corePoolSize çš„å¤§å°ã€‚ å¸¸è§çš„Javaçº¿ç¨‹æ±  ç”Ÿæˆçº¿ç¨‹æ± ä½¿ç”¨çš„æ˜¯Executorsçš„å·¥å‚æ–¹æ³•ï¼Œä»¥ä¸‹æ˜¯å¸¸è§çš„ Java çº¿ç¨‹æ± ï¼š\nSingleThreadExecutor SingleThreadExecutoræ˜¯å•ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œå³çº¿ç¨‹æ± ä¸­æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å› ä¸ºå¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ›¿ä»£å®ƒã€‚æ­¤çº¿ç¨‹æ± ä¿è¯æ‰€æœ‰ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºæ‰§è¡Œã€‚\npublic static ExecutorService newSingleThreadExecutor() { return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;())); } FixedThreadPool FixedThreadPoolæ˜¯å›ºå®šæ•°é‡çš„çº¿ç¨‹æ± ï¼Œåªæœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œæ¯æäº¤ä¸€ä¸ªä»»åŠ¡å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œç›´åˆ°è¾¾åˆ°çº¿ç¨‹æ± çš„æœ€å¤§æ•°é‡ï¼Œç„¶ååé¢è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç›´åˆ°å‰é¢çš„ä»»åŠ¡å®Œæˆæ‰ç»§ç»­æ‰§è¡Œã€‚çº¿ç¨‹æ± çš„å¤§å°ä¸€æ—¦è¾¾åˆ°æœ€å¤§å€¼å°±ä¼šä¿æŒä¸å˜ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å› ä¸ºæ‰§è¡Œå¼‚å¸¸è€Œç»“æŸï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šè¡¥å……ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚\npublic static ExecutorService newFixedThreadPool(int nThreads) { return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;()); } CachedThreadPool CachedThreadPoolæ˜¯å¯ç¼“å­˜çº¿ç¨‹æ± ã€‚å¦‚æœçº¿ç¨‹æ± çš„å¤§å°è¶…è¿‡äº†å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²ï¼ˆ60ç§’ä¸æ‰§è¡Œä»»åŠ¡ï¼‰çš„çº¿ç¨‹ï¼Œå½“ä»»åŠ¡æ•°å¢åŠ æ—¶ï¼Œæ­¤çº¿ç¨‹æ± åˆå¯ä»¥æ™ºèƒ½çš„æ·»åŠ æ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´JVMï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°ã€‚å…¶ä¸­ï¼ŒSynchronousQueueæ˜¯ä¸€ä¸ªæ˜¯ç¼“å†²åŒºä¸º1çš„é˜»å¡é˜Ÿåˆ—ã€‚\npublic static ExecutorService newCachedThreadPool() { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue\u0026lt;Runnable\u0026gt;()); } ScheduledThreadPool ScheduledThreadPoolæ˜¯æ ¸å¿ƒçº¿ç¨‹æ± å›ºå®šï¼Œå¤§å°æ— é™åˆ¶çš„çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶å’Œå‘¨æœŸæ€§çš„æ‰§è¡Œçº¿ç¨‹ã€‚åˆ›å»ºä¸€ä¸ªå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚å¦‚æœé—²ç½®,éæ ¸å¿ƒçº¿ç¨‹æ± ä¼šåœ¨DEFAULT_KEEPALIVEMILLISæ—¶é—´å†…å›æ”¶ã€‚\npublic ScheduledThreadPoolExecutor(int corePoolSize) { super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue()); } Java çº¿ç¨‹æ± çš„åˆ›å»ºå’Œä½¿ç”¨ æˆ‘ä»¬å¯ä»¥é€šè¿‡Executorsçš„å·¥å‚æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚ä½†æ˜¯æˆ‘ä»¬è¯¥å¦‚ä½•è®©çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡å‘¢ï¼Ÿ\nçº¿ç¨‹æ± æœ€å¸¸ç”¨çš„æäº¤ä»»åŠ¡çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼š\nexecuteï¼š ExecutorService.execute(Runnable runable)ï¼› submitï¼š FutureTask task = ExecutorService.submit(Runnable runnable); FutureTask\u0026lt;T\u0026gt; task = ExecutorService.submit(Runnable runnable,T Result); FutureTask\u0026lt;T\u0026gt; task = ExecutorService.submit(Callable\u0026lt;T\u0026gt; callable); å¯ä»¥çœ‹å‡ºsubmitå¼€å¯çš„æ˜¯æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡ï¼Œä¼šè¿”å›ä¸€ä¸ªFutureTaskå¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½é€šè¿‡get()æ–¹æ³•å¾—åˆ°ç»“æœã€‚submitæœ€ç»ˆè°ƒç”¨çš„ä¹Ÿæ˜¯execute(Runnable runable)ï¼Œsubmitåªæ˜¯å°†Callableå¯¹è±¡æˆ–Runnableå°è£…æˆä¸€ä¸ªFutureTaskå¯¹è±¡ï¼Œå› ä¸ºFutureTaskæ˜¯ä¸ªRunnableï¼Œæ‰€ä»¥å¯ä»¥åœ¨executeä¸­æ‰§è¡Œã€‚\nä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¹¶ä¸”ä½¿ç”¨å®ƒç®¡ç†çº¿ç¨‹ï¼š\npublic class MyThread extends Thread { @Override public void run() { System.out.println(Thread.currentThread().getName() + \u0026#34; is running.\u0026#34;); } } public class TestSingleThreadExecutor { public static void main(String[] args) { //åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ±  ExecutorService pool = Executors.newFixedThreadPool(2); //åˆ›å»ºå®ç°äº†Runnableæ¥å£å¯¹è±¡ Thread tt1 = new MyThread(); Thread tt2 = new MyThread(); Thread tt3 = new MyThread(); Thread tt4 = new MyThread(); Thread tt5 = new MyThread(); //å°†çº¿ç¨‹æ”¾å…¥æ± ä¸­å¹¶æ‰§è¡Œ pool.execute(tt1); pool.execute(tt2); pool.execute(tt3); pool.execute(tt4); pool.execute(tt5); //å…³é—­ pool.shutdown(); } } è¿è¡Œç»“æœï¼š\npool-1-thread-1 is running. pool-1-thread-2 is running. pool-1-thread-1 is running. pool-1-thread-2 is running. pool-1-thread-1 is running. Javaçº¿ç¨‹æ± åŸç† è¿™ç¯‡æ–‡ç« ä¼šåˆ†åˆ«ä»è¿™ä¸‰ä¸ªæ–¹é¢ï¼Œç»“åˆå…·ä½“çš„ä»£ç å®ç°æ¥å‰–æ Java çº¿ç¨‹æ± çš„åŸç†ä»¥åŠå®ƒçš„å…·ä½“å®ç°ã€‚\nçº¿ç¨‹å¤ç”¨ æˆ‘ä»¬çŸ¥é“çº¿ç¨‹æ± çš„ä¸€ä¸ªä½œç”¨æ˜¯åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ¬¡æ•°ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹å¯ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚è¿™ä¸ªåŠŸèƒ½å°±æ˜¯çº¿ç¨‹å¤ç”¨ã€‚æƒ³è¦äº†è§£ Java çº¿ç¨‹æ± æ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹å¤ç”¨çš„ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚\nçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ ä¸‹å›¾æè¿°äº†çº¿ç¨‹å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼š\nåœ¨ä¸€ä¸ªçº¿ç¨‹å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ƒå¯èƒ½ç»å†äº”ç§çŠ¶æ€ï¼šæ–°å»ºï¼ˆNewï¼‰ã€å°±ç»ªï¼ˆRunnableï¼‰ã€è¿è¡Œï¼ˆRunningï¼‰ã€é˜»å¡ï¼ˆBlockedï¼‰ã€ç»ˆæ­¢ï¼ˆZombieï¼‰ã€‚\nåœ¨ Javaä¸­ï¼ŒThread é€šè¿‡newæ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ˜¯åˆå§‹åŒ–ä¸€äº›çº¿ç¨‹ä¿¡æ¯ï¼Œå¦‚çº¿ç¨‹åã€idã€çº¿ç¨‹æ‰€å±groupç­‰ï¼Œå¯ä»¥è®¤ä¸ºåªæ˜¯ä¸ªæ™®é€šçš„å¯¹è±¡ã€‚è°ƒç”¨Threadçš„start()åJavaè™šæ‹Ÿæœºä¼šä¸ºå…¶åˆ›å»ºæ–¹æ³•è°ƒç”¨æ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼ŒåŒæ—¶å°†hasBeenStartedä¸ºtrueï¼Œä¹‹åå¦‚æœå†æ¬¡è°ƒç”¨start()æ–¹æ³•å°±ä¼šæœ‰å¼‚å¸¸ã€‚\nå¤„äºè¿™ä¸ªçŠ¶æ€ä¸­çš„çº¿ç¨‹å¹¶æ²¡æœ‰å¼€å§‹è¿è¡Œï¼Œåªæ˜¯è¡¨ç¤ºè¯¥çº¿ç¨‹å¯ä»¥è¿è¡Œäº†ã€‚è‡³äºè¯¥çº¿ç¨‹ä½•æ—¶å¼€å§‹è¿è¡Œï¼Œå–å†³äº JVM é‡Œçº¿ç¨‹è°ƒåº¦å™¨çš„è°ƒåº¦ã€‚å½“çº¿ç¨‹è·å–CPUåï¼Œrun()æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ä¸è¦è‡ªå·±å»è°ƒç”¨Threadçš„run()æ–¹æ³•ã€‚ä¹‹åæ ¹æ®CPUçš„è°ƒåº¦ï¼Œçº¿ç¨‹å°±ä¼šåœ¨å°±ç»ªâ€”è¿è¡Œâ€”é˜»å¡é—´åˆ‡æ¢ï¼Œç›´åˆ°run()æ–¹æ³•ç»“æŸæˆ–å…¶ä»–æ–¹å¼åœæ­¢çº¿ç¨‹ï¼Œè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚\nå› æ­¤ï¼Œå¦‚æœè¦å®ç°çº¿ç¨‹çš„å¤ç”¨ï¼Œæˆ‘ä»¬å¿…é¡»è¦ä¿è¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¿æŒå­˜æ´»çŠ¶æ€ï¼ˆå°±ç»ªã€è¿è¡Œã€é˜»å¡ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹ThreadPoolExecutoræ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å¤ç”¨çš„ã€‚\nWorker ç±» ThreadPoolExecutorä¸»è¦æ˜¯é€šè¿‡ä¸€ä¸ªç±»æ¥æ§åˆ¶çº¿ç¨‹å¤ç”¨çš„ï¼šWorker ç±»ã€‚\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç®€åŒ–åçš„ Worker ç±»ä»£ç ï¼š\nprivate final class Worker implements Runnable { final Thread thread; Runnable firstTask; Worker(Runnable firstTask) { this.firstTask = firstTask; this.thread = getThreadFactory().newThread(this); } public void run() { runWorker(this); } final void runWorker(Worker w) { Runnable task = w.firstTask; w.firstTask = null; while (task != null || (task = getTask()) != null){ task.run(); } } â€¦â€¦ } ä»ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Worker å®ç°äº† Runnable æ¥å£ï¼Œå¹¶ä¸”å®ƒè¿˜æœ‰ä¸€ä¸ª Threadæˆå‘˜å˜é‡ threadï¼Œè¿™ä¸ª thread å°±æ˜¯è¦å¼€å¯è¿è¡Œçš„çº¿ç¨‹ã€‚æˆ‘ä»¬çœ‹åˆ° Worker çš„æ„é€ æ–¹æ³•ä¸­ä¼ é€’äº†ä¸€ä¸ª Runnable å‚æ•°ï¼ŒåŒæ—¶å®ƒæŠŠè‡ªå·±ä½œä¸ºå‚æ•°ä¼ å…¥ newThread()ï¼Œè¿™æ ·çš„è¯ï¼Œå½“ Thread çš„start()æ–¹æ³•å¾—åˆ°è°ƒç”¨æ—¶ï¼Œæ‰§è¡Œçš„å…¶å®æ˜¯ Worker çš„run()æ–¹æ³•ï¼Œå³runWorker()æ–¹æ³•ã€‚\nrunWorker()æ–¹æ³•ä¹‹ä¸­æœ‰ä¸€ä¸ª while å¾ªç¯ï¼Œä½¿ç”¨ getTask()æ¥è·å–ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°getTask()æ˜¯å¦‚ä½•è·å–åˆ° Runnable å¯¹è±¡çš„ã€‚\ngetTask() æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç®€åŒ–åçš„getTask()ä»£ç ï¼š\nprivate Runnable getTask() { if(ä¸€äº›ç‰¹æ®Šæƒ…å†µ) { return null; } Runnable r = workQueue.take(); return r; } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»»åŠ¡æ˜¯ä» workQueueä¸­è·å–çš„ï¼Œè¿™ä¸ª workQueue å°±æ˜¯æˆ‘ä»¬åˆå§‹åŒ– ThreadPoolExecutor æ—¶å­˜æ”¾ä»»åŠ¡çš„ BlockingQueueé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—é‡Œçš„å­˜æ”¾çš„éƒ½æ˜¯å°†è¦æ‰§è¡Œçš„ Runnableä»»åŠ¡ã€‚å› ä¸º BlockingQueue æ˜¯ä¸ªé˜»å¡é˜Ÿåˆ—ï¼ŒBlockingQueue.take()è¿”å›çš„æ˜¯ç©ºï¼Œåˆ™è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ° BlockingQueue æœ‰æ–°çš„å¯¹è±¡è¢«åŠ å…¥æ—¶å”¤é†’é˜»å¡çš„çº¿ç¨‹ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒThreadçš„run()æ–¹æ³•ä¸ä¼šç»“æŸï¼Œè€Œæ˜¯ä¸æ–­æ‰§è¡ŒworkQueueé‡Œçš„Runnableä»»åŠ¡ï¼Œè¿™å°±è¾¾åˆ°äº†çº¿ç¨‹å¤ç”¨çš„ç›®çš„äº†ã€‚\næ§åˆ¶æœ€å¤§å¹¶å‘æ•° æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“äº† Java çº¿ç¨‹æ± æ˜¯å¦‚ä½•åšåˆ°çº¿ç¨‹å¤ç”¨çš„äº†ï¼Œä½†æ˜¯Runnable æ˜¯ä»€ä¹ˆæ—¶å€™è¢«æ”¾å…¥ workQueue é˜Ÿåˆ—ä¸­çš„å‘¢ï¼ŒWorkeré‡Œçš„Threadçš„åˆæ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨start()å¼€å¯æ–°çº¿ç¨‹æ¥æ‰§è¡ŒWorkerçš„run()æ–¹æ³•çš„å‘¢ï¼Ÿä»ä¸Šé¢çš„åˆ†æä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºWorkeré‡Œçš„runWorker()æ‰§è¡Œä»»åŠ¡æ—¶æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªï¼Œä¸²è¡Œè¿›è¡Œçš„ï¼Œé‚£å¹¶å‘æ˜¯æ€ä¹ˆä½“ç°çš„å‘¢ï¼Ÿå®ƒåˆæ˜¯å¦‚ä½•åšåˆ°æ§åˆ¶æœ€å¤§å¹¶å‘æ•°çš„å‘¢ï¼Ÿ\nexecute() é€šè¿‡æŸ¥çœ‹ execute()å°±èƒ½è§£ç­”ä¸Šè¿°çš„ä¸€äº›é—®é¢˜ï¼ŒåŒæ ·æ˜¯ç®€åŒ–åçš„ä»£ç ï¼š\npublic void execute(Runnable command) { if (command == null) throw new NullPointerException(); int c = ctl.get(); // å½“å‰çº¿ç¨‹æ•° \u0026lt; corePoolSize if (workerCountOf(c) \u0026lt; corePoolSize) { // ç›´æ¥å¯åŠ¨æ–°çš„çº¿ç¨‹ã€‚ if (addWorker(command, true)) return; c = ctl.get(); } // æ´»åŠ¨çº¿ç¨‹æ•° \u0026gt;= corePoolSize // runStateä¸ºRUNNING \u0026amp;\u0026amp; é˜Ÿåˆ—æœªæ»¡ if (isRunning(c) \u0026amp;\u0026amp; workQueue.offer(command)) { int recheck = ctl.get(); // å†æ¬¡æ£€éªŒæ˜¯å¦ä¸ºRUNNINGçŠ¶æ€ // éRUNNINGçŠ¶æ€ åˆ™ä»workQueueä¸­ç§»é™¤ä»»åŠ¡å¹¶æ‹’ç» if (!isRunning(recheck) \u0026amp;\u0026amp; remove(command)) reject(command); // é‡‡ç”¨çº¿ç¨‹æ± æŒ‡å®šçš„ç­–ç•¥æ‹’ç»ä»»åŠ¡ // ä¸¤ç§æƒ…å†µï¼š // 1.éRUNNINGçŠ¶æ€æ‹’ç»æ–°çš„ä»»åŠ¡ // 2.é˜Ÿåˆ—æ»¡äº†å¯åŠ¨æ–°çš„çº¿ç¨‹å¤±è´¥ï¼ˆworkCount \u0026gt; maximumPoolSizeï¼‰ } else if (!addWorker(command, false)) reject(command); } addWorker() æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹addWorker()çš„ç®€åŒ–ä»£ç ï¼š\nprivate boolean addWorker(Runnable firstTask, boolean core) { int wc = workerCountOf(c); if (wc \u0026gt;= (core ? corePoolSize : maximumPoolSize)) { return false; } w = new Worker(firstTask); final Thread t = w.thread; t.start(); } æ ¹æ®ä¸Šé¢çš„ä»£ç ï¼Œçº¿ç¨‹æ± å·¥ä½œè¿‡ç¨‹ä¸­æ˜¯å¦‚ä½•æ·»åŠ ä»»åŠ¡çš„å°±å¾ˆæ¸…æ™°äº†ï¼š\nå¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº corePoolSizeï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼› å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº corePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼› å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº maximumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼› å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº maximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šæŠ›å‡ºå¼‚å¸¸RejectExecutionException å¦‚æœé€šè¿‡addWorker()æˆåŠŸåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œåˆ™é€šè¿‡start()å¼€å¯æ–°çº¿ç¨‹ï¼ŒåŒæ—¶å°†firstTaskä½œä¸ºè¿™ä¸ªWorkeré‡Œçš„run()ä¸­æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚è™½ç„¶æ¯ä¸ªWorkerçš„ä»»åŠ¡æ˜¯ä¸²è¡Œå¤„ç†ï¼Œä½†å¦‚æœåˆ›å»ºäº†å¤šä¸ªWorkerï¼Œå› ä¸ºå…±ç”¨ä¸€ä¸ªworkQueueï¼Œæ‰€ä»¥å°±ä¼šå¹¶è¡Œå¤„ç†äº†ã€‚æ‰€ä»¥å¯ä»¥æ ¹æ®corePoolSizeå’ŒmaximumPoolSizeæ¥æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ã€‚\nè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nç®¡ç†çº¿ç¨‹ ä¸Šè¾¹çš„æ–‡ç« å·²ç»è®²äº†ï¼Œé€šè¿‡çº¿ç¨‹æ± å¯ä»¥å¾ˆå¥½çš„ç®¡ç†çº¿ç¨‹çš„å¤ç”¨ï¼Œæ§åˆ¶å¹¶å‘æ•°ï¼Œä»¥åŠé”€æ¯ç­‰è¿‡ç¨‹ï¼Œè€Œçº¿ç¨‹çš„ç®¡ç†è¿‡ç¨‹å·²ç»ç©¿æ’åœ¨å…¶ä¸­äº†ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ã€‚\nåœ¨ ThreadPoolExecutor æœ‰ä¸ªAtomicIntegerå˜é‡ ctlï¼Œè¿™ä¸€ä¸ªå˜é‡ä¿å­˜äº†ä¸¤ä¸ªå†…å®¹ï¼š\næ‰€æœ‰çº¿ç¨‹çš„æ•°é‡ æ¯ä¸ªçº¿ç¨‹æ‰€å¤„çš„çŠ¶æ€ å…¶ä¸­ä½29ä½å­˜çº¿ç¨‹æ•°ï¼Œé«˜3ä½å­˜runStateï¼Œé€šè¿‡ä½è¿ç®—æ¥å¾—åˆ°ä¸åŒçš„å€¼ã€‚\nprivate final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0)); //å¾—åˆ°çº¿ç¨‹çš„çŠ¶æ€ private static int runStateOf(int c) { return c \u0026amp; ~CAPACITY; } //å¾—åˆ°Workerçš„çš„æ•°é‡ private static int workerCountOf(int c) { return c \u0026amp; CAPACITY; } // åˆ¤æ–­çº¿ç¨‹æ˜¯å¦åœ¨è¿è¡Œ private static boolean isRunning(int c) { return c \u0026lt; SHUTDOWN; } è¿™é‡Œä¸»è¦é€šè¿‡shutdownå’ŒshutdownNow()æ¥åˆ†æçº¿ç¨‹æ± çš„å…³é—­è¿‡ç¨‹ã€‚é¦–å…ˆçº¿ç¨‹æ± æœ‰äº”ç§çŠ¶æ€æ¥æ§åˆ¶ä»»åŠ¡æ·»åŠ ä¸æ‰§è¡Œã€‚ä¸»è¦ä»‹ç»ä»¥ä¸‹ä¸‰ç§ï¼š\nRUNNINGçŠ¶æ€ï¼šçº¿ç¨‹æ± æ­£å¸¸è¿è¡Œï¼Œå¯ä»¥æ¥å—æ–°çš„ä»»åŠ¡å¹¶å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼› SHUTDOWNçŠ¶æ€ï¼šä¸å†æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¼šæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼› STOPçŠ¶æ€ï¼šä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ shutdown()è¿™ä¸ªæ–¹æ³•ä¼šå°†runStateç½®ä¸ºSHUTDOWNï¼Œä¼šç»ˆæ­¢æ‰€æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œè€Œä»åœ¨å·¥ä½œçš„çº¿ç¨‹ä¸å—å½±å“ï¼Œæ‰€ä»¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡äººä¼šè¢«æ‰§è¡Œï¼›shutdownNow()æ–¹æ³•å°†runStateç½®ä¸ºSTOPã€‚å’Œshutdown()æ–¹æ³•çš„åŒºåˆ«æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šç»ˆæ­¢æ‰€æœ‰çš„çº¿ç¨‹ï¼Œæ‰€ä»¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œäº†ã€‚\nJavaçº¿ç¨‹æ± æ¡†æ¶æºç åˆ†æ å‰é¢çš„æ–‡ç« ä¸­å·²ç»ç»™å‡ºäº†Javaçº¿ç¨‹æ± æ¡†æ¶ä¸­å‡ ä¸ªé‡è¦ç±»çš„å…³ç³»å›¾:\nç°åœ¨æˆ‘ä»¬åŸºäºè¿™å¼ å›¾æ¥é€æ­¥åˆ†æã€‚\nExecutor public interface Executor { void execute(Runnable command); } è¿™ä¸ªæ¥å£è¡¨ç¤ºå‘çº¿ç¨‹æ± ä¸­æäº¤ä¸€ä¸ªä»»åŠ¡ã€‚\nExecutorService public interface ExecutorService extends Executor { void shutdown(); List\u0026lt;Runnable\u0026gt; shutdownNow(); boolean isShutdown(); boolean isTerminated(); boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException; \u0026lt;T\u0026gt; Future\u0026lt;T\u0026gt; submit(Callable\u0026lt;T\u0026gt; task); \u0026lt;T\u0026gt; Future\u0026lt;T\u0026gt; submit(Runnable task, T result); Future\u0026lt;?\u0026gt; submit(Runnable task); \u0026lt;T\u0026gt; List\u0026lt;Future\u0026lt;T\u0026gt;\u0026gt; invokeAll(Collection\u0026lt;? extends Callable\u0026lt;T\u0026gt;\u0026gt; tasks) throws InterruptedException; \u0026lt;T\u0026gt; List\u0026lt;Future\u0026lt;T\u0026gt;\u0026gt; invokeAll(Collection\u0026lt;? extends Callable\u0026lt;T\u0026gt;\u0026gt; tasks, long timeout, TimeUnit unit) throws InterruptedException; \u0026lt;T\u0026gt; T invokeAny(Collection\u0026lt;? extends Callable\u0026lt;T\u0026gt;\u0026gt; tasks) throws InterruptedException, ExecutionException; \u0026lt;T\u0026gt; T invokeAny(Collection\u0026lt;? extends Callable\u0026lt;T\u0026gt;\u0026gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException; } å¯ä»¥çœ‹åˆ° ExecutorService æ‰©å±•äº† Executor æ¥å£ï¼Œåœ¨ Executor åŸºç¡€ä¸Šæä¾›äº†æ›´å¤šçš„æäº¤ä»»åŠ¡çš„æ–¹å¼å’Œç®¡ç†çº¿ç¨‹æ± çš„ä¸€äº›æ–¹æ³•ã€‚\nAbstractExecutorService public abstract class AbstractExecutorService implements ExecutorService { } ThreadPoolExecutor ThreadPoolExecutor æ˜¯çº¿ç¨‹æ± æ¡†æ¶çš„å…³é”®ç±». é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ ThreadPoolExecutor ä¸­å‡ ä¸ªé‡è¦çš„å±æ€§.\npublic class ThreadPoolExecutor extends AbstractExecutorService { /** * æ•´ä¸ªçº¿ç¨‹æ± çš„çŠ¶æ€æ§åˆ¶ç±» ctl, æ˜¯ä¸€ä¸ª AtomicInteger ï¼Œå°è£…äº†ä¸‹é¢2ä¸ªéƒ¨åˆ†: * workerCount è¡¨ç¤ºæœ‰æ•ˆçš„çº¿ç¨‹æ•° * runState è¡¨ç¤ºçº¿ç¨‹æ± å½“å‰çŠ¶æ€ï¼Œæ˜¯running, shutdownè¿˜æ˜¯å…¶ä»–çŠ¶æ€ * * runStateè¡¨ç¤ºäº†çº¿ç¨‹æ± çš„æ•´ä¸ªæ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥å–ä»¥ä¸‹å€¼: * RUNNING: æ¥å—æ–°çš„taskï¼Œå¤„ç†é˜Ÿåˆ—ä¸­çš„task * SHUTDOWN: ä¸æ¥å—æ–°çš„ task ä½†ä¼šå¤„ç†é˜Ÿåˆ—ä¸­çš„ task * STOP: ä¸æ¥å—æ–°çš„ task, ä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ task, ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ task * TIDYING: æ‰€æœ‰ task æ‰§è¡Œç»“æŸ, workerCount æ˜¯ 0, çº¿ç¨‹è¿‡æ¸¡åˆ°TIDYINGä¼šè°ƒç”¨ terminated()é’©å­æ–¹æ³• * TERMINATED: terminated()æ‰§è¡Œå®Œæˆ * * çŠ¶æ€è½¬æ¢å…³ç³»: * * RUNNING -\u0026gt; SHUTDOWN(è°ƒç”¨shutdown()) * On invocation of shutdown(), perhaps implicitly in finalize() * (RUNNING or SHUTDOWN) -\u0026gt; STOP(è°ƒç”¨shutdownNow()) * On invocation of shutdownNow() * SHUTDOWN -\u0026gt; TIDYING(queueå’Œpoolå‡empty) * When both queue and pool are empty * TIDYING -\u0026gt; TERMINATED(è°ƒç”¨terminated()) * When the terminated() hook method has completed */ private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0)); /** * task çš„é˜Ÿåˆ— */ private final BlockingQueue\u0026lt;Runnable\u0026gt; workQueue; /** * worker çº¿ç¨‹çš„ Set, åªæœ‰æŒæœ‰ mainlock æ—¶æ‰èƒ½è®¿é—® */ private final ReentrantLock mainLock = new ReentrantLock(); private final HashSet\u0026lt;Worker\u0026gt; workers = new HashSet\u0026lt;Worker\u0026gt;(); private final Condition termination = mainLock.newCondition(); private int largestPoolSize; private long completedTaskCount; private volatile ThreadFactory threadFactory; private volatile RejectedExecutionHandler handler; /** * idle çº¿ç¨‹waiting for workçš„è¶…æ—¶æ—¶é—´ */ private volatile long keepAliveTime; /** * å¦‚æœæ˜¯ false,core threadså°†ä¼šä¿æŒ alive å³ä½¿å¤„äº idel çŠ¶æ€ * å¦‚æœæ˜¯ true,core threadsä¼škeepAliveTimeä½œä¸ºè¶…æ—¶æ—¶é—´ wait for work */ private volatile boolean allowCoreThreadTimeOut; private volatile int corePoolSize; private volatile int maximumPoolSize; private static final RejectedExecutionHandler defaultHandler = new AbortPolicy(); } workerCount, runState ä½¿ç”¨ä¸€ä¸ª AtomicInteger è¿›è¡Œäº†å°è£…, runStateç”¨ int çš„é«˜3ä½æ ‡ä¹¦,ä½ä½è¡¨ç¤º workerCount, æ‰€ä»¥æˆ‘ä»¬èƒ½çœ‹åˆ° ThreadPoolExecutor ä¸­å’Œ ctl ç›¸å…³çš„å¸¸é‡å’Œè§£ææ–¹æ³•.\nprivate static final int COUNT_BITS = Integer.SIZE - 3; private static final int CAPACITY = (1 \u0026lt;\u0026lt; COUNT_BITS) - 1; // runState is stored in the high-order bits private static final int RUNNING = -1 \u0026lt;\u0026lt; COUNT_BITS; private static final int SHUTDOWN = 0 \u0026lt;\u0026lt; COUNT_BITS; private static final int STOP = 1 \u0026lt;\u0026lt; COUNT_BITS; private static final int TIDYING = 2 \u0026lt;\u0026lt; COUNT_BITS; private static final int TERMINATED = 3 \u0026lt;\u0026lt; COUNT_BITS; // Packing and unpacking ctl private static int runStateOf(int c) { return c \u0026amp; ~CAPACITY; } private static int workerCountOf(int c) { return c \u0026amp; CAPACITY; } private static int ctlOf(int rs, int wc) { return rs | wc; } ThreadPoolExecutor æœ€ä¸»è¦çš„æ„é€ å‡½æ•°,è®¾ç½®ä¸Šé¢è¯´çš„é‡è¦å±æ€§.\npublic ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue\u0026lt;Runnable\u0026gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) { if (corePoolSize \u0026lt; 0 || maximumPoolSize \u0026lt;= 0 || maximumPoolSize \u0026lt; corePoolSize || keepAliveTime \u0026lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler; } ç°åœ¨æ¥çœ‹ä¸€ä¸‹ execute() æ–¹æ³•, execute()æ–¹æ³•æœ‰3ä¸ªå¤„ç†æ­¥éª¤:\nçº¿ç¨‹æ•°å°äº corePoolSize æ—¶,åˆ™è¯•å›¾åˆ›å»ºä¸€ä¸ªæ–°çš„ worker çº¿ç¨‹ å¦‚æœä¸Šé¢ä¸€æ­¥å¤±è´¥äº†ï¼Œåˆ™è¯•å›¾å°†ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”è¦å†ä¸€æ¬¡åˆ¤æ–­éœ€è¦ä¸éœ€è¦å›æ»šé˜Ÿåˆ—ï¼Œæˆ–è€…è¯´åˆ›å»ºçº¿ç¨‹ å¦‚æœä¸Šé¢ä¸¤æ­¥éƒ½å¤±è´¥äº†ï¼Œåˆ™ä¼šè¯•å›¾å¼ºè¡Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œæ‰”æ‰è¿™ä¸ªä»»åŠ¡ public void execute(Runnable command) { if (command == null) throw new NullPointerException(); int c = ctl.get(); // 1.åˆ¤æ–­æœ‰æ•ˆçº¿ç¨‹æ•°æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•° if (workerCountOf(c) \u0026lt; corePoolSize) { //åˆ›å»ºæ–°çº¿ç¨‹ if (addWorker(command, true)) return; c = ctl.get(); } // 2.åˆ†å¼€æ¥çœ‹ï¼Œé¦–å…ˆåˆ¤æ–­å½“å‰çš„æ± å­æ˜¯å¦æ˜¯å¤„äº running çŠ¶æ€ // å› ä¸ºåªæœ‰ running çŠ¶æ€æ‰å¯ä»¥æ¥æ”¶æ–°ä»»åŠ¡ // æ¥ä¸‹æ¥åˆ¤æ–­èƒ½å¦æˆåŠŸæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†æˆ–è€…å…¶ä»–æƒ…å†µåˆ™ä¼šè·³åˆ°ä¸‹ä¸€æ­¥ if (isRunning(c) \u0026amp;\u0026amp; workQueue.offer(command)) { int recheck = ctl.get(); // å†æ¬¡æ£€æŸ¥æ± å­çš„çŠ¶æ€ï¼Œå¦‚æœè¿›å…¥äº†é running çŠ¶æ€ï¼Œå›æ»šé˜Ÿåˆ—ï¼Œæ‰”æ‰è¿™ä¸ªä»»åŠ¡ if (! isRunning(recheck) \u0026amp;\u0026amp; remove(command)) reject(command); //å¦‚æœå¤„äº running çŠ¶æ€åˆ™æ£€æŸ¥å½“å‰çš„æœ‰æ•ˆçº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ else if (workerCountOf(recheck) == 0) addWorker(null, false); } // 3.å‰ä¸¤æ­¥å¤±è´¥äº†ï¼Œå°±å¼ºè¡Œåˆ›å»ºçº¿ç¨‹ï¼ŒæˆåŠŸä¼šè¿”å›trueï¼Œå¦‚æœå¤±è´¥æ‰”æ‰è¿™ä¸ªä»»åŠ¡ else if (!addWorker(command, false)) reject(command); } è§£é‡Šä¸€ä¸‹ç¬¬äºŒæ­¥ï¼Œä¸ºä»€ä¹ˆè¦recheck\nå½“è¿™ä¸ªä»»åŠ¡è¢«æ·»åŠ åˆ°äº†é˜»å¡é˜Ÿåˆ—å‰ï¼Œæ± å­å¤„äº RUNNING çŠ¶æ€ï¼Œä½†å¦‚æœåœ¨æ·»åŠ åˆ°é˜Ÿåˆ—æˆåŠŸåï¼Œæ± å­è¿›å…¥äº† SHUTDOWN çŠ¶æ€æˆ–è€…å…¶ä»–çŠ¶æ€ï¼Œè¿™æ—¶å€™æ˜¯ä¸åº”è¯¥å†æ¥æ”¶æ–°çš„ä»»åŠ¡çš„ï¼Œæ‰€ä»¥éœ€è¦æŠŠè¿™ä¸ªä»»åŠ¡ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œå¹¶ä¸” reject\nåŒæ ·ï¼Œåœ¨æ²¡æœ‰æ·»åŠ åˆ°é˜Ÿåˆ—å‰ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªæœ‰æ•ˆçº¿ç¨‹ï¼Œä½†æ·»åŠ å®Œä»»åŠ¡åï¼Œè¿™ä¸ªçº¿ç¨‹é—²ç½®è¶…æ—¶æˆ–è€…å› ä¸ºå¼‚å¸¸è¢«å¹²æ‰äº†ï¼Œè¿™æ—¶å€™éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡\nä¸ºäº†æ›´ç›´è§‚çš„ç†è§£ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢è¿™å¼ å›¾\naddWorker() å‰ä¸€æ­¥æŠŠ execute çš„æµç¨‹æ‹äº†ä¸€éï¼Œé‡Œé¢å¤šæ¬¡å‡ºç°äº† addWorker() æ–¹æ³•ï¼Œå‰æ–‡è¯´åˆ°è¿™æ˜¯ä¸ªåˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•ï¼Œæ¥çœ‹çœ‹ addWorker åšäº†äº›ä»€ä¹ˆï¼Œè¿™ä¸ªæ–¹æ³•ä»£ç æ¯”è¾ƒé•¿ï¼Œæˆ‘ä»¬æ‹†å¼€æ¥ä¸€ç‚¹ä¸€ç‚¹çœ‹.\nç¬¬ä¸€éƒ¨åˆ† â€” åˆ¤æ–­å„ç§åŸºç¡€å¼‚å¸¸ private boolean addWorker(Runnable firstTask, boolean core) { retry: for (;;) { int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. // æ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ï¼Œé˜Ÿåˆ—çŠ¶æ€ï¼Œä»¥åŠ firstask ï¼Œæ‹†å¼€æ¥çœ‹ // è¿™æ®µä»£ç çœ‹èµ·æ¥å¼‚å¸¸çš„è›‹ç–¼,è½¬æ¢ä¸€ä¸‹é€»è¾‘å³ // rs\u0026gt;= SHUTDOWN \u0026amp;\u0026amp; (rs != SHUTDOWN || firstTask != null ||workQueue.isEmpty()) // æ€»ç»“èµ·æ¥å°±æ˜¯ å½“å‰å¤„äºé Running çŠ¶æ€,å¹¶ä¸”è¿™ä¸‰ç§æƒ…å†µ // 1. ä¸æ˜¯å¤„äº SHUTDOWN çŠ¶æ€ï¼Œä¸èƒ½å†åˆ›å»ºçº¿ç¨‹ // 2. æœ‰æ–°çš„ä»»åŠ¡ (å› ä¸ºä¸èƒ½å†æ¥æ”¶æ–°çš„ä»»åŠ¡) // 3. é˜»å¡é˜Ÿåˆ—ä¸­å·²ç»æ²¡æœ‰ä»»åŠ¡ (ä¸éœ€è¦å†åˆ›å»ºçº¿ç¨‹) if (rs \u0026gt;= SHUTDOWN \u0026amp;\u0026amp; ! (rs == SHUTDOWN \u0026amp;\u0026amp; firstTask == null \u0026amp;\u0026amp; ! workQueue.isEmpty())) return false; for (;;) { //å½“å‰æœ‰æ•ˆçº¿ç¨‹æ•°ç›® int wc = workerCountOf(c); // æ ¹æ®ä¼ å…¥çš„å‚æ•°ç¡®å®šä»¥æ ¸å¿ƒçº¿ç¨‹æ•°è¿˜æ˜¯æœ€å¤§çº¿ç¨‹æ•°ä½œä¸ºåˆ¤æ–­æ¡ä»¶ if (wc \u0026gt;= CAPACITY || wc \u0026gt;= (core ? corePoolSize : maximumPoolSize)) // å¤§äºå®¹é‡ æˆ–è€…æŒ‡å®šçš„çº¿ç¨‹æ•°ï¼Œä¸å…è®¸åˆ›å»º return false; if (compareAndIncrementWorkerCount(c)) break retry; c = ctl.get(); // Re-read ctl if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop } } } ç¬¬äºŒéƒ¨åˆ† â€” è¯•å›¾åˆ›å»ºçº¿ç¨‹ åˆ›å»ºä¸€ä¸ªWorker\nboolean workerStarted = false; //æ ‡è®° worker å¼€å¯çŠ¶æ€ boolean workerAdded = false; //æ ‡è®° worker æ·»åŠ çŠ¶æ€ Worker w = null; try { w = new Worker(firstTask); //å°†è¿™ä¸ªä»»åŠ¡ä½œä¸º worker çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ä¼ å…¥ final Thread t = w.thread; //é€šè¿‡ worker è·å–åˆ°ä¸€ä¸ªçº¿ç¨‹ if (t != null) { final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try { // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. int rs = runStateOf(ctl.get()); // runningçŠ¶æ€ï¼Œæˆ–è€… shutdown çŠ¶æ€ä½†æ˜¯æ²¡æœ‰æ–°çš„ä»»åŠ¡ if (rs \u0026lt; SHUTDOWN || (rs == SHUTDOWN \u0026amp;\u0026amp; firstTask == null)) { if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); // å°†è¿™ä¸ª worker æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ workers.add(w); int s = workers.size(); if (s \u0026gt; largestPoolSize) largestPoolSize = s; // æ ‡è®°workeræ·»åŠ æˆåŠŸ workerAdded = true; } } finally { mainLock.unlock(); } // å¦‚æœ worker åˆ›å»ºæˆåŠŸï¼Œå¼€å¯çº¿ç¨‹ if (workerAdded) { t.start(); workerStarted = true; } } } finally { if (! workerStarted) addWorkerFailed(w); } return workerStarted; ä¸Šé¢ä»£ç ä»é€»è¾‘å±‚é¢æ¥çœ‹ä¸ç®—éš¾æ‡‚ï¼Œåˆ°è¿™é‡Œä¸€ä¸ªä»»åŠ¡åˆ°è¾¾åï¼ŒThreadPoolExecutor çš„å¤„ç†å°±ç»“æŸäº†ï¼Œé‚£ä¹ˆä»»åŠ¡åˆæ˜¯æ€ä¹ˆè¢«æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹æ˜¯å¦‚ä½•ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ï¼Œä¸Šæ–‡ä¸­çš„ Worker åˆæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ\nä¸€ä¸ªä¸€ä¸ªæ¥ï¼Œå…ˆæ¥çœ‹çœ‹ Worker åˆ°åº•æ˜¯ä»€ä¹ˆ.\nWorker Worker æ˜¯ ThreadPoolExecutor çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ç°äº† Runnable æ¥å£ï¼Œç»§æ‰¿è‡ª AbstractQueuedSynchronizer,è¿™åˆæ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿï¼Ÿ? è¿™ä¸ªå°±æ˜¯ç»å¸¸è§åˆ°çš„ AQS çš„å…¨ç§°,è¿™ä¸ªæš‚æ—¶è¿˜æ²¡æœ‰ç ”ç©¶.~~~~\nprivate final class Worker extends AbstractQueuedSynchronizer implements Runnable { final Thread thread; /** Initial task to run. Possibly null. */ Runnable firstTask; /** Per-thread task counter */ volatile long completedTasks; } ç®€å•æ¥è¯´ï¼ŒWorkerå®ç°äº† lock å’Œ unLock æ–¹æ³•æ¥æ ‡ç¤ºå½“å‰çº¿ç¨‹çš„çŠ¶æ€æ˜¯å¦ä¸ºé—²ç½®\n// Lock methods // // The value 0 represents the unlocked state. // The value 1 represents the locked state. public void lock() { acquire(1); } public boolean tryLock() { return tryAcquire(1); } public void unlock() { release(1); } public boolean isLocked() { return isHeldExclusively(); } ä¸Šä¸€èŠ‚åˆ›å»ºçº¿ç¨‹æˆåŠŸåè°ƒç”¨ t.start() è€Œè¿™ä¸ªçº¿ç¨‹åˆæ˜¯ Worker çš„æˆå‘˜å˜é‡\nWorker(Runnable firstTask) { setState(-1); // inhibit interrupts until runWorker this.firstTask = firstTask; this.thread = getThreadFactory().newThread(this); } å¯ä»¥çœ‹åˆ°è¿™é‡Œå°† Worker ä½œä¸º Runnable å‚æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“ Thread æ¥æ”¶ä¸€ä¸ª Runnable å¯¹è±¡å start è¿è¡Œçš„æ˜¯ Runnable çš„ run æ–¹æ³•ï¼ŒWorker çš„ run æ–¹æ³•è°ƒç”¨äº† runWorker ,è¿™ä¸ªæ–¹æ³•é‡Œé¢å°±æ˜¯å–å‡ºä»»åŠ¡æ‰§è¡Œçš„é€»è¾‘\npublic void run() { runWorker(this); } final void runWorker(Worker w) { Thread wt = Thread.currentThread(); Runnable task = w.firstTask; // è·å–åˆ° worker çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ w.firstTask = null; w.unlock(); // æ ‡è®°ä¸ºé—²ç½®ï¼Œè¿˜æ²¡æœ‰å¼€å§‹ä»»åŠ¡ å…è®¸æ‰“æ–­ boolean completedAbruptly = true; // å¼‚å¸¸é€€å‡ºæ ‡è®° try { // å¾ªç¯å–å‡ºä»»åŠ¡ï¼Œå¦‚æœç¬¬ä¸€ä¸ªä»»åŠ¡ä¸ä¸ºç©ºï¼Œæˆ–è€…ä»é˜Ÿåˆ—ä¸­æ‹¿åˆ°äº†ä»»åŠ¡ // åªè¦è¿™ä¸¤ä¸ªæ¡ä»¶æ»¡è¶³ï¼Œä¼šä¸€ç›´å¾ªç¯ï¼Œç›´åˆ°æ²¡æœ‰ä»»åŠ¡ï¼Œæ­£å¸¸é€€å‡ºï¼Œæˆ–è€…å¼‚å¸¸é€€å‡º while (task != null || (task = getTask()) != null) { w.lock();// è¯¥çº¿ç¨‹æ ‡è®°ä¸ºéé—²ç½® // If pool is stopping, ensure thread is interrupted; // if not, ensure thread is not interrupted. This // requires a recheck in second case to deal with // shutdownNow race while clearing interrupt // ç¿»è¯‘æ³¨é‡Šï¼š1.å¦‚æœçº¿ç¨‹æ± STOPPINGçŠ¶æ€ï¼Œéœ€è¦ä¸­æ–­çº¿ç¨‹ // 2.Thread.interrupted()æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œè¿”å›å½“å‰çº¿ç¨‹æ˜¯å¦æœ‰è¢«ç­‰å¾…ä¸­æ–­çš„è¯·æ±‚ // 3.ç¬¬äºŒä¸ªæ¡ä»¶æˆç«‹æ—¶ï¼Œæ£€æŸ¥çº¿ç¨‹æ± çŠ¶æ€ï¼Œå¦‚æœä¸ºSTOPï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ä¸­æ–­ï¼Œåˆ™ä¸­æ–­çº¿ç¨‹ if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() \u0026amp;\u0026amp; runStateAtLeast(ctl.get(), STOP))) \u0026amp;\u0026amp; !wt.isInterrupted()) wt.interrupt(); // æ‰§è¡Œä»»åŠ¡ try { beforeExecute(wt, task);// æ‰§è¡Œå‰ Throwable thrown = null; try { task.run(); // æ‰§è¡Œä»»åŠ¡ } catch (RuntimeException x) { thrown = x; throw x; } catch (Error x) { thrown = x; throw x; } catch (Throwable x) { thrown = x; throw new Error(x); } finally { afterExecute(task, thrown); // æ‰§è¡Œç»“æŸ } } finally { task = null; // å°† worker çš„ä»»åŠ¡ç½®ç©º w.completedTasks++; w.unlock(); // é‡Šæ”¾é”ï¼Œè¿›å…¥é—²ç½®çŠ¶æ€ } }// å¾ªç¯ç»“æŸ completedAbruptly = false; // æ ‡è®°ä¸ºæ­£å¸¸é€€å‡º } finally { // å¹²æ‰ worker processWorkerExit(w, completedAbruptly); } } è¿™é‡Œå¼„æ¸…æ¥šäº†ä¸€ä»¶äº‹æƒ…ï¼Œè¿›å…¥å¾ªç¯å‡†å¤‡æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œworker åŠ é”æ ‡è®°ä¸ºéé—²ç½®ï¼Œä»»åŠ¡æ‰§è¡Œå®Œæ¯•æˆ–è€…å‡ºç°å¼‚å¸¸ï¼Œworker é‡Šæ”¾é”ï¼Œè¿›å…¥é—²ç½®çŠ¶æ€ã€‚\nä¹Ÿå°±æ˜¯å½“ä¸€ä¸ª worker æ‰§è¡Œä»»åŠ¡å‰æˆ–è€…æ‰§è¡Œå®Œä»»åŠ¡ï¼Œåˆ°å–å‡ºä¸‹ä¸€ä¸ªä»»åŠ¡æœŸé—´ï¼Œéƒ½æ˜¯é—²ç½®çŠ¶æ€å¯ä»¥è¢«æ‰“æ–­\nä¸Šé¢å–å‡ºä»»åŠ¡è°ƒç”¨äº† getTask() ï¼Œè¯¶ï½ä¸ºä»€ä¹ˆæœ‰ä¸€ä¸ªæ­»å¾ªç¯ï¼Œåˆ«ç€æ€¥ï¼Œæ…¢æ…¢çœ‹æ¥ã€‚ä¸Šé¢çš„ä»£ç å¯ä»¥çŸ¥é“å¦‚æœ getTask è¿”å›ä»»åŠ¡åˆ™æ‰§è¡Œï¼Œå¦‚æœè¿”å›ä¸º null åˆ™ worker éœ€è¦è¢«å›æ”¶\nprivate Runnable getTask() { // æ ‡è®°å–ä»»åŠ¡æ˜¯å¦è¶…æ—¶ boolean timedOut = false; // Did the last poll() time out? for (;;) { int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. // å¦‚æœçº¿ç¨‹æ± çŠ¶æ€ä¸º STOP æˆ–è€… SHUTDOWN å¹¶ä¸”é˜Ÿåˆ—å·²ç»ä¸ºç©ºï¼Œå›æ”¶ wroker if (rs \u0026gt;= SHUTDOWN \u0026amp;\u0026amp; (rs \u0026gt;= STOP || workQueue.isEmpty())) { decrementWorkerCount(); return null; } //è·å–å½“å‰æœ‰æ•ˆçº¿ç¨‹æ•° int wc = workerCountOf(c); // Are workers subject to culling? // timed ç”¨æ¥æ ‡è®°å½“å‰çš„ worker æ˜¯å¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œ // è¿˜è®°å¾—è·å–çº¿ç¨‹æ± çš„æ—¶å€™ å¯ä»¥è®¾ç½®æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶æ—¶é—´ //1.å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶å›æ”¶(å³æ‰€æœ‰çº¿ç¨‹) 2.å½“å‰æœ‰æ•ˆçº¿ç¨‹è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°(éœ€è¦å›æ”¶) // å¦‚æœtimed == false åˆ™è¯¥workerä¸ä¼šè¢«å›æ”¶ï¼Œå¦‚æœæ²¡æœ‰å–åˆ°ä»»åŠ¡ ä¼šä¸€ç›´é˜»å¡ boolean timed = allowCoreThreadTimeOut || wc \u0026gt; corePoolSize; // å›æ”¶çº¿ç¨‹æ¡ä»¶ // 1. æœ‰æ•ˆçº¿ç¨‹æ•°å·²ç»å¤§äºäº†çº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°æˆ–è€…è®¾ç½®äº†è¶…æ—¶å›æ”¶å¹¶ä¸”å·²ç»è¶…æ—¶ // 2. æœ‰æ•ˆçº¿ç¨‹æ•°å¤§äº1æˆ–è€…é˜Ÿåˆ—ä»»åŠ¡å·²ç»ä¸ºç©º // åªæœ‰å½“ä¸Šé¢1å’Œ2 åŒæ—¶æ»¡è¶³æ—¶ åˆ™è¯•å›¾å›æ”¶çº¿ç¨‹ if ((wc \u0026gt; maximumPoolSize || (timed \u0026amp;\u0026amp; timedOut)) \u0026amp;\u0026amp; (wc \u0026gt; 1 || workQueue.isEmpty())) { // å¦‚æœå‡å°‘workercountæˆåŠŸ ç›´æ¥å›æ”¶ if (compareAndDecrementWorkerCount(c)) return null; // å¦åˆ™é‡èµ°å¾ªç¯ï¼Œä»ç¬¬ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶å¤„å›æ”¶ continue; } // å–ä»»åŠ¡ try { // æ ¹æ®æ˜¯å¦è®¾ç½®è¶…æ—¶å›æ”¶æ¥é€‰æ‹©ä¸åŒçš„å–ä»»åŠ¡çš„æ–¹å¼ // poll æ–¹æ³•å–ä»»åŠ¡ä¼šæœ‰è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´åˆ™è¿”å›null // take æ–¹æ³•æ²¡æœ‰è¶…æ—¶æ—¶é—´ï¼Œé˜»å¡å¼æ–¹æ³• Runnable r = timed ? workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take(); // å¦‚æœä»»åŠ¡ä¸ä¸ºç©ºè¿”å›ä»»åŠ¡ if (r != null) return r; // å¦åˆ™æ ‡è®°è¶…æ—¶ è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ç­‰å¾…å›æ”¶ timedOut = true; } catch (InterruptedException retry) { // å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œè¯•å›¾é‡è¯• timedOut = false; } } } getTask() æ–¹æ³•é€»è¾‘ä¹Ÿæ‹å¾—å·®ä¸å¤šäº†ï¼Œè¿™é‡Œåˆå‡ºç°äº†ä¸¤ä¸ªæ–°çš„æ–¹æ³•ï¼ŒworkQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) å’Œ workQueue.take() ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯é˜»å¡é˜Ÿåˆ—çš„æ–¹æ³•ï¼Œæ¥çœ‹çœ‹å®ƒä»¬åˆå„è‡ªæ˜¯æ€ä¹ˆå®ç°çš„\nLinkedBlockingQueue â€” é˜»å¡é˜Ÿåˆ— ThreadPoolExecutor ä½¿ç”¨çš„æ˜¯é“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œå®ç°äº† BlockingQueue æ¥å£ï¼Œè€Œ BlockingQueue åˆ™æ˜¯ç»§æ‰¿è‡ª Queue æ¥å£ï¼Œå†ä¸Šå±‚å°±æ˜¯ Collection æ¥å£ã€‚\nå› ä¸ºæœ¬ç¯‡ç¬”è®°ä¸»è¦æ˜¯åˆ†æ ThreadPoolExecutor çš„åŸç†ï¼Œæ‰€ä»¥ä¸ä¼šè¯¦ç»†ä»‹ç» LinkedBlockingQueue ä¸­çš„å…¶å®ƒä»£ç ï¼Œä¸»è¦ä»‹ç»è¿™é‡Œæ‰€ç”¨çš„æ–¹æ³•ï¼Œé¦–å…ˆæ¥çœ‹ä¸€ä¸‹ä¸Šæ–‡æ‰€æåˆ°çš„ take()\npublic E take() throws InterruptedException { E x; // ä»»åŠ¡ int c = -1; // å–å‡ºä»»åŠ¡åçš„å‰©ä½™ä»»åŠ¡æ•°é‡ final AtomicInteger count = this.count; // å½“å‰ä»»åŠ¡æ•°é‡ final ReentrantLock takeLock = this.takeLock; // åŠ é”é˜²æ­¢å¹¶å‘ takeLock.lockInterruptibly(); try { // å¦‚æœé˜Ÿåˆ—æ•°é‡ä¸ºç©ºï¼Œåˆ™ä¸€ç›´å¾ªç¯ï¼Œé˜»å¡çº¿ç¨‹ while (count.get() == 0) { notEmpty.await(); } // å–å‡ºä»»åŠ¡ x = dequeue(); // ä»»åŠ¡æ•°é‡å‡ä¸€ c = count.getAndDecrement(); if (c \u0026gt; 1) notEmpty.signal();// æ ‡è®°é˜Ÿåˆ—éç©º } finally { takeLock.unlock(); // é‡Šæ”¾é” } if (c == capacity) signalNotFull();//æ ‡è®°é˜Ÿåˆ—å·²æ»¡ return x;// è¿”å›ä»»åŠ¡ } ä¸Šé¢çš„ä»£ç å¯ä»¥çŸ¥é“ take æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ç›´åˆ°é˜Ÿåˆ—æœ‰æ–°çš„ä»»åŠ¡ä¸ºæ­¢\næ¥ä¸‹æ¥æ˜¯ poll æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å‡ ä¹ä¸ take æ–¹æ³•ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åœ¨é˜»å¡çš„å¾ªç¯ä»£ç å—é‡Œé¢åŠ äº†æ—¶é—´åˆ¤æ–­ï¼Œå¦‚æœè¶…æ—¶åˆ™ç›´æ¥è¿”å›ä¸ºç©ºï¼Œä¸ä¼šä¸€ç›´é˜»å¡ä¸‹å»\npublic E poll(long timeout, TimeUnit unit) throws InterruptedException { E x = null; // å­˜æ”¾çš„ä»»åŠ¡ int c = -1; long nanos = unit.toNanos(timeout); // è¶…æ—¶æ—¶é—´ final AtomicInteger count = this.count; // é˜Ÿåˆ—ä¸­çš„æ•°é‡ final ReentrantLock takeLock = this.takeLock; // åŠ é”é˜²æ­¢å¹¶å‘ takeLock.lockInterruptibly(); try { // å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ä¸æ–­çš„å¾ªç¯ while (count.get() == 0) { // å¦‚æœå½“å€’è®¡æ—¶å°äº0 å³è¶…æ—¶æ—¶é—´åˆ° åˆ™è¿”å›ç©º if (nanos \u0026lt;= 0) return null; // è®©çº¿ç¨‹ç­‰å¾… nanos = notEmpty.awaitNanos(nanos); } x = dequeue(); // å–å‡ºä¸€ä¸ªä»»åŠ¡ c = count.getAndDecrement(); // å–å‡ºåçš„é˜Ÿåˆ—æ•°é‡ if (c \u0026gt; 1) notEmpty.signal(); // æ ‡è®°éç©º } finally { takeLock.unlock(); // é‡Šæ”¾é” } if (c == capacity) signalNotFull(); // æ ‡è®°é˜Ÿåˆ—å·²æ»¡ return x; // è¿”å›ä»»åŠ¡ } çº¿ç¨‹æ± çš„å›æ”¶åŠç»ˆæ­¢ å‰ä¸€èŠ‚åˆ†æäº†ä»»åŠ¡çš„æ‰§è¡Œæµç¨‹åŠåŸç†ï¼Œä¹Ÿç•™ä¸‹äº†ä¸€ä¸ªé—®é¢˜ï¼Œworker æ˜¯å¦‚ä½•è¢«å›æ”¶çš„å‘¢ï¼Ÿçº¿ç¨‹æ± è¯¥å¦‚ä½•ç®¡ç†å‘¢ï¼Ÿå›åˆ°ä¸Šä¸€èŠ‚çš„ runWorker() æ–¹æ³•ä¸­ï¼Œè¿˜è®°å¾—æœ€åè°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•\nprocessWorkerExit(w, completedAbruptly); è¿™ä¸ªæ–¹æ³•ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å½“å‰çš„ Woker ,ç¬¬äºŒä¸ªæ˜¯æ ‡è®°å¼‚å¸¸é€€å‡ºçš„æ ‡è¯†\né¦–å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºå¼‚å¸¸é€€å‡ºï¼Œå¦‚æœæ˜¯å¼‚å¸¸é€€å‡ºçš„è¯éœ€è¦æ‰‹åŠ¨è°ƒæ•´çº¿ç¨‹æ•°é‡ï¼Œå¦‚æœæ˜¯æ­£å¸¸å›æ”¶çš„ï¼ŒgetTask æ–¹æ³•é‡Œé¢å·²ç»æ‰‹åŠ¨è°ƒæ•´è¿‡äº†ï¼Œä¸è®°å¾—çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹å‰æ–‡çš„ä»£ç ï¼Œæ‰¾æ‰¾ decrementWorkerCount(),\nprivate void processWorkerExit(Worker w, boolean completedAbruptly) { if (completedAbruptly) // If abrupt, then workerCount wasn\u0026#39;t adjusted decrementWorkerCount(); // åŠ é” final ReentrantLock mainLock = this.mainLock; mainLock.lock(); // è®°å½•çº¿ç¨‹æ± å®Œæˆçš„ä»»åŠ¡æ€»æ•°ï¼Œä» workers ä¸­ç§»é™¤è¯¥ worker try { completedTaskCount += w.completedTasks; workers.remove(w); } finally { mainLock.unlock(); } tryTerminate(); // å°è¯•å…³é—­æ± å­ int c = ctl.get(); // ä»¥ä¸‹çš„ä»£ç æ˜¯åˆ¤æ–­éœ€ä¸éœ€è¦ç»™çº¿ç¨‹æ± åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ // å¦‚æœçº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯ RUNNING æˆ–è€… SHUTDOWN è¿›ä¸€æ­¥åˆ¤æ–­éœ€ä¸éœ€è¦åˆ›å»º if (runStateLessThan(c, STOP)) { // å¦‚æœä¸ºå¼‚å¸¸é€€å‡ºç›´æ¥åˆ›å»ºï¼Œå¦‚æœä¸æ˜¯å¼‚å¸¸é€€å‡ºè¿›å…¥åˆ¤æ–­ if (!completedAbruptly) { // è·å–çº¿ç¨‹æ± åº”è¯¥å­˜åœ¨çš„æœ€å°çº¿ç¨‹æ•° å¦‚æœè®¾ç½®äº†è¶…æ—¶ åˆ™æ˜¯0ï¼Œå¦åˆ™æ˜¯æ ¸å¿ƒçº¿ç¨‹æ•° int min = allowCoreThreadTimeOut ? 0 : corePoolSize; // å¦‚æœ min æ˜¯0 ä½†æ˜¯é˜Ÿåˆ—åˆä¸ä¸ºç©ºï¼Œåˆ™ min åº”è¯¥æ˜¯1 if (min == 0 \u0026amp;\u0026amp; ! workQueue.isEmpty()) min = 1; //å¦‚æœå½“å‰æ± ä¸­çš„æœ‰æ•ˆçº¿ç¨‹æ•°å¤§äºç­‰äºæœ€å°çº¿ç¨‹æ•° åˆ™ä¸éœ€è¦åˆ›å»º if (workerCountOf(c) \u0026gt;= min) return; // replacement not needed } // åˆ›å»ºçº¿ç¨‹ addWorker(null, false); } } ä¸Šé¢çš„ä»£ç ä¸­è°ƒç”¨äº† tryTerminate() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºç»ˆæ­¢çº¿ç¨‹æ± çš„ï¼Œåˆæ˜¯ä¸€ä¸ª for å¾ªç¯ï¼Œä»ä»£ç ç»“æ„æ¥çœ‹æ˜¯å¼‚å¸¸æƒ…å†µçš„é‡è¯•æœºåˆ¶ã€‚è¿˜æ˜¯è€æ–¹æ³•ï¼Œæ…¢æ…¢æ¥çœ‹æ€»å…±åšäº†å‡ ä»¶äº‹æƒ…\nfinal void tryTerminate() { for (;;) { int c = ctl.get(); // å¦‚æœå¤„äºè¿™ä¸‰ç§æƒ…å†µä¸éœ€è¦å…³é—­çº¿ç¨‹æ±  // 1. Running çŠ¶æ€ // 2. SHUTDOWN çŠ¶æ€å¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¸èƒ½ç»ˆæ­¢ // 3. TIDYING æˆ–è€… TERMINATE çŠ¶æ€ï¼Œè¯´æ˜å·²ç»åœ¨å…³é—­äº† ä¸éœ€è¦é‡å¤å…³é—­ if (isRunning(c) || runStateAtLeast(c, TIDYING) || (runStateOf(c) == SHUTDOWN \u0026amp;\u0026amp; ! workQueue.isEmpty())) return; // è¿›å…¥åˆ°å…³é—­çº¿ç¨‹æ± çš„ä»£ç ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­è¿˜æœ‰çº¿ç¨‹ï¼Œåˆ™éœ€è¦æ‰“æ–­çº¿ç¨‹ if (workerCountOf(c) != 0) { // Eligible to terminate å¯ä»¥å…³é—­æ± å­ // æ‰“æ–­é—²ç½®çº¿ç¨‹ï¼Œåªæ‰“æ–­ä¸€ä¸ª interruptIdleWorkers(ONLY_ONE); return; // å¦‚æœæœ‰ä¸¤ä¸ªä»¥ä¸Šæ€ä¹ˆåŠï¼Ÿåªæ‰“æ–­ä¸€ä¸ªï¼Ÿ // è¿™é‡Œåªæ‰“æ–­ä¸€ä¸ªæ˜¯å› ä¸º worker å›æ”¶çš„æ—¶å€™éƒ½ä¼šè¿›å…¥åˆ°è¯¥æ–¹æ³•ä¸­æ¥ï¼Œå¯ä»¥å›å»å†çœ‹çœ‹ // runWorkeræ–¹æ³•æœ€åçš„ä»£ç  } // çº¿ç¨‹å·²ç»å›æ”¶å®Œæ¯•ï¼Œå‡†å¤‡å…³é—­çº¿ç¨‹æ±  final ReentrantLock mainLock = this.mainLock; mainLock.lock();// åŠ é” try { // å°†çŠ¶æ€æ”¹å˜ä¸º TIDYING å¹¶ä¸”å³å°†è°ƒç”¨ terminated if (ctl.compareAndSet(c, ctlOf(TIDYING, 0))) { try { terminated(); // ç»ˆæ­¢çº¿ç¨‹æ±  } finally { ctl.set(ctlOf(TERMINATED, 0)); // æ”¹å˜çŠ¶æ€ termination.signalAll(); } return; } } finally { mainLock.unlock(); // å¦‚æœç»ˆæ­¢å¤±è´¥ä¼šé‡è¯• } // else retry on failed CAS } } å°è¯•ç»ˆæ­¢çº¿ç¨‹æ± çš„ä»£ç åˆ†æå®Œäº†ï¼Œå¥½åƒå°±ç»“æŸäº†ï½ä½†ä½œä¸ºå¥½å¥‡å®å®ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯åº”è¯¥çœ‹çœ‹å¦‚ä½•æ‰“æ–­é—²ç½®çº¿ç¨‹ï¼Œä»¥åŠ terminated ä¸­åšäº†ä»€ä¹ˆå‘¢ï¼Ÿæ¥å§ï¼Œç»§ç»­è£…é€¼\nå…ˆæ¥çœ‹æ‰“æ–­çº¿ç¨‹\nprivate void interruptIdleWorkers(boolean onlyOne) { final ReentrantLock mainLock = this.mainLock; mainLock.lock();//åŠ é”ï½ try { // éå†çº¿ç¨‹æ± ä¸­çš„ wroker for (Worker w : workers) { Thread t = w.thread; // å¦‚æœçº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­ï¼Œå¹¶ä¸”èƒ½å¤Ÿè·å–åˆ° workerçš„é”(è¯´æ˜æ˜¯é—²ç½®çº¿ç¨‹) if (!t.isInterrupted() \u0026amp;\u0026amp; w.tryLock()) { try { t.interrupt();// ä¸­æ–­çº¿ç¨‹ } catch (SecurityException ignore) { } finally { w.unlock(); } } // åªä¸­æ–­ä¸€ä¸ª worker è·³å‡ºå¾ªç¯ï¼Œå¦åˆ™ä¼šå°†æ‰€æœ‰çš„é—²ç½®çº¿ç¨‹éƒ½ä¸­æ–­ if (onlyOne) break; } } finally { mainLock.unlock();// é‡Šæ”¾é” } æœ‰åŒå­¦å¼€å§‹è£…é€¼äº†ï¼Œè¯´æˆ‘ä»¬æ˜¯å¥½å¥‡å®å®ï¼Œt.interrupt() æ–¹æ³•ä¹Ÿåº”è¯¥çœ‹ï¼Œå—¯ï½æ²¡é”™ï¼Œä½†è¿™é‡Œæ˜¯è°ƒç”¨äº† native æ–¹æ³•ï¼Œä¼š c çš„å¯ä»¥å»çœ‹çœ‹è£…é€¼ï¼Œæˆ‘å°±ç®—äº†ï½\nå¥½äº†ï¼Œå†æ¥çœ‹çœ‹ terminate, æ˜¯ä¸æ˜¯å¾ˆå‘çˆ¹ï¼Ÿ terminated é‡Œé¢ç¥ï¼é©¬ï¼ä¹Ÿï¼æ²¡ï¼å¹²ï¼ã€‚ã€‚ã€‚æ·¡å®šï¼Œå…¶å®è¿™ä¸ªæ–¹æ³•ç±»ä¼¼äº Activity çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå…è®¸ä½ åœ¨è¢«ç»ˆæ­¢æ—¶åšä¸€äº›äº‹æƒ…ï¼Œé»˜è®¤çš„çº¿ç¨‹æ± æ²¡æœ‰ä»€ä¹ˆè¦åšçš„äº‹æƒ…ï¼Œå½“ç„¶ä»€ä¹ˆä¹Ÿæ²¡å†™å•¦ï½\n/** * Method invoked when the Executor has terminated. Default * implementation does nothing. Note: To properly nest multiple * overridings, subclasses should generally invoke * {@code super.terminated} within this method. */ protected void terminated() { } å¼‚å¸¸å¤„ç† è¿˜è®°å¾—å‰é¢è®²åˆ°ï¼Œå‡ºç°å„ç§å¼‚å¸¸æƒ…å†µï¼Œæ·»åŠ é˜Ÿåˆ—å¤±è´¥ç­‰ç­‰ï¼Œåªæ˜¯ç¬¼ç»Ÿçš„è¯´äº†ä¸€å¥æ‰”æ‰ï¼Œå½“ç„¶ä»£ç å®ç°ä¸å¯èƒ½æ˜¯ç®€å•ä¸€å¥æ‰”æ‰å°±å®Œäº†ã€‚å›åˆ° execute() æ–¹æ³•ä¸­æ‰¾åˆ° reject() ä»»åŠ¡ï¼Œçœ‹çœ‹ç©¶ç«Ÿæ˜¯æ€ä¹ˆå¤„ç†çš„\nfinal void reject(Runnable command) { handler.rejectedExecution(command, this); } è¿˜è®°å¾—åœ¨åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œåˆå§‹åŒ–äº†ä¸€ä¸ª handler â€” RejectedExecutionHandler\nè¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•,æ¥æ”¶ä¸¤ä¸ªå‚æ•°\nvoid rejectedExecution(Runnable r, ThreadPoolExecutor executor); æ—¢ç„¶æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆè‚¯å®šæœ‰ä»–çš„å®ç°ç±»ï¼Œæˆ‘ä»¬å…ˆä¸æ€¥ç€çœ‹æ‰€æœ‰å®ç°ç±»ï¼Œå…ˆæ¥çœ‹çœ‹è¿™é‡Œçš„ handler å¯èƒ½æ˜¯ä»€ä¹ˆï¼Œè®°å¾—åœ¨ä½¿ç”¨ Executors è·å–çº¿ç¨‹æ± è°ƒç”¨æ„é€ æ–¹æ³•çš„æ—¶å€™å¹¶æ²¡æœ‰ä¼ å…¥ handler å‚æ•°ï¼Œé‚£ä¹ˆ ThreadPoolExecutor åº”è¯¥ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ handler\nprivate static final RejectedExecutionHandler defaultHandler = new AbortPolicy(); public static class AbortPolicy implements RejectedExecutionHandler { public AbortPolicy() { } public void rejectedExecution(Runnable r, ThreadPoolExecutor e) { throw new RejectedExecutionException(\u0026#34;Task \u0026#34; + r.toString() + \u0026#34; rejected from \u0026#34; + e.toString()); } } é»˜è®¤ handler æ˜¯ AbortPolicy ,è¿™ä¸ªç±»å®ç°äº† rejectedExecution() æ–¹æ³•ï¼ŒæŠ›äº†ä¸€ä¸ª Runtime å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä»»åŠ¡æ·»åŠ å¤±è´¥ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¸ªç±»åœ¨ AsyncTask å¼•å‘äº†ä¸€åœºè¡€æ¡ˆï½æ‰€ä»¥åœ¨ API19 ä»¥åä¿®æ”¹äº† AsyncTask çš„éƒ¨åˆ†ä»£ç é€»è¾‘ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´å•¦.\nå®é™…ä¸Šï¼Œåœ¨ ThreadPoolExecutor ä¸­é™¤äº† AbortPolicy å¤–è¿˜å®ç°äº†ä¸‰ç§ä¸åŒç±»å‹çš„ handler\nCallerRunsPolicy â€” åœ¨ çº¿ç¨‹æ± æ²¡æœ‰ shutdown çš„å‰æä¸‹ï¼Œä¼šç›´æ¥åœ¨æ‰§è¡Œ execute æ–¹æ³•çš„çº¿ç¨‹é‡Œæ‰§è¡Œè¿™ä¸ªä»»åŠ¡ public void rejectedExecution(Runnable r, ThreadPoolExecutor e) { if (!e.isShutdown()) { r.run(); } } DiscardPolicy â€” å•¥ä¹Ÿä¸å¹²ï¼Œé»˜é»˜åœ°ä¸¢æ‰ä»»åŠ¡ï½ä¸ä¿¡ä½ çœ‹ public void rejectedExecution(Runnable r, ThreadPoolExecutor e) { } DiscardOldestPolicy â€” ä¸¢å¼ƒæ‰é˜Ÿåˆ—ä¸­æœªæ‰§è¡Œçš„ï¼Œæœ€è€çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡é˜Ÿåˆ—æ’å¤´çš„ä»»åŠ¡ï¼Œç„¶åå†è¯•å›¾åœ¨æ‰§è¡Œä¸€æ¬¡ public void rejectedExecution(Runnable r, ThreadPoolExecutor e) { if (!e.isShutdown()) { e.getQueue().poll(); e.execute(r); } } ","permalink":"https://carlos19960601.github.io/posts/java%E7%BA%BF%E7%A8%8B%E6%B1%A0/","summary":"\u003ch4 id=\"çº¿ç¨‹æ± æ˜¯ä»€ä¹ˆ\"\u003eçº¿ç¨‹æ± æ˜¯ä»€ä¹ˆï¼Ÿ\u003c/h4\u003e\n\u003cp\u003eçº¿ç¨‹æ± ç”¨äºå¤šçº¿ç¨‹å¤„ç†ä¸­ï¼Œå®ƒå¯ä»¥æ ¹æ®ç³»ç»Ÿçš„æƒ…å†µï¼Œå¯ä»¥æœ‰æ•ˆæ§åˆ¶çº¿ç¨‹æ‰§è¡Œçš„æ•°é‡ï¼Œä¼˜åŒ–è¿è¡Œæ•ˆæœã€‚çº¿ç¨‹æ± åšçš„å·¥ä½œä¸»è¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹çš„æ•°é‡ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡è¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™ï¼Œç­‰å…¶å®ƒçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚\u003c/p\u003e","title":"Javaçº¿ç¨‹æ± "},{"content":"å‰è¨€ ä¹‹å‰å­¦ä¹ JVMåƒåœ¾å›æ”¶æ—¶ï¼Œä¸»è¦æ˜¯è¿‡äº†ä¸€éåƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ¯”å¦‚å¤åˆ¶ç®—æ³•ï¼Œæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å¢åŠ åˆ†ä»£ï¼Œæ¯ä»£é‡‡å–ä¸åŒçš„å›æ”¶ç®—æ³•ï¼Œä»¥æé«˜æ•´ä½“çš„åˆ†é…å’Œå›æ”¶æ•ˆç‡ã€‚ç„¶åè¿‡äº†ä¸€éJVMä¸­çš„åƒåœ¾æ”¶é›†å™¨ï¼Œæ¯”å¦‚Serialã€Parallel Scavengeã€Parallel Newã€CMSã€G1ç­‰ã€‚\nè‡ªè®¤ä¸ºåƒåœ¾æ”¶é›†å°±æ˜¯æ ¹æ®GC Rootæ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ï¼Œç„¶åæŠŠæ‰€æœ‰æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡æ¸…é™¤å°±okäº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚äº‹å®ä¸Šåƒåœ¾æ”¶é›†ä¹Ÿå°±æ˜¯è¿™ä¹ˆä¸€å›äº‹ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™è¯´èµ·æ¥ç®€å•ï¼Œåšèµ·æ¥å´ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ã€‚è¿™ç¯‡æ–‡ç« å°±æ˜¯è®°å½•æˆ‘å¯¹CMSåƒåœ¾æ”¶é›†å™¨çš„ä¸€äº›ç–‘é—®å¹¶å­¦ä¹ çš„è¿‡ç¨‹ã€‚\né¦–å…ˆçœ‹ä¸€ä¸‹CMSçš„æ•´ä½“æµç¨‹(å…·ä½“æ¯ä¸ªæµç¨‹çš„è¯¦æƒ…å°±è‡ªè¡Œäº†è§£å§)\nå¦‚ä½•è¿›è¡Œæ ‡è®°ï¼Ÿ æœ€è¿‘åœ¨çœ‹Golangçš„GCç®—æ³•å®ç°ï¼Œé‡Œé¢ç”¨åˆ°äº†ä¸‰è‰²æ ‡è®°æ³•ï¼Œä½†æ˜¯åœ¨æˆ‘çš„çŸ¥è¯†åº“ä¸­å¯¹ä¸‰è‰²æ ‡è®°æ³•æœ‰è¿™ä¸ªæ¦‚å¿µï¼Œæ˜¯çš„ï¼Œæˆ‘åªçŸ¥é“è¿™ä¸ªæ¦‚å¿µï¼Œä¸çŸ¥é“ä¸‰è‰²æ ‡è®°æ³•æ˜¯æ€ä¹ˆä¸€ä¸ªæµç¨‹ï¼Œä¹Ÿä¸çŸ¥é“ä¸‰è‰²æ ‡è®°æ³•åœ¨GCä¸­æ€ä¹ˆä¸è¿è¡Œçš„ã€‚äºæ˜¯å°±å¼€å§‹äº†æˆ‘çš„æ¢é™©ä¹‹æ—…ã€‚\nåœ¨æœç´¢äº†ä¸€ä¸‹ä¸‰è‰²æ ‡è®°æ³•ï¼ˆå…·ä½“å¯ä»¥çœ‹ä¸€ä¸‹æ–‡æœ«å‚è€ƒæ–‡æ¡£ä¸­ä¸‰è‰²æ ‡è®°æ³•ä¸è¯»å†™å±éšœäº†è§£è¯¦æƒ…ï¼‰åï¼Œå‘ç°ç°ä»£è¿½è¸ªå¼ï¼ˆå¯è¾¾æ€§åˆ†æï¼‰çš„åƒåœ¾å›æ”¶å™¨å‡ ä¹éƒ½å€Ÿé‰´äº†ä¸‰è‰²æ ‡è®°çš„ç®—æ³•æ€æƒ³ï¼ŒCMSåƒåœ¾æ”¶é›†å™¨ä¹Ÿä¸ä¾‹å¤–ã€‚\nGC Rootæœ‰å“ªäº›ï¼Ÿ æˆ‘ä»¬çŸ¥é“æ€ä¹ˆè¿›è¡Œæ ‡è®°äº†ï¼Œä½†æœ€åˆæ ‡è®°çš„æ—¶å€™éœ€è¦ä¸€äº›æ ¹æ®æ‰è¡Œå•Šï¼Œè¿™äº›æ ¹æ®å°±æ˜¯æˆ‘ä»¬æ”¶çš„GC Rootã€‚GC Rootæœ‰å“ªäº›ï¼Ÿç½‘ä¸Šæœ‰å¾ˆå¤šçš„ç­”æ¡ˆï¼Œæˆ‘çš„ç†è§£å°±æ˜¯\nå½“å‰æ´»è·ƒè°ƒç”¨æ ˆä¸­çš„æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ ä¸€äº›ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„æ•°æ®æ‰€æŒ‡å‘çš„å¼•ç”¨ è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¯¹è±¡ï¼Œå› ä¸ºRå¤§æ˜¯è¿™æ ·è¯´çš„ï¼ˆå…·ä½“çš„é—®é¢˜è§å‚è€ƒæ–‡æ¡£javaçš„gcä¸ºä»€ä¹ˆè¦åˆ†ä»£ï¼Ÿï¼‰\næ‰€è°“â€œGC rootsâ€ï¼Œæˆ–è€…è¯´tracing GCçš„â€œæ ¹é›†åˆâ€ï¼Œå°±æ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ã€‚ ä¾‹å¦‚è¯´ï¼Œè¿™äº›å¼•ç”¨å¯èƒ½åŒ…æ‹¬ï¼š\næ‰€æœ‰Javaçº¿ç¨‹å½“å‰æ´»è·ƒçš„æ ˆå¸§é‡ŒæŒ‡å‘GCå †é‡Œçš„å¯¹è±¡çš„å¼•ç”¨ï¼›æ¢å¥è¯è¯´ï¼Œå½“å‰æ‰€æœ‰æ­£åœ¨è¢«è°ƒç”¨çš„æ–¹æ³•çš„å¼•ç”¨ç±»å‹çš„å‚æ•°/å±€éƒ¨å˜é‡/ä¸´æ—¶å€¼ã€‚ VMçš„ä¸€äº›é™æ€æ•°æ®ç»“æ„é‡ŒæŒ‡å‘GCå †é‡Œçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¾‹å¦‚è¯´HotSpot VMé‡Œçš„Universeé‡Œæœ‰å¾ˆå¤šè¿™æ ·çš„å¼•ç”¨ã€‚ JNI handlesï¼ŒåŒ…æ‹¬global handleså’Œlocal handles ï¼ˆçœ‹æƒ…å†µï¼‰æ‰€æœ‰å½“å‰è¢«åŠ è½½çš„Javaç±» ï¼ˆçœ‹æƒ…å†µï¼‰Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ ï¼ˆçœ‹æƒ…å†µï¼‰Javaç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± é‡Œçš„å¼•ç”¨ç±»å‹å¸¸é‡ï¼ˆStringæˆ–Classç±»å‹ï¼‰ ï¼ˆçœ‹æƒ…å†µï¼‰Stringå¸¸é‡æ± ï¼ˆStringTableï¼‰é‡Œçš„å¼•ç”¨ æ³¨æ„ï¼Œæ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨ï¼Œä¸æ˜¯å¯¹è±¡ã€‚\nç°åœ¨çŸ¥é“äº†GC Rootï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“æœ‰åˆ†ä»£çš„æ¦‚å¿µï¼Œæ–°ç”Ÿä»£çš„gcå’Œè€å¹´çš„ä»£çš„gcå›æ”¶çš„åŒºåŸŸæ˜¯ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆè¿™é‡Œçš„GC Rootæ˜¯ä¸æ˜¯åº”è¯¥ä¸ä¸€æ ·å‘¢ï¼Ÿè‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ã€‚\né¦–å…ˆçœ‹ä¸€ä¸‹æ–°ç”Ÿä»£çš„GC\næ–°ç”Ÿä»£çš„åŒºåŸŸä¸€èˆ¬éƒ½æ¯”è¾ƒå°ï¼Œè€Œä¸”å¯¹è±¡çš„å­˜æ´»ç‡éƒ½æ¯”è¾ƒä½ï¼Œæ‰€ä»¥æŒ‰ç…§å‰é¢è¯´çš„GC Rootåœ¨æ–°ç”Ÿä»£çš„åŒºåŸŸæ‰«æå°±è¡Œäº†ã€‚ä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Ÿè€å¹´ä»£å­˜åœ¨å¼•ç”¨æ–°ç”Ÿä»£å¯¹è±¡çš„å¯èƒ½å•Šï¼Ÿå¦‚æœåªæ‰«ææ–°ç”Ÿä»£çš„åŒºåŸŸï¼Œä¼šæ¼æ‰è¢«è€å¹´ä»£å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°±ä¼šè¢«æ¸…é™¤æ‰ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚\nå¦‚æœè¿™æ ·çš„è¯ï¼Œé‚£æ˜¯ä¸æ˜¯æ‰«æä¸€ä¸‹è€å¹´ä»£çš„å¯¹è±¡ï¼Œçœ‹æ˜¯å¦å¼•ç”¨æ–°ç”Ÿä»£çš„å¯¹è±¡æ˜¯ä¸æ˜¯å°±okäº†ï¼Ÿå—¯è¿™ä¹ˆåšè‚¯å®šæ˜¯okçš„ï¼Œä½†æ˜¯è€å¹´ä»£ä¸€èˆ¬å¾ˆå¤§ï¼Œè€Œä¸”å­˜æ´»çš„å¯¹è±¡å¾ˆå¤šï¼Œä¼šå¯¼è‡´æ‰«æå ç”¨å¾ˆé•¿çš„æ—¶é—´ã€‚é‚£è¿™ä¸ªé—®é¢˜å¦‚ä½•è§£ï¼ŸJVMæ˜¯å¦‚ä½•é¿å…Minor GCæ—¶æ‰«æå…¨å †çš„ï¼Ÿ\nç»è¿‡ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºï¼Œè€å¹´ä»£æŒæœ‰æ–°ç”Ÿä»£å¯¹è±¡å¼•ç”¨çš„æƒ…å†µä¸è¶³1%ï¼Œæ ¹æ®è¿™ä¸€ç‰¹æ€§JVMå¼•å…¥äº†å¡è¡¨ï¼ˆcard tableï¼‰æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå¡è¡¨çš„å…·ä½“ç­–ç•¥æ˜¯å°†è€å¹´ä»£çš„ç©ºé—´åˆ†æˆå¤§å°ä¸º512Bçš„è‹¥å¹²å¼ å¡ï¼ˆcardï¼‰ã€‚å¡è¡¨æœ¬èº«æ˜¯å•å­—èŠ‚æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å¯¹åº”ç€ä¸€å¼ å¡ï¼Œå½“å‘ç”Ÿè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£æ—¶ï¼Œè™šæ‹Ÿæœºå°†è¯¥å¡å¯¹åº”çš„å¡è¡¨å…ƒç´ è®¾ç½®ä¸ºé€‚å½“çš„å€¼ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¡è¡¨3è¢«æ ‡è®°ä¸ºè„ï¼ˆå¡è¡¨è¿˜æœ‰å¦å¤–çš„ä½œç”¨ï¼Œæ ‡è¯†å¹¶å‘æ ‡è®°é˜¶æ®µå“ªäº›å—è¢«ä¿®æ”¹è¿‡ï¼‰ï¼Œä¹‹åMinor GCæ—¶é€šè¿‡æ‰«æå¡è¡¨å°±å¯ä»¥å¾ˆå¿«çš„è¯†åˆ«å“ªäº›å¡ä¸­å­˜åœ¨è€å¹´ä»£æŒ‡å‘æ–°ç”Ÿä»£çš„å¼•ç”¨ã€‚è¿™æ ·è™šæ‹Ÿæœºé€šè¿‡ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼ï¼Œé¿å…äº†å…¨å †æ‰«æã€‚\næ‰€ä»¥æ–°å¹´ä»£GCçš„GC RootåŒ…å«2éƒ¨åˆ†\næ–°ç”Ÿä»£ä¸­æ»¡è¶³GC Rootå®šä¹‰çš„å¯¹è±¡ å¡è¡¨ä¸­è€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£çš„å¯¹è±¡ è€å¹´ä»£çš„GC\nå‰é¢æˆ‘ä»¬è¯´äº†æ–°ç”Ÿä»£çš„gcï¼Œæˆ‘ä»¬ä»¥åŒæ ·çš„æ€è·¯æ¥çœ‹çœ‹è€å¹´ä»£çš„gcï¼Œè€å¹´ä»£çš„GC Rootå¦‚ä½•æ¥æ ‡è®°å‘¢ï¼Ÿåªæ‰«æè€å¹´ä»£å¯ä»¥å—ï¼Ÿå½“ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ–°ç”Ÿä»£ä¸­ä¹Ÿå¯èƒ½å­˜åœ¨è€å¹´ä»£å¯¹è±¡çš„å¼•ç”¨ï¼Œå¥½åœ¨æ–°ç”Ÿä»£å¹¶ä¸å¤§ï¼Œæ‰€ä»¥è€å¹´ä»£GCçš„æ—¶å€™è¿˜éœ€è¦æ‰«æä¸€éæ–°ç”Ÿä»£ã€‚\næ‰€ä»¥è€å¹´ä»£GCçš„GC RootåŒ…å«2éƒ¨åˆ†\nè€ç”Ÿä»£ä¸­æ»¡è¶³GC Rootå®šä¹‰çš„å¯¹è±¡ï¼Œå¦‚å›¾èŠ‚ç‚¹1ï¼› æ ‡è®°å¹´è½»ä»£ä¸­æ´»ç€çš„å¯¹è±¡å¼•ç”¨åˆ°çš„è€å¹´ä»£çš„å¯¹è±¡ï¼ˆæŒ‡çš„æ˜¯å¹´è½»ä»£ä¸­è¿˜å­˜æ´»çš„å¼•ç”¨ç±»å‹å¯¹è±¡ï¼Œå¼•ç”¨æŒ‡å‘è€å¹´ä»£ä¸­çš„å¯¹è±¡ï¼‰å¦‚å›¾èŠ‚ç‚¹2ã€3ï¼› å¹¶å‘æ ‡è®°çš„å¥½å? æ ‡è®°ä½œä¸ºåƒåœ¾å›æ”¶çš„ç¬¬ä¸€æ­¥ï¼Œç°åœ¨çŸ¥é“å¦‚ä½•è¿›è¡Œæ ‡è®°ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éå†è¿™äº›å¯¹è±¡ï¼Œå°†æ‰€æœ‰æœªæ ‡è®°çš„å¯¹è±¡æ¸…ç†å°±å®ŒæˆGCäº†ã€‚\nç„¶è€Œäº‹å®ä¸Šå¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œå¦‚æœæ ‡è®°çš„æ—¶å€™æ˜¯STWçš„ï¼Œé‚£å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œä½†æ˜¯å¦‚æœæ ‡è®°è¿‡ç¨‹éƒ½STWä¼šé€ æˆæš‚åœæ—¶é—´è¿‡é•¿ï¼Œç»™äººçš„æ„Ÿè§‰å°±æ˜¯ç³»ç»Ÿä¸€å¡ä¸€å¡çš„ã€‚\näºæ˜¯å°±æŠŠæ ‡è®°çš„è¿‡ç¨‹æ”¹æˆå¹¶å‘çš„è¿›è¡Œï¼Œä¹Ÿå°±æ˜¯CMSä¸­å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ï¼Œç„¶è€Œè¿™å°±æ˜¯ä¸€åˆ‡å¤æ‚é—®é¢˜çš„æºå¤´ã€‚è™½ç„¶å¹¶å‘æ ‡è®°æå‡äº†æ ‡è®°çš„æ•ˆç‡ï¼Œä½†æ˜¯å› æ­¤å´å¼•å‘äº†ä¸€ç³»åˆ—çš„é—®é¢˜ã€‚\nå› ä¸ºå¹¶å‘æ ‡è®°æ—¶ï¼Œgcçº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹æ˜¯å¹¶è¡Œçš„ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µ(éœ€è¦äº†è§£ä¸‰è‰²æ ‡è®°æ³•ä¸è¯»å†™å±éšœ)ï¼š\næ–°ç”Ÿä»£æ™‹å‡åˆ°è€å¹´ä»£ é»‘è‰²å¯¹è±¡å–æ¶ˆå¯¹ç°è‰²å¯¹è±¡çš„å¼•ç”¨(æµ®åŠ¨åƒåœ¾) é»‘è‰²å¯¹è±¡æ–°å¢å¯¹ç™½è‰²å¯¹è±¡çš„å¼•ç”¨(æ¼æ ‡) å…¶å®åœ¨ä¸‰è‰²æ ‡è®°æ³•ä¸è¯»å†™å±éšœæ–‡ä¸­å·²ç»ç»™å‡ºäº†è§£å†³æ–¹æ³•\u0026ndash;æ·»åŠ è¯»å†™å±éšœ\nå†™å±éšœ + SATB å†™å±éšœ + å¢é‡æ›´æ–° è¯»å±éšœï¼ˆLoad Barrierï¼‰ åœ¨CMSå¹¶å‘æ ‡è®°é˜¶æ®µï¼Œä½¿ç”¨ å†™å±éšœ + å¢é‡æ›´æ–° çš„æ–¹æ³•ï¼Œå°†ä¸Šé¢å‡ºç°çš„æƒ…å†µæ ‡è®°ä¸ºdirtyï¼Œè¿™æ ·æœ€åå†éå†å¤„ç†ä¸€ä¸‹Dirtyé›†åˆä¸­çš„å¯¹è±¡å°±okäº†\né‡æ–°æ ‡è®°é˜¶æ®µä¸ºä»€ä¹ˆè¿˜è¦æ‰«ææ–°ç”Ÿä»£ï¼Ÿ å› ä¸ºå­˜åœ¨è·¨ä»£å¼•ç”¨ï¼Œä½†æ˜¯å‰é¢è¯´è¿‡è¿™ç§æƒ…å†µï¼Œé€šè¿‡è¯»å†™å±éšœçš„æ–¹å¼æ ‡è®°è¿™äº›ä¸ºdirtyï¼Œåªéœ€è¦æ‰«æè€å¹´ä»£å’Œdirtyé›†åˆå°±è¡Œäº†å•Šï¼Ÿå“ï¼Œçœ‹æ¥æˆ‘è¿˜æ˜¯å¤ªå¹´è½»ï¼Œå¦‚æœåªæ‰«æè€å¹´ä»£å’Œdirtyé›†åˆä¼šæ¼æ‰ä¸€éƒ¨åˆ†ï¼Œä¼šæ˜¯å“ªéƒ¨åˆ†å‘¢ï¼Ÿè€å¹´ä»£å’Œdirtyé›†åˆè¿˜æ²¡æœ‰è¦†ç›–å®Œå—ï¼Ÿ\næ˜¯çš„ï¼Œè€å¹´ä»£å’Œdirtyé›†åˆçš„ç¡®æ²¡æœ‰è¦†ç›–å®Œã€‚æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚è€å¹´ä»£ä¸­ç»è¿‡åˆå§‹æ ‡è®°å’Œå¹¶å‘æ ‡è®°åï¼Œåªæœ‰é»‘è‰²å¯¹è±¡å’Œç™½è‰²å¯¹è±¡äº†ï¼Œé»‘è‰²çš„å°±æ˜¯è¦ç•™ä¸‹çš„ï¼Œç™½è‰²çš„å°±æ˜¯è¦è¢«æ¸…é™¤çš„ã€‚é»‘è‰²å¯¹è±¡æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿæ ¹æ®GC Rootæ‰¾åˆ°çš„ï¼Œæ‰€ä»¥åªè¦å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ï¼ŒGC Rootä¸å‘ç”Ÿå˜åŒ–ï¼Œé»‘è‰²å¯¹è±¡å°±æ²¡æœ‰é—®é¢˜(ä¸ä¼šæ¼æ ‡)ï¼Œå¦‚æœåœ¨å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­GC Rootå‘ç”Ÿäº†å˜åŒ–å‘¢ï¼Ÿ\nå½“å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­GC Rootå¢åŠ äº†ï¼Œå¹¶ä¸”è¿™ä¸ªGC Rootè¿˜å¼•ç”¨äº†è€å¹´ä»£ä¸­çš„å¯¹è±¡ï¼Œæ­¤æ—¶å¦‚æœåªæ‰«æè€å¹´ä»£å’Œdirtyé›†åˆå°±ä¼šæ¼æ ‡ã€‚å› æ­¤é‡æ–°æ ‡è®°é˜¶æ®µä»ç„¶éœ€è¦æ‰«ææ–°ç”Ÿä»£ã€‚\né¢„å¤„ç†é˜¶æ®µéƒ½å¹²äº†å•¥ï¼Ÿ é¢„å¤„ç†é˜¶æ®µå…¶å®æœ‰2éƒ¨åˆ†ï¼š\né¢„æ¸…ç†é˜¶æ®µ å¯ç»ˆæ­¢çš„é¢„å¤„ç† è¿™ä¸ªé˜¶æ®µçš„ç›®çš„éƒ½æ˜¯ä¸ºäº†å‡è½»åé¢çš„é‡æ–°æ ‡è®°çš„å‹åŠ›ï¼Œæå‰åšä¸€ç‚¹é‡æ–°æ ‡è®°é˜¶æ®µçš„å·¥ä½œã€‚ä¸€èˆ¬CMSçš„GCè€—æ—¶80%éƒ½åœ¨remarké˜¶æ®µï¼Œæ‰€ä»¥é¢„å¤„ç†é˜¶æ®µä¹Ÿæ˜¯ä¸ºäº†å‡å°‘remarké˜¶æ®µçš„STWæ—¶é—´ã€‚\né‡æ–°æ ‡è®°é˜¶æ®µéœ€è¦åšä»¥ä¸‹å·¥ä½œï¼š\néå†æ–°ç”Ÿä»£å¯¹è±¡ï¼Œé‡æ–°æ ‡è®° æ ¹æ®GC Rootsï¼Œé‡æ–°æ ‡è®° éå†è€å¹´ä»£çš„Dirty Cardï¼Œé‡æ–°æ ‡è®°ï¼ˆè¿™é‡Œçš„Dirty Cardå¤§éƒ¨åˆ†å·²ç»åœ¨cleané˜¶æ®µå¤„ç†è¿‡ï¼‰ éå†æ–°ç”Ÿä»£å¯¹è±¡æ—¶ï¼Œå¯èƒ½å¾ˆå¤šå¯¹è±¡å·²ç»æ˜¯ä¸å¯è¾¾äº†ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦æ‰«æã€‚éå†Dirty Cardåšå¤„ç†ã€‚\nè¿™2éƒ¨åˆ†å…¶å®å°±æ˜¯é¢„å¤„ç†é˜¶æ®µå¸®åŠ©é‡æ–°æ ‡è®°å‡è½»å‹åŠ›çš„åœ°æ–¹\né¢„æ¸…ç†é˜¶æ®µå’Œå¯ç»ˆæ­¢çš„é¢„å¤„ç†éƒ½ä¼šæ‰«æDirty Cardåšå¤„ç† å¯ç»ˆæ­¢çš„é¢„å¤„ç†ï¼Œå°½é‡è¿›è¡Œä¸€æ¬¡ygcï¼Œè®©ä¸å¯è¾¾çš„å¯¹è±¡è¢«å›æ”¶æ‰ï¼Œremarké˜¶æ®µéå†æ–°ç”Ÿä»£çš„å¯¹è±¡æˆæœ¬å°ä¸€ç‚¹ å…·ä½“è¿™ä¸ªé˜¶æ®µçš„è¯¦æƒ…è§å‚è€ƒæ–‡æ¡£å›¾è§£CMSåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä½ å€¼å¾—æ‹¥æœ‰\nå‚è€ƒæ–‡æ¡£\nä¸‰è‰²æ ‡è®°æ³•ä¸è¯»å†™å±éšœ å›¾è§£CMSåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä½ å€¼å¾—æ‹¥æœ‰ javaçš„gcä¸ºä»€ä¹ˆè¦åˆ†ä»£ï¼Ÿ ","permalink":"https://carlos19960601.github.io/posts/%E5%86%8D%E5%9B%9E%E9%A6%96cms%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/","summary":"\u003ch3 id=\"å‰è¨€\"\u003eå‰è¨€\u003c/h3\u003e\n\u003cp\u003eä¹‹å‰å­¦ä¹ JVMåƒåœ¾å›æ”¶æ—¶ï¼Œä¸»è¦æ˜¯è¿‡äº†ä¸€éåƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ¯”å¦‚å¤åˆ¶ç®—æ³•ï¼Œæ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å¢åŠ åˆ†ä»£ï¼Œæ¯ä»£é‡‡å–ä¸åŒçš„å›æ”¶ç®—æ³•ï¼Œä»¥æé«˜æ•´ä½“çš„åˆ†é…å’Œå›æ”¶æ•ˆç‡ã€‚ç„¶åè¿‡äº†ä¸€éJVMä¸­çš„åƒåœ¾æ”¶é›†å™¨ï¼Œæ¯”å¦‚Serialã€Parallel Scavengeã€Parallel Newã€CMSã€G1ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eè‡ªè®¤ä¸ºåƒåœ¾æ”¶é›†å°±æ˜¯æ ¹æ®GC Rootæ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ï¼Œç„¶åæŠŠæ‰€æœ‰æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡æ¸…é™¤å°±okäº†ã€‚æ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚äº‹å®ä¸Šåƒåœ¾æ”¶é›†ä¹Ÿå°±æ˜¯è¿™ä¹ˆä¸€å›äº‹ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™è¯´èµ·æ¥ç®€å•ï¼Œåšèµ·æ¥å´ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ã€‚è¿™ç¯‡æ–‡ç« å°±æ˜¯è®°å½•æˆ‘å¯¹CMSåƒåœ¾æ”¶é›†å™¨çš„ä¸€äº›ç–‘é—®å¹¶å­¦ä¹ çš„è¿‡ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆçœ‹ä¸€ä¸‹CMSçš„æ•´ä½“æµç¨‹(å…·ä½“æ¯ä¸ªæµç¨‹çš„è¯¦æƒ…å°±è‡ªè¡Œäº†è§£å§)\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e5%86%8d%e5%9b%9e%e9%a6%96CMS%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6/CMS%e6%b5%81%e7%a8%8b.png\" alt=\"CMSæµç¨‹\"  /\u003e\n\u003c/p\u003e\n\u003ch3 id=\"å¦‚ä½•è¿›è¡Œæ ‡è®°\"\u003eå¦‚ä½•è¿›è¡Œæ ‡è®°ï¼Ÿ\u003c/h3\u003e\n\u003cp\u003eæœ€è¿‘åœ¨çœ‹Golangçš„GCç®—æ³•å®ç°ï¼Œé‡Œé¢ç”¨åˆ°äº†ä¸‰è‰²æ ‡è®°æ³•ï¼Œä½†æ˜¯åœ¨æˆ‘çš„çŸ¥è¯†åº“ä¸­å¯¹ä¸‰è‰²æ ‡è®°æ³•æœ‰è¿™ä¸ªæ¦‚å¿µï¼Œæ˜¯çš„ï¼Œæˆ‘åªçŸ¥é“è¿™ä¸ªæ¦‚å¿µï¼Œä¸çŸ¥é“ä¸‰è‰²æ ‡è®°æ³•æ˜¯æ€ä¹ˆä¸€ä¸ªæµç¨‹ï¼Œä¹Ÿä¸çŸ¥é“ä¸‰è‰²æ ‡è®°æ³•åœ¨GCä¸­æ€ä¹ˆä¸è¿è¡Œçš„ã€‚äºæ˜¯å°±å¼€å§‹äº†æˆ‘çš„æ¢é™©ä¹‹æ—…ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨æœç´¢äº†ä¸€ä¸‹ä¸‰è‰²æ ‡è®°æ³•ï¼ˆå…·ä½“å¯ä»¥çœ‹ä¸€ä¸‹æ–‡æœ«å‚è€ƒæ–‡æ¡£ä¸­\u003ca href=\"https://www.jianshu.com/p/12544c0ad5c1\"\u003eä¸‰è‰²æ ‡è®°æ³•ä¸è¯»å†™å±éšœ\u003c/a\u003eäº†è§£è¯¦æƒ…ï¼‰åï¼Œå‘ç°ç°ä»£è¿½è¸ªå¼ï¼ˆå¯è¾¾æ€§åˆ†æï¼‰çš„åƒåœ¾å›æ”¶å™¨å‡ ä¹éƒ½å€Ÿé‰´äº†ä¸‰è‰²æ ‡è®°çš„ç®—æ³•æ€æƒ³ï¼ŒCMSåƒåœ¾æ”¶é›†å™¨ä¹Ÿä¸ä¾‹å¤–ã€‚\u003c/p\u003e\n\u003ch3 id=\"gc-rootæœ‰å“ªäº›\"\u003eGC Rootæœ‰å“ªäº›ï¼Ÿ\u003c/h3\u003e\n\u003cp\u003eæˆ‘ä»¬çŸ¥é“æ€ä¹ˆè¿›è¡Œæ ‡è®°äº†ï¼Œä½†æœ€åˆæ ‡è®°çš„æ—¶å€™éœ€è¦ä¸€äº›æ ¹æ®æ‰è¡Œå•Šï¼Œè¿™äº›æ ¹æ®å°±æ˜¯æˆ‘ä»¬æ”¶çš„GC Rootã€‚GC Rootæœ‰å“ªäº›ï¼Ÿç½‘ä¸Šæœ‰å¾ˆå¤šçš„ç­”æ¡ˆï¼Œæˆ‘çš„ç†è§£å°±æ˜¯\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå½“å‰æ´»è·ƒè°ƒç”¨æ ˆä¸­çš„æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨\u003c/li\u003e\n\u003cli\u003eä¸€äº›ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„æ•°æ®æ‰€æŒ‡å‘çš„å¼•ç”¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¯¹è±¡ï¼Œå› ä¸ºRå¤§æ˜¯è¿™æ ·è¯´çš„ï¼ˆå…·ä½“çš„é—®é¢˜è§å‚è€ƒæ–‡æ¡£\u003ca href=\"https://www.zhihu.com/question/53613423/answer/135743258\"\u003ejavaçš„gcä¸ºä»€ä¹ˆè¦åˆ†ä»£ï¼Ÿ\u003c/a\u003eï¼‰\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ‰€è°“â€œGC rootsâ€ï¼Œæˆ–è€…è¯´tracing GCçš„â€œæ ¹é›†åˆâ€ï¼Œå°±æ˜¯\u003cstrong\u003eä¸€ç»„å¿…é¡»æ´»è·ƒçš„å¼•ç”¨\u003c/strong\u003eã€‚\nä¾‹å¦‚è¯´ï¼Œè¿™äº›å¼•ç”¨å¯èƒ½åŒ…æ‹¬ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ‰€æœ‰Javaçº¿ç¨‹å½“å‰æ´»è·ƒçš„æ ˆå¸§é‡ŒæŒ‡å‘GCå †é‡Œçš„å¯¹è±¡çš„å¼•ç”¨ï¼›æ¢å¥è¯è¯´ï¼Œå½“å‰æ‰€æœ‰æ­£åœ¨è¢«è°ƒç”¨çš„æ–¹æ³•çš„å¼•ç”¨ç±»å‹çš„å‚æ•°/å±€éƒ¨å˜é‡/ä¸´æ—¶å€¼ã€‚\u003c/li\u003e\n\u003cli\u003eVMçš„ä¸€äº›é™æ€æ•°æ®ç»“æ„é‡ŒæŒ‡å‘GCå †é‡Œçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¾‹å¦‚è¯´HotSpot VMé‡Œçš„Universeé‡Œæœ‰å¾ˆå¤šè¿™æ ·çš„å¼•ç”¨ã€‚\u003c/li\u003e\n\u003cli\u003eJNI handlesï¼ŒåŒ…æ‹¬global handleså’Œlocal handles\u003c/li\u003e\n\u003cli\u003eï¼ˆçœ‹æƒ…å†µï¼‰æ‰€æœ‰å½“å‰è¢«åŠ è½½çš„Javaç±»\u003c/li\u003e\n\u003cli\u003eï¼ˆçœ‹æƒ…å†µï¼‰Javaç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡\u003c/li\u003e\n\u003cli\u003eï¼ˆçœ‹æƒ…å†µï¼‰Javaç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± é‡Œçš„å¼•ç”¨ç±»å‹å¸¸é‡ï¼ˆStringæˆ–Classç±»å‹ï¼‰\u003c/li\u003e\n\u003cli\u003eï¼ˆçœ‹æƒ…å†µï¼‰Stringå¸¸é‡æ± ï¼ˆStringTableï¼‰é‡Œçš„å¼•ç”¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæ³¨æ„ï¼Œæ˜¯ä¸€ç»„å¿…é¡»æ´»è·ƒçš„\u003cstrong\u003eå¼•ç”¨\u003c/strong\u003eï¼Œä¸æ˜¯å¯¹è±¡ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eç°åœ¨çŸ¥é“äº†GC Rootï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“æœ‰åˆ†ä»£çš„æ¦‚å¿µï¼Œæ–°ç”Ÿä»£çš„gcå’Œè€å¹´çš„ä»£çš„gcå›æ”¶çš„åŒºåŸŸæ˜¯ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆè¿™é‡Œçš„GC Rootæ˜¯ä¸æ˜¯åº”è¯¥ä¸ä¸€æ ·å‘¢ï¼Ÿè‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ã€‚\u003c/p\u003e\n\u003cp\u003eé¦–å…ˆçœ‹ä¸€ä¸‹\u003cstrong\u003eæ–°ç”Ÿä»£çš„GC\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eæ–°ç”Ÿä»£çš„åŒºåŸŸä¸€èˆ¬éƒ½æ¯”è¾ƒå°ï¼Œè€Œä¸”å¯¹è±¡çš„å­˜æ´»ç‡éƒ½æ¯”è¾ƒä½ï¼Œæ‰€ä»¥æŒ‰ç…§å‰é¢è¯´çš„GC Rootåœ¨æ–°ç”Ÿä»£çš„åŒºåŸŸæ‰«æå°±è¡Œäº†ã€‚ä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Ÿè€å¹´ä»£å­˜åœ¨å¼•ç”¨æ–°ç”Ÿä»£å¯¹è±¡çš„å¯èƒ½å•Šï¼Ÿå¦‚æœåªæ‰«ææ–°ç”Ÿä»£çš„åŒºåŸŸï¼Œä¼šæ¼æ‰è¢«è€å¹´ä»£å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å°±ä¼šè¢«æ¸…é™¤æ‰ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœè¿™æ ·çš„è¯ï¼Œé‚£æ˜¯ä¸æ˜¯æ‰«æä¸€ä¸‹è€å¹´ä»£çš„å¯¹è±¡ï¼Œçœ‹æ˜¯å¦å¼•ç”¨æ–°ç”Ÿä»£çš„å¯¹è±¡æ˜¯ä¸æ˜¯å°±okäº†ï¼Ÿå—¯è¿™ä¹ˆåšè‚¯å®šæ˜¯okçš„ï¼Œä½†æ˜¯è€å¹´ä»£ä¸€èˆ¬å¾ˆå¤§ï¼Œè€Œä¸”å­˜æ´»çš„å¯¹è±¡å¾ˆå¤šï¼Œä¼šå¯¼è‡´æ‰«æå ç”¨å¾ˆé•¿çš„æ—¶é—´ã€‚é‚£è¿™ä¸ªé—®é¢˜å¦‚ä½•è§£ï¼ŸJVMæ˜¯å¦‚ä½•é¿å…Minor GCæ—¶æ‰«æå…¨å †çš„ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eç»è¿‡ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºï¼Œè€å¹´ä»£æŒæœ‰æ–°ç”Ÿä»£å¯¹è±¡å¼•ç”¨çš„æƒ…å†µä¸è¶³1%ï¼Œæ ¹æ®è¿™ä¸€ç‰¹æ€§JVMå¼•å…¥äº†å¡è¡¨ï¼ˆcard tableï¼‰æ¥å®ç°è¿™ä¸€ç›®çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e5%86%8d%e5%9b%9e%e9%a6%96CMS%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6/CardTable.png\" alt=\"CardTable\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå¡è¡¨\u003c/strong\u003eçš„å…·ä½“ç­–ç•¥æ˜¯å°†è€å¹´ä»£çš„ç©ºé—´åˆ†æˆå¤§å°ä¸º512Bçš„è‹¥å¹²å¼ å¡ï¼ˆcardï¼‰ã€‚å¡è¡¨æœ¬èº«æ˜¯å•å­—èŠ‚æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å¯¹åº”ç€ä¸€å¼ å¡ï¼Œå½“å‘ç”Ÿè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£æ—¶ï¼Œè™šæ‹Ÿæœºå°†è¯¥å¡å¯¹åº”çš„å¡è¡¨å…ƒç´ è®¾ç½®ä¸ºé€‚å½“çš„å€¼ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¡è¡¨3è¢«æ ‡è®°ä¸ºè„ï¼ˆå¡è¡¨è¿˜æœ‰å¦å¤–çš„ä½œç”¨ï¼Œæ ‡è¯†å¹¶å‘æ ‡è®°é˜¶æ®µå“ªäº›å—è¢«ä¿®æ”¹è¿‡ï¼‰ï¼Œä¹‹åMinor GCæ—¶é€šè¿‡æ‰«æå¡è¡¨å°±å¯ä»¥å¾ˆå¿«çš„è¯†åˆ«å“ªäº›å¡ä¸­å­˜åœ¨è€å¹´ä»£æŒ‡å‘æ–°ç”Ÿä»£çš„å¼•ç”¨ã€‚è¿™æ ·è™šæ‹Ÿæœºé€šè¿‡ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼ï¼Œé¿å…äº†å…¨å †æ‰«æã€‚\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥æ–°å¹´ä»£GCçš„GC RootåŒ…å«2éƒ¨åˆ†\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ–°ç”Ÿä»£ä¸­æ»¡è¶³GC Rootå®šä¹‰çš„å¯¹è±¡\u003c/li\u003e\n\u003cli\u003eå¡è¡¨ä¸­è€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£çš„å¯¹è±¡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eè€å¹´ä»£çš„GC\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå‰é¢æˆ‘ä»¬è¯´äº†æ–°ç”Ÿä»£çš„gcï¼Œæˆ‘ä»¬ä»¥åŒæ ·çš„æ€è·¯æ¥çœ‹çœ‹è€å¹´ä»£çš„gcï¼Œè€å¹´ä»£çš„GC Rootå¦‚ä½•æ¥æ ‡è®°å‘¢ï¼Ÿåªæ‰«æè€å¹´ä»£å¯ä»¥å—ï¼Ÿå½“ç„¶æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºæ–°ç”Ÿä»£ä¸­ä¹Ÿå¯èƒ½å­˜åœ¨è€å¹´ä»£å¯¹è±¡çš„å¼•ç”¨ï¼Œå¥½åœ¨æ–°ç”Ÿä»£å¹¶ä¸å¤§ï¼Œæ‰€ä»¥è€å¹´ä»£GCçš„æ—¶å€™è¿˜éœ€è¦æ‰«æä¸€éæ–°ç”Ÿä»£ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/%e5%86%8d%e5%9b%9e%e9%a6%96CMS%e5%9e%83%e5%9c%be%e5%9b%9e%e6%94%b6/%e6%96%b0%e7%94%9f%e4%bb%a3GC%e7%9a%84Root.png\" alt=\"æ–°ç”Ÿä»£GCçš„Root\"  /\u003e\n\u003c/p\u003e\n\u003cp\u003eæ‰€ä»¥è€å¹´ä»£GCçš„GC RootåŒ…å«2éƒ¨åˆ†\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eè€ç”Ÿä»£ä¸­æ»¡è¶³GC Rootå®šä¹‰çš„å¯¹è±¡ï¼Œå¦‚å›¾èŠ‚ç‚¹1ï¼›\u003c/li\u003e\n\u003cli\u003eæ ‡è®°å¹´è½»ä»£ä¸­æ´»ç€çš„å¯¹è±¡å¼•ç”¨åˆ°çš„è€å¹´ä»£çš„å¯¹è±¡ï¼ˆæŒ‡çš„æ˜¯å¹´è½»ä»£ä¸­è¿˜å­˜æ´»çš„å¼•ç”¨ç±»å‹å¯¹è±¡ï¼Œå¼•ç”¨æŒ‡å‘è€å¹´ä»£ä¸­çš„å¯¹è±¡ï¼‰å¦‚å›¾èŠ‚ç‚¹2ã€3ï¼›\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"å¹¶å‘æ ‡è®°çš„å¥½å\"\u003eå¹¶å‘æ ‡è®°çš„å¥½å?\u003c/h3\u003e\n\u003cp\u003eæ ‡è®°ä½œä¸ºåƒåœ¾å›æ”¶çš„ç¬¬ä¸€æ­¥ï¼Œç°åœ¨çŸ¥é“å¦‚ä½•è¿›è¡Œæ ‡è®°ï¼Œæ¥ä¸‹æ¥å°±æ˜¯éå†è¿™äº›å¯¹è±¡ï¼Œå°†æ‰€æœ‰æœªæ ‡è®°çš„å¯¹è±¡æ¸…ç†å°±å®ŒæˆGCäº†ã€‚\u003c/p\u003e\n\u003cp\u003eç„¶è€Œäº‹å®ä¸Šå¹¶æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œå¦‚æœæ ‡è®°çš„æ—¶å€™æ˜¯STWçš„ï¼Œé‚£å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œä½†æ˜¯å¦‚æœæ ‡è®°è¿‡ç¨‹éƒ½STWä¼šé€ æˆæš‚åœæ—¶é—´è¿‡é•¿ï¼Œç»™äººçš„æ„Ÿè§‰å°±æ˜¯ç³»ç»Ÿä¸€å¡ä¸€å¡çš„ã€‚\u003c/p\u003e\n\u003cp\u003eäºæ˜¯å°±æŠŠæ ‡è®°çš„è¿‡ç¨‹æ”¹æˆå¹¶å‘çš„è¿›è¡Œï¼Œä¹Ÿå°±æ˜¯CMSä¸­å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ï¼Œç„¶è€Œè¿™å°±æ˜¯ä¸€åˆ‡å¤æ‚é—®é¢˜çš„æºå¤´ã€‚è™½ç„¶å¹¶å‘æ ‡è®°æå‡äº†æ ‡è®°çš„æ•ˆç‡ï¼Œä½†æ˜¯å› æ­¤å´å¼•å‘äº†ä¸€ç³»åˆ—çš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003cp\u003eå› ä¸ºå¹¶å‘æ ‡è®°æ—¶ï¼Œgcçº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹æ˜¯å¹¶è¡Œçš„ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µ(éœ€è¦äº†è§£\u003ca href=\"https://www.jianshu.com/p/12544c0ad5c1\"\u003eä¸‰è‰²æ ‡è®°æ³•ä¸è¯»å†™å±éšœ\u003c/a\u003e)ï¼š\u003c/p\u003e","title":"å†å›é¦–CMSåƒåœ¾å›æ”¶"}]